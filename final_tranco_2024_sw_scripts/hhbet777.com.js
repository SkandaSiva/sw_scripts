(()=>{"use strict";const e=(e,t,n,s)=>function(e,t="POST",n,s,a="json"){var o;const i=s||{},r=Object.assign({cache:"no-cache",headers:{},redirect:"follow",mode:"cors"},{method:t}),c=Object.assign(r,i);if(c.method=null===(o=c.method)||void 0===o?void 0:o.toUpperCase(),"GET"===c.method){if(n){let t="";const s=/([?&])_=[^&]*/,a=/\?/;"object"==typeof n&&(t=function(e){let t="";for(const n in e)e.hasOwnProperty(n)&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t.slice(0,-1)}(n)),e=s.test(e)?e.replace(s,"$1"+t):e+(a.test(e)?"&":"?")+t}}else[FormData,ArrayBuffer,Blob].filter((e=>n instanceof e)).length>0?c.body=n:(c.headers=Object.assign({"Content-Type":"application/json"},c.headers),n&&(c.body="string"==typeof n?n:JSON.stringify(n)));return fetch(e,c).then((e=>{const{status:t}=e;if(t>=200&&t<400){let t;switch(a){case"json":t=new Promise((t=>{e.text().then((e=>{try{t(JSON.parse(e))}catch(n){t(e)}}))}));break;case"text":t=e.text();break;case"blob":t=e.blob();break;case"arraybuffer":t=e.arrayBuffer();break;default:t=e.json()}return t}return Promise.reject(e)})).catch((e=>Promise.reject(e)))}(e,"POST",t,n,s),t="webpushinfoData",n="webPushTable";function s(e,s="userInfoData"){!function(e){const s=indexedDB.open(t);s.onupgradeneeded=function(e){var t;const s=null===(t=e.target)||void 0===t?void 0:t.result;s.objectStoreNames.contains(n)||s.createObjectStore(n,{keyPath:"id"}).createIndex("name","name",{unique:!1})},s.onerror=function(){},s.onsuccess=function(){e(s.result)}}((a=>{try{const t=a.transaction([n],"readonly");t.objectStore(n).index("name").get(s).onsuccess=function(t){t.target.result?e(t.target.result):e({})}}catch(s){!function(e=t){const n=indexedDB.deleteDatabase(e);n.onsuccess=function(){},n.onerror=function(){}}(),e({})}}))}let a={centerUrl:"https://global-websis.api.engagelab.cc/v1/get-webaddr",prefix:".produce.min.2.2.0.js",version:"2.2.0",URL_POLLING:"",development:!1}.reportUrl,o=!1;function i(e){o?e(a):s((t=>{o=!0;const n=JSON.parse(t.data||"{}");n.reportUrl&&(a=n.reportUrl),e(a)}))}function r(t,n,s="W3Push"){n.mtpush_appkey&&(n.engagelab_appkey=n.mtpush_appkey),n.mtpush_passwd&&(n.engagelab_passwd=n.mtpush_passwd),n.mtpush_uid&&(n.engagelab_uid=n.mtpush_uid),t.forEach((e=>{const t=(new Date).getTime()/1e3|0;e.itime=t,e.msg_id&&(e.msg_id=e.msg_id.toString())}));const a={platform:"b",uid:n.engagelab_uid,app_key:n.engagelab_appkey,channel:s,content:t};i((t=>{e(t,a,{headers:{Authorization:"Basic "+btoa(a.uid+":"+n.engagelab_passwd)}})}))}self.addEventListener("install",(function(){self.skipWaiting()})),self.addEventListener("message",(function(t){const n=t.data||{code:0,msg:{}};var s;9965===n.code&&n.msg.reportUrl&&(a=n.msg.reportUrl),9999===n.code&&(s=n.msg,i((t=>{e(t,s.data,{headers:{Authorization:s.Authorization}})}))),6666===t.data.code&&r([{type:"msg_status",msg_id:n.msg.msg_id,result:3018}],n.msg)})),self.addEventListener("activate",(function(){return self.clients.claim()})),self.addEventListener("notificationclick",(function(e){const t=e.notification.data;if(t){const n="MTPush"===(t.engagelab_mesg_type||t.mtpush_mesg_type)?"MTPush":"W3Push";r([{type:"msg_status",msg_id:e.notification.tag,result:3002}],t,n);let s=(null==t?void 0:t.engagelab_url)||(null==t?void 0:t.mtpush_url);e.action&&t.engagelab_action_urls&&t.engagelab_action_urls[e.action]&&(s=t.engagelab_action_urls[e.action]),s&&(e.notification.close(),e.waitUntil(self.clients.openWindow(s)))}})),self.addEventListener("notificationclose",(function(e){})),self.addEventListener("push",(function(e){if(!e.data)return;const t=e.data.json();var n;if(t.locationTestDempWebPush52755665)self.registration.showNotification(t.title,t);else if(r([{type:"msg_status",msg_id:t.tag,result:3001}],t.data),self.clients.matchAll().then((e=>{e&&e.length&&e.forEach((e=>{e.postMessage(t)}))})),(n=t.data.ntf_or_msg)&&(1===n||3===n)){r([{type:"msg_status",msg_id:t.tag,result:3018}],t.data);const n=self.registration.showNotification(t.title,t);e.waitUntil(n)}}))})();