(()=>{"use strict";var e={367:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BlockMirrorDefender=void 0;var o=r(115),a=function(e,t,r,a,c){var s=this;this.mirrorChecker=e,this.timeTracker=t,this.mirrorFinder=r,this.serviceWorkerStorage=a,this.metricsTracker=c,this.checkIsAvailableCurrentMirror=function(){return n(s,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.mirrorChecker.isCurrentAvailable()];case 1:return e.sent()?[2,!0]:[4,new Promise((function(e){return setTimeout(e,o.DELAY_BETWEEN_PING)}))];case 2:return e.sent(),[4,this.mirrorChecker.isCurrentAvailable()];case 3:return[2,e.sent()]}}))}))},this.initialize=function(){return n(s,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.timeTracker.addTimeTrack("FETCH_START"),[4,this.serviceWorkerStorage.get("swMetrics")];case 1:return(e=t.sent())?[4,this.metricsTracker.addMetricsToQueue(JSON.parse(decodeURIComponent(e)))]:[3,4];case 2:return t.sent(),[4,this.serviceWorkerStorage.delete("swMetrics")];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},this.checkIsAwailableRedirectByTime=function(e){return void 0===e&&(e=0),!e||Date.now()-e>=o.REDIRECTOR_BLOCK_TIME},this.checkAndRedirectIfNeedToMirror=function(){return n(s,void 0,void 0,(function(){var e,t,r,n,o;return i(this,(function(i){switch(i.label){case 0:return this.initialize(),[4,this.checkIsAvailableCurrentMirror()];case 1:return i.sent()?(this.timeTracker.clear(),this.metricsTracker.sendMetrics(),[2]):[4,Promise.all([this.serviceWorkerStorage.get("lastRedirected"),this.serviceWorkerStorage.get("sWRedirectorUrl"),this.serviceWorkerStorage.get("refCode")])];case 2:return e=i.sent(),t=e[0],r=e[1],n=e[2],this.checkIsAwailableRedirectByTime(t)?[4,this.mirrorFinder.getAvailableMirror({sWRedirectorUrl:r})]:[3,5];case 3:return o=i.sent(),[4,this.mirrorFinder.redirect(o,{refCode:n})];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},this.mirrorChecker=e,this.timeTracker=t,this.mirrorFinder=r,this.serviceWorkerStorage=a,this.metricsTracker=c};t.BlockMirrorDefender=a},492:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsTracker=void 0;var o=function(){function e(){this.TRACK_URL="/metrics-tracker/track",this.metricsQueue=[]}return e.prototype.addMetricsToQueue=function(e){this.metricsQueue=i(i([],this.metricsQueue,!0),e,!0)},e.prototype.sendMetrics=function(){return r(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.metricsQueue.length?[4,fetch(this.TRACK_URL,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(this.metricsQueue)})]:[2,!1];case 1:return t.sent(),this.metricsQueue=[],[2,!0];case 2:return e=t.sent(),console.error("send metrics fail:",e),[2,!1];case 3:return[2]}}))}))},e.prototype.getMetricsFromQueue=function(){return this.metricsQueue},e}();t.MetricsTracker=o},458:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.MirrorChecker=void 0;var i=function(){function e(e,t){this.metricsTracker=e,this.pingPathname="blank.gif",this.currentOrigin="",this.metricsTracker=e,this.currentOrigin=t}return e.prototype.isAvailable=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,fetch("".concat(e,"/").concat(this.pingPathname))];case 1:if("image/gif"!==r.sent().headers.get("Content-Type"))throw new Error("incorrect ping responce");return console.info("echo responce: OK"),this.metricsTracker.addMetricsToQueue([{eventName:"pingMirrorOk",label:e,value:1,eventType:"count"}]),[2,!0];case 2:return t=r.sent(),console.error("echo responce fail:",t),this.metricsTracker.addMetricsToQueue([{eventName:"pingMirrorFail",label:e,value:1,eventType:"count"}]),[2,!1];case 3:return[2]}}))}))},e.prototype.isCurrentAvailable=function(){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this.isAvailable(this.currentOrigin)];case 1:return[2,e.sent()]}}))}))},e}();t.MirrorChecker=i},834:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MirrorFinder=void 0;var c=r(115),s=a(r(672)),u=function(e,t,r,a,u){var l=this;this.mirrorChecker=e,this.timeTracker=t,this.serviceWorkerStorage=r,this.urlRedirector=a,this.metricsTracker=u,this.getRedirectDelay=function(e){var t=c.DELAY_BEFORE_REDIRECT-(Date.now()-e);return t<0?0:t},this.getAvailableMirror=function(e){var t=e.sWRedirectorUrl;return i(l,void 0,void 0,(function(){var e,r,n,i,a,c,u,l=this;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,7,,8]),[4,fetch((0,s.default)(t))];case 1:return[4,o.sent().text()];case 2:return e=o.sent(),[4,atob(e)];case 3:return r=o.sent(),[4,JSON.parse(r)];case 4:return[4,o.sent().map((function(e){return(0,s.default)(e)}))];case 5:return n=o.sent(),[4,Promise.all(n.map((function(e){return l.mirrorChecker.isAvailable(e)})))];case 6:if(i=o.sent(),!(a=n.filter((function(e,t){return i[t]}))))throw new Error("No available mirrors found");return c=Math.floor(Math.random()*a.length),[2,a[c]||null];case 7:return u=o.sent(),console.error("ERROR DURING REQUEST ".concat(u)),[2,null];case 8:return[2]}}))}))},this.redirect=function(e,t){return i(l,void 0,void 0,(function(){var r,a=this;return o(this,(function(c){return r=this.getRedirectDelay(this.timeTracker.getTimeTrack("FETCH_START")),setTimeout((function(){return i(a,void 0,void 0,(function(){var r,i,a,c,s;return o(this,(function(o){switch(o.label){case 0:return r=Date.now(),this.timeTracker.clear(),[4,this.urlRedirector.isAvailableRedirect()];case 1:return i=o.sent(),e&&i?[4,this.serviceWorkerStorage.set("lastRedirected",r)]:[2];case 2:return o.sent(),[4,this.metricsTracker.addMetricsToQueue([{eventName:"redirectTo",label:e,value:1,eventType:"count"}])];case 3:return o.sent(),[4,this.metricsTracker.getMetricsFromQueue()];case 4:return a=o.sent(),c=new URLSearchParams(n(n({},t),{lastRedirected:String(r),swMetrics:encodeURIComponent(JSON.stringify(a))})),s="".concat(e,"?").concat(c.toString()),this.urlRedirector.redirect(s),[2]}}))}))}),r),[2]}))}))},this.mirrorChecker=e,this.serviceWorkerStorage=r,this.urlRedirector=a,this.metricsTracker=u};t.MirrorFinder=u},989:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerStorage=void 0;var i=function(){function e(){}return e.prototype.get=function(t){return r(this,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,caches.open(e.cacheName)];case 1:return[4,r.sent().match("/".concat(t))];case 2:return[4,r.sent().json()];case 3:return[2,r.sent()];case 4:return r.sent(),[2,null];case 5:return[2]}}))}))},e.prototype.set=function(t,i){return r(this,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,caches.open(e.cacheName)];case 1:return[4,n.sent().put("/".concat(t),new Response(JSON.stringify(i)))];case 2:return[2,n.sent()];case 3:return r=n.sent(),console.log(r),[3,4];case 4:return[2]}}))}))},e.prototype.delete=function(t){return r(this,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,caches.open(e.cacheName)];case 1:return[4,n.sent().delete("/".concat(t))];case 2:return[2,n.sent()];case 3:return r=n.sent(),console.log(r),[3,4];case 4:return[2]}}))}))},e.cacheName="ServiceWorkerStorage",e}();t.ServiceWorkerStorage=i},605:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeTracker=void 0;var r=function(){function e(){var e=this;this._timeTracks={},this.addTimeTrack=function(t){e._timeTracks[t]=Date.now()},this.getTimeTrack=function(t){return e._timeTracks[t]},this.clear=function(){e._timeTracks={}}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e}();t.TimeTracker=r},745:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UrlRedirector=void 0;var a=o(r(573)),c=function(){function e(){}return e.prototype.redirect=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,a.default.clients.matchAll({type:"window",includeUncontrolled:!0})];case 1:return t.sent().forEach((function(t){"navigate"in t&&t.navigate(e)})),[2]}}))}))},e.prototype.isAvailableRedirect=function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,a.default.clients.matchAll({type:"window",includeUncontrolled:!0})];case 1:return(e=t.sent()).length||console.warn("No available windows"),[4,Boolean(e.length)];case 2:return[2,t.sent()]}}))}))},e}();t.UrlRedirector=c},115:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DELAY_BEFORE_REDIRECT=t.DELAY_BETWEEN_PING=t.REDIRECTOR_BLOCK_TIME=void 0,t.REDIRECTOR_BLOCK_TIME=144e5,t.DELAY_BETWEEN_PING=1e3,t.DELAY_BEFORE_REDIRECT=4e3},670:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(989),c=r(367),s=r(458),u=r(605),l=r(834),f=r(745),h=r(492),d=o(r(573)),p=new a.ServiceWorkerStorage;d.default.addEventListener("fetch",(function(e){return n(void 0,void 0,void 0,(function(){var t,r,n,o,a,d,v,y,b;return i(this,(function(i){return"GET"===e.request.method&&(null===(b=null===(y=null===(v=null==e?void 0:e.request)||void 0===v?void 0:v.headers)||void 0===y?void 0:y.get("accept"))||void 0===b?void 0:b.includes("text/html"))&&(t=new URL(e.request.url).origin,r=new h.MetricsTracker,n=new s.MirrorChecker(r,t),o=new u.TimeTracker,a=new f.UrlRedirector,d=new l.MirrorFinder(n,o,p,a,r),new c.BlockMirrorDefender(n,o,d,p,r).checkAndRedirectIfNeedToMirror()),[2]}))}))})),addEventListener("message",(function(e){if(console.info("Message FROM PAGE received: ".concat(JSON.stringify(e.data))),"REDIRECT_DATA"===e.data.type&&Object.keys(e.data.values).forEach((function(t){(new a.ServiceWorkerStorage).set(t,e.data.values[t])})),"METRICS_DATA"===e.data.type){var t=new h.MetricsTracker;t.addMetricsToQueue(JSON.parse(decodeURIComponent(e.data.values.swMetrics))),t.sendMetrics()}})),d.default.addEventListener("install",(function(e){d.default.skipWaiting()})),d.default.addEventListener("push",(function(e){if(d.default.Notification&&"granted"===d.default.Notification.permission){var t=null;try{e.data&&(t=e.data.json())}catch(e){return console.log(e),!1}t&&e.waitUntil(function(e){var t="",r={};if(e){if(t=e.notification.title,r={body:e.notification.message,icon:e.notification.icon,tag:e.notification.tag,requireInteraction:!0,data:{url:e.notification.url}},e.actions)for(var n in r.actions=[],e.actions)r.actions.push(e.actions[n]),r.data[n]=e.actions[n].url;e.notification.image&&(r.image=e.notification.image)}return d.default.registration.showNotification(t,r)}(t))}})),d.default.refreshNotifications=function(e){void 0===e?d.default.clients.matchAll({type:"window"}).then((function(e){d.default.refreshNotifications(e)})):e.forEach((function(e){e.url.search(/notifications/i)>=0&&e.postMessage("reload"),e.postMessage("refreshNotifications")}))},d.default.addEventListener("notificationclick",(function(e){console.log("Notification click: tag ",e.notification.tag),console.log("Notification click: url ",e.notification.data.url);var t=e.notification.data.url;if(e.notification.close(),e.action){var r=e.action.split("_")[1];t=e.notification.data[r]}e.waitUntil(d.default.clients.matchAll({type:"window"}).then((function(e){if(e.forEach((function(e){e.url===t&&"focus"in e&&e.focus()})),d.default.clients.openWindow)return d.default.clients.openWindow(t)})))}))},573:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=self},672:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.startsWith("/"),r=/^https?:\/\//i.test(e);return t||r?e:"https://".concat(e)}}},t={};(function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports})(670)})();