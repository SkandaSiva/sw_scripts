!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("GrowServiceWorker",[],e):"object"==typeof exports?exports.GrowServiceWorker=e():t.GrowServiceWorker=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{a(n.next(t))}catch(t){r(t)}}function c(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}a((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=i(1),r=i(2),s=i(3),c=i(4);const a=new class{constructor(){this.serverUrl="https://cartbite-api.staqlab.com/grow/api",this.registration=self.registration}init(){return n(this,void 0,void 0,(function*(){self.addEventListener("notificationclick",t=>t.waitUntil(this.onClick(t))),self.addEventListener("notificationclose",t=>t.waitUntil(this.onCloseEvt(t))),self.addEventListener("push",t=>t.waitUntil(this.onPushEvt(t))),self.addEventListener("install",t=>this.onInstall(t)),self.addEventListener("activate",t=>this.onActivated(t)),self.addEventListener("pushsubscriptionchange",t=>t.waitUntil(this.onSubscriptionChange(t)))}))}updateSubscriptionOnServer(t,e){return n(this,void 0,void 0,(function*(){let i=JSON.stringify({new_auth:e,subscriberUniqueId:t});fetch(this.serverUrl+"/subscriber/pushsubscriptionchange",{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then(t=>n(this,void 0,void 0,(function*(){200===t.status&&(yield this.db.save(s.DbKeys.PushData,JSON.stringify(e)))}))).catch(t=>{console.log("Error Updating Subscription",t)})}))}onSubscriptionChange(t){return n(this,void 0,void 0,(function*(){return this.db||(this.db=yield s.DbManager.Instance()),fetch(this.serverUrl+"/subscriber/pushsubscriptionchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_endpoint:t.oldSubscription?t.oldSubscription.endpoint:null,new_auth:t.newSubscription?t.newSubscription.toJSON():null})})}))}onCloseEvt(t){return n(this,void 0,void 0,(function*(){r.default.debug(t)}))}onPushEvt(t){var e;return n(this,void 0,void 0,(function*(){r.default.debug(t);const i=null===(e=t.data)||void 0===e?void 0:e.json();return i?self.registration.showNotification(i.title,{body:i.body,icon:i.iconUrl,badge:i.badge,vibrate:void 0,image:i.heroImageUrl,silent:!1,requireInteraction:i.requireInteraction,actions:o.NotificationMessage.parseActions(i),data:i}):self.registration.showNotification("Get Latest Updates",{body:"Checkout Latest offers",icon:i.iconUrl})}))}onClick(t){return n(this,void 0,void 0,(function*(){r.default.debug("Notification was clicked"+JSON.stringify(t.notification.data)),t.notification.close();const e=t.notification.data;if(e)return!t.action&&e.url?yield self.clients.openWindow(e.url):t.action?yield self.clients.openWindow(t.action):void 0}))}onInstall(t){return n(this,void 0,void 0,(function*(){r.default.info("Service Worker Installed"),t.waitUntil(self.skipWaiting())}))}onActivated(t){return n(this,void 0,void 0,(function*(){r.default.info("Service Worker Activated"),t.waitUntil(self.clients.claim())}))}sendPost(t,e){return n(this,void 0,void 0,(function*(){try{yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.log("Error sending click notification",t)}}))}isSubscriptionBelongToGrow(t){return n(this,void 0,void 0,(function*(){try{const e={userVisibleOnly:!0,applicationServerKey:c.HelperUtils.urlBase64ToUint8Array(t)};let i=yield self.registration.pushManager.subscribe(e);return console.log("subs",i),i}catch(t){return console.log("error in checking subscription for grow",t),-1}}))}};a.init(),e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationMessage=void 0;e.NotificationMessage=class{static parseActions(t){return t.buttons&&0!==t.buttons.length?t.buttons.sort((t,e)=>-1*(t.order-e.order)).map(t=>({action:t.url,title:t.label,icon:t.iconUrl})):[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static debug(...t){console.debug(t)}static info(...t){console.info(t)}static error(...t){console.error(t)}static warn(...t){console.warn(t)}}},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{a(n.next(t))}catch(t){r(t)}}function c(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,c)}a((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.DbKeys=e.DbManager=void 0;class o{constructor(){this.cookiePeriod=31104e3}static Instance(){return n(this,void 0,void 0,(function*(){return o.instance||(o.instance=new o),o.instance}))}save(t,e){return n(this,void 0,void 0,(function*(){let i=!1;window.initVar.checkForCookies&&window.Shopify.customerPrivacy&&(window.Shopify.customerPrivacy.analyticsProcessingAllowed()&&window.Shopify.customerPrivacy.preferencesProcessingAllowed()||[r.LastOptInAt].some(e=>e===t)||(i=!0)),window.initVar.skipAddingCookies&&(i=!0),i?o.cookies.push({key:t,value:e}):document.cookie=`${t}=${e};max-age=${this.cookiePeriod};path=/`}))}find(t){return n(this,void 0,void 0,(function*(){return o.cookies.find(e=>e.key===t)?o.cookies.find(e=>e.key===t).value:this.getcookie(t)}))}findValue(t){return n(this,void 0,void 0,(function*(){let e=yield this.getcookie(t);return e||null}))}clear(t){return n(this,void 0,void 0,(function*(){document.cookie=t+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}))}getcookie(t=""){let e=document.cookie,i={};if(e=e.split(";"),""!==e[0]||void 0!==e[0][0])return e.forEach((function(t){" "===(t=t.split(/=(.+)/))[0].substr(0,1)&&(t[0]=t[0].substr(1)),i[t[0]]=t[1]})),""!==t?i[t]:i}}e.DbManager=o,o.cookies=[];class r{}e.DbKeys=r,r.SubscriberId="gw-subId",r.ClientId="gw-clientId",r.NotificationsClicked="gw-notifications-clicked",r.PushData="gw-push",r.VapidPublicKey="gw-vapid-public",r.IsActive="gw-isActive-"+parseInt((new Date).valueOf()-(new Date).valueOf()%6e5),r.LastOptInAt="gw-lastOptInAt"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HelperUtils=void 0;e.HelperUtils=class{static urlBase64ToUint8Array(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(e),n=new Uint8Array(i.length);for(let t=0;t<i.length;++t)n[t]=i.charCodeAt(t);return n}static sleep(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}static getValueIfExist(t){try{return t()}catch(t){return}}static isPushSimilar(t,e){return t.endpoint===e.endpoint&&t.keys.p256dh===e.keys.p256dh&&t.keys.auth===e.keys.auth}}}])}));