var re=Object.create;var A=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var de=(t,e)=>()=>(t&&(e=t(t=0)),e);var he=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),B=(t,e)=>{for(var n in e)A(t,n,{get:e[n],enumerable:!0})},fe=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ce(e))!ue.call(t,o)&&o!==n&&A(t,o,{get:()=>e[o],enumerable:!(i=ae(e,o))||i.enumerable});return t};var pe=(t,e,n)=>(n=t!=null?re(le(t)):{},fe(e||!t||!t.__esModule?A(n,"default",{value:t,enumerable:!0}):n,t));var c=de(()=>{});var H=he((qe,j)=>{"use strict";c();var ye=Object.prototype.hasOwnProperty,m="~";function k(){}Object.create&&(k.prototype=Object.create(null),new k().__proto__||(m=!1));function ge(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function Q(t,e,n,i,o){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new ge(n,i||t,o),r=m?m+e:e;return t._events[r]?t._events[r].fn?t._events[r]=[t._events[r],s]:t._events[r].push(s):(t._events[r]=s,t._eventsCount++),t}function P(t,e){--t._eventsCount===0?t._events=new k:delete t._events[e]}function p(){this._events=new k,this._eventsCount=0}p.prototype.eventNames=function(){var e=[],n,i;if(this._eventsCount===0)return e;for(i in n=this._events)ye.call(n,i)&&e.push(m?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};p.prototype.listeners=function(e){var n=m?m+e:e,i=this._events[n];if(!i)return[];if(i.fn)return[i.fn];for(var o=0,s=i.length,r=new Array(s);o<s;o++)r[o]=i[o].fn;return r};p.prototype.listenerCount=function(e){var n=m?m+e:e,i=this._events[n];return i?i.fn?1:i.length:0};p.prototype.emit=function(e,n,i,o,s,r){var l=m?m+e:e;if(!this._events[l])return!1;var a=this._events[l],u=arguments.length,h,d;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),u){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,n),!0;case 3:return a.fn.call(a.context,n,i),!0;case 4:return a.fn.call(a.context,n,i,o),!0;case 5:return a.fn.call(a.context,n,i,o,s),!0;case 6:return a.fn.call(a.context,n,i,o,s,r),!0}for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];a.fn.apply(a.context,h)}else{var w=a.length,C;for(d=0;d<w;d++)switch(a[d].once&&this.removeListener(e,a[d].fn,void 0,!0),u){case 1:a[d].fn.call(a[d].context);break;case 2:a[d].fn.call(a[d].context,n);break;case 3:a[d].fn.call(a[d].context,n,i);break;case 4:a[d].fn.call(a[d].context,n,i,o);break;default:if(!h)for(C=1,h=new Array(u-1);C<u;C++)h[C-1]=arguments[C];a[d].fn.apply(a[d].context,h)}}return!0};p.prototype.on=function(e,n,i){return Q(this,e,n,i,!1)};p.prototype.once=function(e,n,i){return Q(this,e,n,i,!0)};p.prototype.removeListener=function(e,n,i,o){var s=m?m+e:e;if(!this._events[s])return this;if(!n)return P(this,s),this;var r=this._events[s];if(r.fn)r.fn===n&&(!o||r.once)&&(!i||r.context===i)&&P(this,s);else{for(var l=0,a=[],u=r.length;l<u;l++)(r[l].fn!==n||o&&!r[l].once||i&&r[l].context!==i)&&a.push(r[l]);a.length?this._events[s]=a.length===1?a[0]:a:P(this,s)}return this};p.prototype.removeAllListeners=function(e){var n;return e?(n=m?m+e:e,this._events[n]&&P(this,n)):(this._events=new k,this._eventsCount=0),this};p.prototype.off=p.prototype.removeListener;p.prototype.addListener=p.prototype.on;p.prefixed=m;p.EventEmitter=p;typeof j<"u"&&(j.exports=p)});c();c();function I(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function me(t,e){let n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);let i=I(n);return(o,s)=>i.then(r=>s(r.transaction(e,o).objectStore(e)))}var M;function z(){return M||(M=me("keyval-store","keyval")),M}function T(t,e=z()){return e("readonly",n=>I(n.get(t)))}function V(t,e,n=z()){return n("readwrite",i=>(i.put(e,t),I(i.transaction)))}c();c();c();var J=pe(H(),1);c();var U=function(t,e){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},U(t,e)};function Y(t,e){U(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function be(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function we(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),o,s=[],r;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function _e(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(we(arguments[e]));return t}var Z=function(){function t(e,n){this.target=n,this.type=e}return t}(),ve=function(t){Y(e,t);function e(n,i){var o=t.call(this,"error",i)||this;return o.message=n.message,o.error=n,o}return e}(Z),Te=function(t){Y(e,t);function e(n,i,o){n===void 0&&(n=1e3),i===void 0&&(i="");var s=t.call(this,"close",o)||this;return s.wasClean=!0,s.code=n,s.reason=i,s}return e}(Z);var xe=function(){if(typeof WebSocket<"u")return WebSocket},Ce=function(t){return typeof t<"u"&&!!t&&t.CLOSING===2},v={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},We=function(){function t(e,n,i){var o=this;i===void 0&&(i={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(s){o._debug("open event");var r=o._options.minUptime,l=r===void 0?v.minUptime:r;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout(function(){return o._acceptOpen()},l),o._ws.binaryType=o._binaryType,o._messageQueue.forEach(function(a){return o._ws.send(a)}),o._messageQueue=[],o.onopen&&o.onopen(s),o._listeners.open.forEach(function(a){return o._callEventListener(s,a)})},this._handleMessage=function(s){o._debug("message event"),o.onmessage&&o.onmessage(s),o._listeners.message.forEach(function(r){return o._callEventListener(s,r)})},this._handleError=function(s){o._debug("error event",s.message),o._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),o.onerror&&o.onerror(s),o._debug("exec error listeners"),o._listeners.error.forEach(function(r){return o._callEventListener(s,r)}),o._connect()},this._handleClose=function(s){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(s),o._listeners.close.forEach(function(r){return o._callEventListener(s,r)})},this._url=e,this._protocols=n,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(n,i){return typeof i=="string"?n+=i.length:i instanceof Blob?n+=i.size:n+=i.byteLength,n},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,n)},t.prototype.reconnect=function(e,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,n),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var n=this._options.maxEnqueuedMessages,i=n===void 0?v.maxEnqueuedMessages:n;this._messageQueue.length<i&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,n){this._listeners[e]&&this._listeners[e].push(n)},t.prototype.dispatchEvent=function(e){var n,i,o=this._listeners[e.type];if(o)try{for(var s=be(o),r=s.next();!r.done;r=s.next()){var l=r.value;this._callEventListener(e,l)}}catch(a){n={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return!0},t.prototype.removeEventListener=function(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(i){return i!==n}))},t.prototype._debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._options.debug&&console.log.apply(console,_e(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,n=e.reconnectionDelayGrowFactor,i=n===void 0?v.reconnectionDelayGrowFactor:n,o=e.minReconnectionDelay,s=o===void 0?v.minReconnectionDelay:o,r=e.maxReconnectionDelay,l=r===void 0?v.maxReconnectionDelay:r,a=0;return this._retryCount>0&&(a=s*Math.pow(i,this._retryCount-1),a>l&&(a=l)),this._debug("next delay",a),a},t.prototype._wait=function(){var e=this;return new Promise(function(n){setTimeout(n,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var n=e();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,i=n.maxRetries,o=i===void 0?v.maxRetries:i,s=n.connectionTimeout,r=s===void 0?v.connectionTimeout:s,l=n.WebSocket,a=l===void 0?xe():l;if(this._retryCount>=o){this._debug("max retries reached",this._retryCount,">=",o);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!Ce(a))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(u){e._closeCalled||(e._debug("connect",{url:u,protocols:e._protocols}),e._ws=e._protocols?new a(u,e._protocols):new a(u),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},r))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ve(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,n){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,n),this._handleClose(new Te(e,n,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,n){"handleEvent"in n?n.handleEvent(e):n(e)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();c();var L={};B(L,{APIClient:()=>D,isAPIError:()=>Ee});c();c();c();var S={"drive/files/create":"multipart/form-data"};var X=Symbol();function Ee(t){return t[X]===!0}var D=class{origin;credential;fetch;constructor(e){this.origin=e.origin,this.credential=e.credential,this.fetch=e.fetch??((...n)=>fetch(...n))}assertIsRecord(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}assertSpecialEpReqType(e){return e in S}request(e,n={},i){return new Promise((o,s)=>{let r="application/json";this.assertSpecialEpReqType(e)&&S[e]!=null&&(r=S[e]);let l="{}";if(r==="application/json")l=JSON.stringify({...n,i:i!==void 0?i:this.credential});else if(r==="multipart/form-data"){l=new FormData;let a=i!==void 0?i:this.credential;if(a!=null&&l.append("i",a),this.assertIsRecord(n))for(let u in n){let h=n[u];h!=null&&(h instanceof File||h instanceof Blob?l.append(u,h):typeof h=="object"?l.append(u,JSON.stringify(h)):l.append(u,h))}}this.fetch(`${this.origin}/api/${e}`,{method:"POST",body:l,headers:{"Content-Type":r},credentials:"omit",cache:"no-cache"}).then(async a=>{let u=a.status===204?null:await a.json();a.status===200||a.status===204?o(u):s({[X]:!0,...u.error})}).catch(s)})}};c();c();c();var E={};B(E,{parse:()=>Pe,toString:()=>Se});c();function Pe(t){let e=t;e.startsWith("@")&&(e=e.substring(1));let n=e.split("@",2);return{username:n[0],host:n[1]||null}}function Se(t){return t.host==null?t.username:`${t.username}@${t.host}`}c();c();c();c();function te(t){let e=Array.from(t).map(n=>n.codePointAt(0)?.toString(16)).filter(n=>n!==void 0);return e.includes("200d")||(e=e.filter(n=>n!=="fe0f")),e=e.filter(n=>n.length!==0),e.join("-")}c();c();async function O(t){let e=await T("accounts");if(!e){console.log("Accounts are not recorded");return}return e.find(n=>n.id===t)}c();function ne(t,e){let n=new URL(t,origin);return n.searchParams.set("loginId",e),n.toString()}var q=new L.APIClient({origin,fetch:(...t)=>fetch(...t)});async function x(t,e,n){let i;if(!(e&&(i=await O(e),!i)))return q.request(t,n,i?.token)}var $=new Map;function R(t){return $.get(t)?Promise.resolve():($.set(t,!0),new Promise(e=>{setTimeout(()=>{$.set(t,!1),x("notifications/mark-all-as-read",t).then(e,e)},1e3)}))}function F(t,e){return _("push",`/@${t}`,e,{acct:t})}function K(t,e){return _("push",`/notes/${t}`,e,{noteId:t})}function ie(t,e){return _("push",`/timeline/antenna/${t}`,e,{antennaId:t})}async function oe(t,e){let n="/share",i=new URLSearchParams;return t.initialText&&i.set("text",t.initialText),t.reply&&i.set("replyId",t.reply.id),t.renote&&i.set("renoteId",t.renote.id),_("post",`${n}?${i}`,e,{options:t})}async function _(t,e,n,i={}){let o=await Oe();return o?(o.postMessage({type:"order",...i,order:t,loginId:n,url:e}),o):globalThis.clients.openWindow(n?ne(e,n):e)}async function Oe(){return(await globalThis.clients.matchAll({type:"window"})).find(e=>!new URL(e.url).searchParams.has("zen"))??null}c();c();var N=class{constructor(e,n=!1){this.locale=e;this.devMode=n,this.t=this.t.bind(this)}tsxCache;devMode;get ts(){if(this.devMode){class e{get(i,o){let s=i[o];if(typeof s=="object")return new Proxy(s,new e);if(typeof s=="string"){let r=Array.from(s.matchAll(/\{(\w+)\}/g),([,l])=>l);return r.length&&console.error(`Missing locale parameters: ${r.join(", ")} at ${String(o)}`),s}return console.error(`Unexpected locale key: ${String(o)}`),o}}return new Proxy(this.locale,new e)}return this.locale}get tsx(){if(this.devMode){if(this.tsxCache)return this.tsxCache;class n{get(o,s){let r=o[s];if(typeof r=="object")return new Proxy(r,new n);if(typeof r=="string"){let l=[],a=[],u=0;for(;~u;){let h=r.indexOf("{",u);if(!~h){l.push(r.slice(u));break}l.push(r.slice(u,h));let d=r.indexOf("}",h);a.push(r.slice(h+1,d)),u=d+1}return a.length?h=>{let d=l[0];for(let w=0;w<a.length;w++)Object.hasOwn(h,a[w])||console.error(`Missing locale parameters: ${a[w]} at ${String(s)}`),d+=h[a[w]]+l[w+1];return d}:(console.error(`Unexpected locale key: ${String(s)}`),()=>r)}return console.error(`Unexpected locale key: ${String(s)}`),s}}return this.tsxCache=new Proxy(this.locale,new n)}if(this.tsxCache)return this.tsxCache;function e(n){let i={};for(let o in n){if(!Object.hasOwn(n,o))continue;let s=n[o];if(typeof s=="object")i[o]=e(s);else if(typeof s=="string"){let r=[],l=[],a=0;for(;~a;){let u=s.indexOf("{",a);if(!~u){r.push(s.slice(a));break}r.push(s.slice(a,u));let h=s.indexOf("}",u);l.push(s.slice(u+1,h)),a=h+1}if(!l.length)continue;i[o]=u=>{let h=r[0];for(let d=0;d<l.length;d++)h+=u[l[d]]+r[d+1];return h}}}return i}return this.tsxCache=e(this.locale)}t(e,n){let i=this.locale;for(let o of e.split("."))if(i=i[o],this.devMode&&typeof i>"u")return console.error(`Unexpected locale key: ${e}`),e;if(n){if(this.devMode){let o=Array.from(i.matchAll(/\{(\w+)\}/g),([,s])=>s).filter(s=>!Object.hasOwn(n,s));o.length&&console.error(`Missing locale parameters: ${o.join(", ")} at ${e}`)}for(let[o,s]of Object.entries(n)){let r=`{${o}}`;this.devMode&&(i.includes(r)||console.error(`Unexpected locale parameter: ${o} at ${e}`)),i=i.replace(r,s.toString())}}return i}};var G=class{cacheName="mk-cache-2024.10.1";lang=T("lang").then(async e=>e||"en-US");setLang(e){return this.lang=Promise.resolve(e),V("lang",e),this.fetchLocale()}i18n=null;fetchLocale(){return this.i18n=this._fetch()}async _fetch(){let e=`/assets/locales/${await this.lang}.2024.10.1.json`,n=await caches.match(e);if(!n){n=await fetch(e);let i=n.clone();if(!i.clone().ok)throw new Error("locale fetching error");caches.open(this.cacheName).then(o=>o.put(e,i))}return new N(await n.json())}},b=new G;c();function g(t){return t.name===""?t.username:t.name??t.username}var Ne=async t=>{for(let e of(await Promise.all(t.map(n=>globalThis.registration.getNotifications({tag:n})))).flat())e.close()},y=t=>`/static-assets/tabler-badges/${t}.png`;async function se(t){let e=await Ae(t);return e?globalThis.registration.showNotification(...e):(console.error("Could not compose notification",t),W())}async function Ae(t){let e=await(b.i18n??b.fetchLocale());switch(t.type){case"notification":switch(t.body.type){case"follow":{let n=await O(t.userId);if(!n)return null;let i=await q.request("users/show",{userId:t.body.userId},n.token);return[e.ts._notification.youWereFollowed,{body:g(t.body.user),icon:t.body.user.avatarUrl??void 0,badge:y("user-plus"),data:t,actions:i.isFollowing?[]:[{action:"follow",title:e.ts._notification._actions.followBack}]}]}case"mention":return[e.tsx._notification.youGotMention({name:g(t.body.user)}),{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,badge:y("at"),data:t,actions:[{action:"reply",title:e.ts._notification._actions.reply}]}];case"reply":return[e.tsx._notification.youGotReply({name:g(t.body.user)}),{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,badge:y("arrow-back-up"),data:t,actions:[{action:"reply",title:e.ts._notification._actions.reply}]}];case"renote":return[e.tsx._notification.youRenoted({name:g(t.body.user)}),{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,badge:y("repeat"),data:t,actions:[{action:"showUser",title:g(t.body.user)}]}];case"quote":return[e.tsx._notification.youGotQuote({name:g(t.body.user)}),{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,badge:y("quote"),data:t,actions:[{action:"reply",title:e.ts._notification._actions.reply},...t.body.note.visibility==="public"||t.body.note.visibility==="home"?[{action:"renote",title:e.ts._notification._actions.renote}]:[]]}];case"note":return[e.ts._notification.newNote+": "+g(t.body.user),{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,data:t}];case"reaction":{let n=t.body.reaction,i;if(n.startsWith(":")){let s=n.substring(1,n.length-1),r=new URL(`/emoji/${s}.webp`,origin);r.searchParams.set("badge","1"),i=r.href,n=s.split("@")[0]}else i=`/twemoji-badge/${te(n)}.png`;await fetch(i).then(s=>s.status!==200).catch(()=>!0)&&(i=y("plus"));let o=`reaction:${t.body.note.id}`;return[`${n} ${g(t.body.user)}`,{body:t.body.note.text??"",icon:t.body.user.avatarUrl??void 0,tag:o,badge:i,data:t,actions:[{action:"showUser",title:g(t.body.user)}]}]}case"receiveFollowRequest":return[e.ts._notification.youReceivedFollowRequest,{body:g(t.body.user),icon:t.body.user.avatarUrl??void 0,badge:y("user-plus"),data:t,actions:[{action:"accept",title:e.ts.accept},{action:"reject",title:e.ts.reject}]}];case"followRequestAccepted":return[e.ts._notification.yourFollowRequestAccepted,{body:g(t.body.user),icon:t.body.user.avatarUrl??void 0,badge:y("circle-check"),data:t}];case"achievementEarned":return[e.ts._notification.achievementEarned,{body:e.ts._achievements._types[`_${t.body.achievement}`].title,badge:y("medal"),data:t,tag:`achievement:${t.body.achievement}`}];case"login":return[e.ts._notification.login,{badge:y("login-2"),data:t}];case"exportCompleted":{let n={antenna:e.ts.antennas,blocking:e.ts.blockedUsers,clip:e.ts.clips,customEmoji:e.ts.customEmojis,favorite:e.ts.favorites,following:e.ts.following,muting:e.ts.mutedUsers,note:e.ts.notes,userList:e.ts.lists};return[e.tsx._notification.exportOfXCompleted({x:n[t.body.exportedEntity]}),{badge:y("circle-check"),data:t}]}case"pollEnded":return[e.ts._notification.pollEnded,{body:t.body.note.text??"",badge:y("chart-arrows"),data:t}];case"app":return[t.body.header??t.body.body,{body:t.body.header?t.body.body:"",icon:t.body.icon??void 0,data:t}];case"test":return[e.ts._notification.testNotification,{body:e.ts._notification.notificationWillBeDisplayedLikeThis,badge:y("bell"),data:t}];default:return null}case"unreadAntennaNote":return[e.tsx._notification.unreadAntennaNote({name:t.body.antenna.name}),{body:`${g(t.body.note.user)}: ${t.body.note.text??""}`,icon:t.body.note.user.avatarUrl??void 0,badge:y("antenna"),tag:`antenna:${t.body.antenna.id}`,data:t,renotify:!0}];default:return null}}async function W(){return new Promise(async t=>{let e=await(b.i18n??b.fetchLocale());await globalThis.registration.showNotification(new URL(origin).host,{body:"Misskey v2024.10.1",silent:!0,badge:y("null"),tag:"read_notification",actions:[{action:"markAllAsRead",title:e.ts.markAllAsRead},{action:"settings",title:e.ts.notificationSettings}],data:{}}),setTimeout(async()=>{try{await Ne(["user_visible_auto_notification"])}finally{t()}},1e3)})}globalThis.addEventListener("install",()=>{});globalThis.addEventListener("activate",t=>{t.waitUntil(caches.keys().then(e=>Promise.all(e.filter(n=>n!==b.cacheName).map(n=>caches.delete(n)))).then(()=>globalThis.clients.claim()))});async function Me(){let t=await(b.i18n??b.fetchLocale()),e={title:t.ts?._offlineScreen.title??"Offline - Could not connect to server",header:t.ts?._offlineScreen.header??"Could not connect to server",reload:t.ts?.reload??"Reload"};return`<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>${e.title}</title><style>body{background-color:#0c1210;color:#dee7e4;font-family:Hiragino Maru Gothic Pro,BIZ UDGothic,Roboto,HelveticaNeue,Arial,sans-serif;line-height:1.35;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;margin:0;padding:24px;box-sizing:border-box}.icon{max-width:120px;width:100%;height:auto;margin-bottom:20px;}.message{text-align:center;font-size:20px;font-weight:700;margin-bottom:20px}.version{text-align:center;font-size:90%;margin-bottom:20px}button{padding:7px 14px;min-width:100px;font-weight:700;font-family:Hiragino Maru Gothic Pro,BIZ UDGothic,Roboto,HelveticaNeue,Arial,sans-serif;line-height:1.35;border-radius:99rem;background-color:#b4e900;color:#192320;border:none;cursor:pointer;-webkit-tap-highlight-color:transparent}button:hover{background-color:#c6ff03}</style></head><body><svg class="icon"fill="none"height="24"stroke="currentColor"stroke-linecap="round"stroke-linejoin="round"stroke-width="2"viewBox="0 0 24 24"width="24"xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z"fill="none"stroke="none"/><path d="M9.58 5.548c.24 -.11 .492 -.207 .752 -.286c1.88 -.572 3.956 -.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486c0 .957 -.383 1.824 -1.003 2.454m-2.997 1.033h-11.343c-2.572 -.004 -4.657 -2.011 -4.657 -4.487c0 -2.475 2.085 -4.482 4.657 -4.482c.13 -.582 .37 -1.128 .7 -1.62"/><path d="M3 3l18 18"/></svg><div class="message">${e.header}</div><div class="version">v2024.10.1</div><button onclick="reloadPage()">${e.reload}</button><script>function reloadPage(){location.reload(!0)}<\/script></body></html>`}globalThis.addEventListener("fetch",t=>{let e=!1;(t.request.headers.get("sec-fetch-dest")==="document"||t.request.headers.get("accept")?.includes("/html")||t.request.url.endsWith("/"))&&(e=!0),e&&t.respondWith(fetch(t.request).catch(async()=>{let n=await Me();return new Response(n,{status:200,headers:{"content-type":"text/html"}})}))});globalThis.addEventListener("push",t=>{t.waitUntil(globalThis.clients.matchAll({includeUncontrolled:!0,type:"window"}).then(async()=>{let e=t.data?.json();switch(e.type){case"notification":case"unreadAntennaNote":if(Date.now()-e.dateTime>1e3*60*60*24)break;return se(e);case"readAllNotifications":await globalThis.registration.getNotifications().then(n=>n.forEach(i=>i.tag!=="read_notification"&&i.close()));break}await W()}))});globalThis.addEventListener("notificationclick",t=>{t.waitUntil((async()=>{let{action:e,notification:n}=t,i=n.data??{},{userId:o}=i,s=null;switch(i.type){case"notification":switch(e){case"follow":"userId"in i.body&&await x("following/create",o,{userId:i.body.userId});break;case"showUser":"user"in i.body&&(s=await F(E.toString(i.body.user),o));break;case"reply":"note"in i.body&&(s=await oe({reply:i.body.note},o));break;case"renote":"note"in i.body&&await x("notes/create",o,{renoteId:i.body.note.id});break;case"accept":switch(i.body.type){case"receiveFollowRequest":await x("following/requests/accept",o,{userId:i.body.userId});break}break;case"reject":switch(i.body.type){case"receiveFollowRequest":await x("following/requests/reject",o,{userId:i.body.userId});break}break;case"showFollowRequests":s=await _("push","/my/follow-requests",o);break;default:switch(i.body.type){case"receiveFollowRequest":s=await _("push","/my/follow-requests",o);break;case"reaction":s=await K(i.body.note.id,o);break;default:"note"in i.body?s=await K(i.body.note.id,o):"user"in i.body&&(s=await F(E.toString(i.body.user),o));break}}break;case"unreadAntennaNote":s=await ie(i.body.antenna.id,o);break;default:switch(e){case"markAllAsRead":await globalThis.registration.getNotifications().then(r=>r.forEach(l=>l.tag!=="read_notification"&&l.close())),await T("accounts").then(r=>Promise.all((r??[]).map(async l=>{await R(l.id)})));break;case"settings":s=await _("push","/settings/notifications",o);break}}s&&s.focus(),i.type==="notification"&&await R(o),n.close()})())});globalThis.addEventListener("notificationclose",t=>{let e=t.notification.data;t.waitUntil((async()=>{e.type==="notification"&&await R(e.userId)})())});globalThis.addEventListener("message",t=>{t.waitUntil((async()=>{switch(t.data){case"clear":await caches.keys().then(e=>Promise.all(e.map(n=>caches.delete(n))));return}typeof t.data=="object"&&Object.prototype.toString.call(t.data).slice(8,-1).toLowerCase()==="object"&&t.data.msg==="initialize"&&b.setLang(t.data.lang)})())});
/*! Bundled license information:

reconnecting-websocket/dist/reconnecting-websocket-mjs.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
