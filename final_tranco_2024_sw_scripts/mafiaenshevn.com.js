const cacheName="mh13",domain=self.location.hostname,proto=self.location.protocol,swap=domain.includes("hevn")?"mh":"mf",filesToCache=["/down.php","/css/main_new.css?a=down","/img/logo_"+swap+".svg"];self.addEventListener("install",(function(t){t.waitUntil(caches.open("mh13").then((function(t){return t.addAll(filesToCache)}))),self.skipWaiting()})),self.addEventListener("activate",(function(t){t.waitUntil(caches.keys().then((function(t){return Promise.all(t.map((function(t){if(-1==="mh13".indexOf(t))return caches.delete(t)})))})))})),self.addEventListener("push",(function(t){let n="No title",e="No message",i=proto+"//"+domain+"/",o="/img/logo/logo_"+swap+"_128.png",a=0,c=1,s="default";if(t.data){let d=JSON.parse(t.data.text());n=d.title,e=d.message,i=d.link,a=d.sub_id,o=d.icon,c=d.cid,s=d.tag}var d={body:e,icon:o,badge:"/img/badge-a_"+swap+".png",vibrate:[100,50,100],tag:s,data:{url:i,subId:a,cid:c}};t.waitUntil(self.registration.showNotification(n,d))})),self.addEventListener("notificationclick",(function(t){let n=t.notification.data;t.notification.close();var e=new FormData;e.append("click_notification",n.subId),e.append("cid",n.cid),fetch("/js.php?m=click_notification",{method:"POST",body:e}).then((function(t){if(!t.ok)throw new Error("Something went bad bad.");return t})),t.waitUntil(clients.matchAll({type:"window"}).then((function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.url===n.url&&"focus"in i)return i.focus()}if(clients.openWindow)return clients.openWindow(n.url)})))})),self.addEventListener("notificationclose",(function(t){let n=t.notification.data;t.notification.close();var e=new FormData;e.append("close_notification",n.subId),e.append("cid",n.cid),fetch("/js.php?m=close_notification",{method:"POST",body:e}).then((function(t){if(!t.ok)throw new Error("Something went bad bad.");return t}))})),self.addEventListener("fetch",(function(t){t.request.isHistoryNavigation||t.respondWith(caches.match(t.request).then((function(n){return n||fetch(t.request)})).catch((function(t){return console.log("Failed:",t),caches.match("/down.php")})))}));