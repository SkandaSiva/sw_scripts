function onInstall(e){console.log("[Serviceworker]","Installing!",e),e.waitUntil(caches.open(CACHE_NAME).then((function(e){return e.addAll(["","/offline.html"])})))}function onActivate(e){console.log("[Serviceworker]","Activating!",e),e.waitUntil(caches.keys().then((function(e){return Promise.all(e.filter((function(e){return 0!==e.indexOf(CACHE_VERSION)})).map((function(e){return caches.delete(e)})))})))}function onFetch(e){e.respondWith(fetch(e.request).catch((function(){return caches.match(e.request).then((function(t){return t||("navigate"===e.request.mode||"GET"===e.request.method&&e.request.headers.get("accept").includes("text/html")?(console.log("[Serviceworker]","Fetching offline content",e),caches.match("/offline.html")):void 0)}))})))}var CACHE_VERSION="v1",CACHE_NAME=CACHE_VERSION+":sw-cache-";self.addEventListener("install",onInstall),self.addEventListener("activate",onActivate),self.addEventListener("fetch",onFetch),importScripts("https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"),importScripts("https://www.gstatic.com/firebasejs/10.7.2/firebase-messaging-compat.js");const NTYPE={PSYCHIC:"psychic",ORDER_MESSAGE:"new_order_message"},SITE="https://www.kasamba.com",firebase_config={appId:"1:78665386180:web:91c5395ec1c433afffa191",apiKey:"AIzaSyAlpPebHPuqpi-6OVrJY9laMfeXqBhy94E",projectId:"kasamba-app",messagingSenderId:"78665386180"};firebase.initializeApp(firebase_config),self.addEventListener("notificationclick",(function(e){console.log("Notification is clicked: ",e);const{notification:{data:t}}=e,i=t&&t.actionLink||SITE;e.waitUntil(self.clients.claim().then((()=>self.clients.matchAll({type:"window"}))).then((e=>(console.log("Clients: ",e),e.filter((e=>(console.log("Client URL: ",e),e.url===originalUrl)))))).then((t=>t[0]?(e.notification.close(),t[0].navigate(i).then((e=>e.focus()))):(e.notification.close(),clients.openWindow(i)))))}));const hanldePsychicNotification=e=>{const{advisor_profile_picture_url:t,advisor_id:i,advisor_seo_name:n,message:s,title:a}=e;return{icon:t||"staticlogo.png",message:s,title:a,data:{actionLink:`${SITE}/psychic/${n}/`}}},handleOrderMessageNotification=e=>{const{message:t,title:i,advisor_profile_picture_url:n,order_id:s,sender_user_id:a}=e;return{icon:n||"staticlogo.png",message:t,title:i,data:{actionLink:`${SITE}/activity_list/${a}`}}},handleNotification=(e,t)=>{switch(e){case NTYPE.PSYCHIC:return hanldePsychicNotification(t);case NTYPE.ORDER_MESSAGE:return handleOrderMessageNotification(t);default:{const{message:e,title:i}=t;return{title:i,message:e,icon:"staticlogo.png"}}}};if(firebase.messaging.isSupported()){firebase.messaging().onBackgroundMessage((e=>{console.log("[firebase-messaging-sw.js] Received background message ",e);const{data:{ntype:t,...i}}=e,{message:n,icon:s,data:a,title:o}=handleNotification(t,i),c={body:n,icon:s,data:a||null};return self.registration.showNotification(o,c)}))}