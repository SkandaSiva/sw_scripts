self.addEventListener("message",i=>{i.data&&i.data.type==="SKIP_WAITING"&&self.skipWaiting()});self.addEventListener("install",()=>{self.skipWaiting()});self.addEventListener("push",i=>{let t="";const o={};if(i.data){const e=i.data.json();t=e.title,o.body=e.content,o.data=e,o.icon="/favicon.ico",o.badge="/favicon.ico",fetch(`/spi/v1/messages/${e.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"delivered",device_id:e.device_id})}).catch(console.log)}else console.log("Push message received without data."),t="Push message received without data.";i.waitUntil(self.registration.showNotification(t,o))});self.addEventListener("notificationclick",i=>{console.log("Notification clicked."),i.notification.close(),fetch(`/spi/v1/messages/${i.notification.data.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"read",device_id:i.notification.data.device_id})}).catch(console.log);const t=clients.openWindow(`${self.location.protocol}//${self.location.hostname}:${self.location.port}/alert?from_notification=true`);i.waitUntil(t)});
