
var filesToCache=[];var staticCacheName='pages-cache-vs';var updateAfterNoise=[];var updateAfterNoiseTimer=null;self.addEventListener('install',function(event){var info=location.href.match(/\d*$/);if(info){info=info[0];}else{info='0';}
console.log('SW INFO',info);staticCacheName+=info;caches.has(staticCacheName).then(function(hasCache){if(!hasCache){removeOldCaches(staticCacheName);}});event.waitUntil(caches.open(staticCacheName).then(function(cache){return cache.addAll(['/?utm_source=a2hs']);}));event.waitUntil(caches.keys().then(function(keyList){return Promise.all(keyList.map(function(key){console.log(key);}));}));});self.addEventListener('activate',function(event){console.log('SW ACTIVE');});self.addEventListener('fetch',function(event){domainRegexp=new RegExp("^"+self.registration.scope);if(event.request.method==='GET'&&domainRegexp.test(event.request.url)&&!/(admin|welcome.gif|view.gif|.php|user-settings|ldblncr|radio-api|get-radio-list-songs|get-podcast-source|live-user-count)/.test(event.request.url)){if(/(.jpg|.png|.jpeg|.webp|.svg|.ico|.eot|.svg|.ttf|.woff|.webmanifest)(\?[a-z0-9=_]*)?$/.test(event.request.url)){cacheNeedUpdate(event);}else if(/(.js|.css)(\?[a-z0-9=_]*)?$/.test(event.request.url)&&staticCacheName!="pages-cache-vs0"&&staticCacheName!="pages-cache-vs"){cacheNeedUpdate(event);}else{networkOrCache(event);}}else if(event.request.method==='GET'&&/(inmobi\.com|gtag\/js\?id|connect\.facebook\.net)/.test(event.request.url)){if(updateAfterNoise.indexOf(event.request.url)==-1){updateAfterNoise[event.request.url]=event;}
clearTimeout(updateAfterNoiseTimer);updateAfterNoiseTimer=setTimeout(function(){for(var i in updateAfterNoise){update(updateAfterNoise[i].request);}},30000);}else{}});function cacheNeedUpdate(event){event.respondWith(fromCache(event.request));}
function networkOrCache(event){event.respondWith(fromNetwork(event.request,2000).then(function(response){update(event.request,response.clone());return response;}).catch(function(err){let cacheD=fromCache(event.request,true);return cacheD;}));}
function fromCache(request,disableNetwork){var hasQuery=request.url.indexOf('?')!=-1;return caches.open(staticCacheName).then(function(cache){return cache.match(request,{ignoreSearch:hasQuery}).then(function(response){if(disableNetwork){return response;}
return response||fetch(request).then(function(response){var allowS=[200,301,302];if(response.status&&allowS.indexOf(response.status)>-1){cache.put(request,response.clone());}
return response;});});},function(reason){console.log("REJECTED CACHE",reason);});}
function update(request,response){try{if(response){caches.open(staticCacheName).then(function(cache){var allowS=[200,301,302];if(response.status&&allowS.indexOf(response.status)>-1){cache.put(request,response);}});}else{return caches.open(staticCacheName).then(function(cache){return fetch(request).then(function(response){return cache.put(request,response.clone());});});}}catch(e){console.log(e);}}
function fromNetwork(request,timeout){return new Promise(function(fulfill,reject){fetch(request).then(function(response){fulfill(response);},reject);});}
function removeOldCaches(noDelete){caches.keys().then(function(cacheNames){return Promise.all(cacheNames.filter(function(cacheName){if(noDelete!=cacheName){return true;}else{return false;}}).map(function(cacheName){console.log("REMOVE CACHE: "+cacheName);return caches.delete(cacheName);}));});}
function SWTimeout(delay){return new Promise(function(resolve,reject){setTimeout(function(){resolve(new Response('',{status:408,statusText:'Request timed out.'}));},delay);});}