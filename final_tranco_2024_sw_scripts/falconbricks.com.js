const cacheName="falconbricks-app-v1",offlineURL="/offline/";self.addEventListener("install",(e=>{e.waitUntil((async()=>{const e=await caches.open(cacheName);await e.add(new Request(offlineURL,{cache:"reload"}))})()),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil((async()=>{"navigationPreload"in self.registration&&await self.registration.navigationPreload.enable()})()),self.clients.claim()})),self.addEventListener("fetch",(e=>{if("navigate"===e.request.mode)e.respondWith((async()=>{const t=await caches.open(cacheName);try{const n=await e.preloadResponse;if(n)return t.put(e.request,n.clone()),n;const i=await fetch(e.request);return t.put(e.request,i.clone()),i}catch(n){const i=await t.match(e.request.url);if(i)return i;return await t.match(offlineURL)}})());else if("style"===e.request.destination||"script"===e.request.destination){if(!e.request.url.startsWith("https://falconbricks.com"))return;e.respondWith(caches.open(cacheName).then((t=>fetch(e.request.url).then((n=>(t.put(e.request,n.clone()),n))).catch((()=>t.match(e.request.url))))))}else{if("image"!==e.request.destination&&"font"!==e.request.destination)return;e.respondWith(caches.open(cacheName).then((t=>t.match(e.request.url).then((n=>n||fetch(e.request).then((n=>(t.put(e.request,n.clone()),n))))))))}})),self.addEventListener("push",(e=>{let t=e.data.json();const n=self.registration.showNotification(t.title,{body:t.body,icon:"https://cdn.falconbricks.com/images/app/icon-192.png",badge:"https://cdn.falconbricks.com/images/app/badge-icon-72.png",image:t.image,actions:[{action:"view",type:"button",title:"View post"},{action:"comment",type:"button",title:"Comment"}],requireInteraction:!0,data:{url:t.url}});e.waitUntil(n)})),self.addEventListener("notificationclick",(e=>{if(e.notification.close(),"comment"===e.action){const t=clients.openWindow(e.notification.data.url+"?utm_source=push#comments");e.waitUntil(t)}else{const t=clients.openWindow(e.notification.data.url+"?utm_source=push");e.waitUntil(t)}}));