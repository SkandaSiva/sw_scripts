importScripts('https://www.gstatic.com/firebasejs/3.5.2/firebase-app.js');importScripts('https://www.gstatic.com/firebasejs/3.5.2/firebase-messaging.js');importScripts('firebase-messaging-sw-config.js');self.addEventListener('install',function(event){self.skipWaiting();});var config={apiKey:"AIzaSyDBR82k9-Fl8ylwzxQG_CYyRx3VYjxI2sw",authDomain:"db88dekstop.firebaseapp.com",databaseURL:"https://db88dekstop.firebaseio.com",storageBucket:"db88dekstop.appspot.com",messagingSenderId:"796251515607"};firebase.initializeApp(config);const messaging=firebase.messaging();const icons={'1':'/88db_icon.png','2':'/btalk_icon.png','3':'/88db_icon.png','4':'/88db_icon.png',}
messaging.setBackgroundMessageHandler(function(payload){console.log('[firebase-messaging-sw-2.js] Received background message env',env,'payload',payload);var appid=payload.data.appID||'2';var eventIDs=payload.data.eventIDs||0;var icon=icons[appid];var notification=JSON.parse(payload.data.notification);var payloadCustom=JSON.parse(payload.data.payload);const notificationTitle=notification.title||'';var domain=(env=='dev')?'https://dev3.88db.com.hk':'https://88db.com.hk';var url=notification.click_action||false;if(url===false){if(eventIDs=='2005'||eventIDs=='2006'||eventIDs=='2008'){console.log('[firebase-messaging-sw.js] iwant vendor events',eventIDs);icon='/hk/images/iwant_vendor.jpg?v=1';}
else if(eventIDs=='2007'){console.log('[firebase-messaging-sw.js] iwant client events',eventIDs);icon='/hk/images/iwant_icon.png?v=1';}
if(eventIDs=="2005"||eventIDs=="2006"||eventIDs=="2007"||eventIDs=="2008"){var inviteID=payloadCustom.inviteID||'';var responseID=payloadCustom.responseID||'';var vendorMemberID=payloadCustom.vendorMemberID||'';var iWantID=payloadCustom.iWantID||'';url=`${domain}/hk/Views/iwant/NotiHandler.aspx?eventID=${eventIDs}&iWantID=${iWantID}&inviteID=${inviteID}&responseID=${responseID}&vendorMemberID=${vendorMemberID}`;}}
if(url===false){url='https://88db.com.hk/?r=sw';}
var notificationOptions={body:notification.body||'',icon:icon,data:{action:'open_url',url:url,eventIDs:eventIDs}};if(notificationTitle!=''&&notificationTitle!=undefined)
return self.registration.showNotification(notificationTitle,notificationOptions);else
return false;});self.addEventListener('notificationclick',function(event){console.log('notificationclick',event);var data=event.notification.data;if(data&&data.action){if(!data.url){data.url='https://88db.com.hk';}
if(data.url&&data.url!=''){event.notification.close();event.waitUntil(clients.matchAll({type:"window"}).then(function(clientList){for(var i=0;i<clientList.length;i++){var client=clientList[i];if(client.url=='/'&&'focus'in client)
return client.focus();}
if(clients.openWindow)
return clients.openWindow(data.url);}));}
else{event.notification.close();}}});self.addEventListener('reloadLoginHeader',function(){});