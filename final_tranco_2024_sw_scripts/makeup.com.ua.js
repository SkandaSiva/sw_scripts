var ver="v1.7";function notifyServerAboutPush(t,n){fetch("/ajax/push/"+n+"/"+t+"/",{method:"PUT",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){return t.json()}).then(function(t){}).catch(function(t){})}self.addEventListener("install",function(t){var i=new Request("/offline/");t.waitUntil(fetch(i).then(function(n){return caches.open(ver).then(function(t){return t.put(i,n)})}))}),self.addEventListener("activate",function(t){t.waitUntil(caches.keys().then(function(t){return Promise.all(t.map(function(t){if(-1===ver.indexOf(t))return caches.delete(t)}))}))}),self.addEventListener("fetch",function(t){var n=t.request,i=new URL(n.url);"GET"===n.method&&location.origin===i.origin&&t.respondWith(fetch(n).catch(function(t){return caches.open(ver).then(function(t){return t.match("/offline/")})}))}),self.addEventListener("push",function(t){var n=t.data.json(),i={badge:"/theme/site/img/app-icon/128.png",icon:"/theme/site/img/app-icon/512.png",body:n.notification.body,data:n.data,silent:!1};0<=["order","cart","new_year","happy_birthday","wish_list","push"].indexOf(n.notification.click_action)&&(notifyServerAboutPush(n.data.id,"delivered"),"wish_list"===n.notification.click_action&&(i.actions=[],n.data.products.forEach(function(t){i.actions.push({action:"product/"+t.id,title:t.name})})),t.waitUntil(self.registration.showNotification(n.notification.title,i)))}),self.addEventListener("notificationclick",function(t){if(t.notification.close(),notifyServerAboutPush(t.notification.data.id,"opened"),t.action.match(/product\/\d+/)&&clients.openWindow)return clients.openWindow(t.action);t.waitUntil(clients.matchAll({type:"window"}).then(function(t){for(var n=0;n<t.length;++n){var i=t[n];return"focus"in i?i.focus():clients.openWindow(i)}if(clients.openWindow)return clients.openWindow("/")}))}),self.addEventListener("notificationclose",function(t){notifyServerAboutPush(t.notification.data.id,"closed")});