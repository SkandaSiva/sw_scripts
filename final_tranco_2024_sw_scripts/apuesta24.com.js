!function(){var e,n,t="Unexpected state";function r(e){var n,r,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(null!=(o=Error)&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance]?o[Symbol.hasInstance](e):e instanceof o)return e;var i=new Error(t===a?"".concat(t,": ").concat(e):a);return null===(n=(r=Error).captureStackTrace)||void 0===n||n.call(r,i),i}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return o(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,void 0):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}(e=n||(n={})).ERROR="ERROR",e.WARN="WARN",e.INFO="INFO",e.DEBUG="DEBUG";var c="[service-worker]",u={sentryLogger:null,setSentryLogger:function(e){if(null!==e){this.sentryLogger=e,this.sentryLogger.normalizedParams={};var n,t,r,o=!0,a=!1,i=void 0;try{for(var c,u=e.params[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var l=c.value;Object.assign(this.sentryLogger.normalizedParams,(n={},t=l.key,r=l.value,t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n))}}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}}},debug:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;t>o;o++)r[o-1]=arguments[o];console.debug(c,e,r),this.logToSentry.apply(this,[n.DEBUG,e].concat(a(r)))},info:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;t>o;o++)r[o-1]=arguments[o];console.info(c,e,r),this.logToSentry.apply(this,[n.INFO,e].concat(a(r)))},warn:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;t>o;o++)r[o-1]=arguments[o];console.warn(c,e,r),this.logToSentry.apply(this,[n.WARN,e].concat(a(r)))},error:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;t>o;o++)r[o-1]=arguments[o];console.error(c,e,r),this.logToSentry.apply(this,[n.ERROR,e].concat(a(r)))},logToSentry:function(e,t){for(var r,o,a=this,c=arguments.length,u=new Array(c>2?c-2:0),l=2;l<c;l++)u[l-2]=arguments[l];if(null!=this.sentryLogger&&this.sentryLogger.enabled&&function(){var t;switch(null===(t=a.sentryLogger)||void 0===t?void 0:t.logLevel){case n.DEBUG:return e===n.DEBUG||e===n.INFO||e===n.WARN||e===n.ERROR;case n.INFO:return e===n.INFO||e===n.WARN||e===n.ERROR;case n.WARN:return e===n.WARN||e===n.ERROR;case n.ERROR:return e===n.ERROR;default:return!1}}()){var s=null===(r=this.sentryLogger.normalizedParams)||void 0===r?void 0:r.url,f=null===(o=this.sentryLogger.normalizedParams)||void 0===o?void 0:o.sentry_key;if(s&&f){var p,y=u.findIndex(function(e){return e&&"object"===(void 0===e?"undefined":i(e))&&"tags"in e});-1!==y&&(p=u[y],u.splice(y,1));var h={message:"".concat(e,": ").concat(t,"; ").concat(u.toString())};p&&"object"===i(p.tags)&&(h.tags=p.tags),fetch("".concat(s),{method:"POST",headers:{"Content-Type":"application/json","X-Sentry-Auth":"Sentry sentry_version=7, sentry_key=".concat(f)},body:JSON.stringify(h)}).catch(function(e){return console.error("Sentry error:",e)})}}}};function l(e){var n=!1;return Promise.race([new Promise(function(t,r){var o;(o={cache:e.cache,credentials:e.credentials,headers:e.headers,integrity:e.integrity,mode:e.mode,redirect:e.redirect,referrer:e.referrer,method:e.method},"navigate"===e.mode&&(o.mode="cors",o.cache="no-store"),fetch(e.url,o)).then(function(e){return n=!0,t(e)}).catch(function(e){r(e)})}),new Promise(function(t,r){setTimeout(function(){n?t(null):r(new Error("Request timeout of ".concat(1e4,"ms: ").concat(e.url)))},1e4)})])}function s(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function f(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function p(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e){return h.apply(this,arguments)}function h(){var e;return e=function(e){var n,t,o;return f(this,function(a){var i,c;switch(a.label){case 0:n=function(){var n,a,i;return f(this,function(c){switch(c.label){case 0:n=Date.now(),t+=1,u.debug("Request attempt: ".concat(t,"/").concat(3)),c.label=1;case 1:return c.trys.push([1,3,,7]),[4,l(e.clone())];case 2:return o=c.sent(),[2,"break"];case 3:if(a=r(c.sent()),u.error("Request error for: ".concat(e.url,". Message: ").concat(a.message)),i=Date.now()-n,!(t>3))return[3,4];throw a;case 4:return i<500?[4,new Promise(function(e){setTimeout(function(){e(!0)},500-i)})]:[3,6];case 5:c.sent(),c.label=6;case 6:return[3,7];case 7:return[2]}})},u.debug("Performing request to: ".concat(e.url,", mode - ").concat(e.mode)),t=0,o=null,a.label=1;case 1:return t<3?[5,p(n())]:[3,3];case 2:return"break"===a.sent()?[3,3]:[3,1];case 3:if(i=o,null!=(c=Response)&&"undefined"!=typeof Symbol&&c[Symbol.hasInstance]?c[Symbol.hasInstance](i):i instanceof c)return[2,o];throw u.warn("Unexpected response type"),new Error("Unexpected response")}})},(h=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function b(e){var n=e.message,t=e.url;return'<html lang="ru">\n        <head>\n          <meta charset="utf-8">\n          <meta http-equiv="X-UA-Compatible" content="IE=edge">\n          <meta name="viewport"\n            content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">\n          <title>Error</title>\n        </head>\n        <body>\n            <p>'.concat(n,'</p>\n            <p>New domain: <a href="').concat(t,'">').concat(t,'</a></p>\n            <button type="button" id="reloadButton">Reload</button>\n            <script>\n                document.getElementById(\'reloadButton\').addEventListener(\'click\', function() {\n                    location.href = "').concat(t,'";\n                });\n                location.href = "').concat(t,'";\n            </script>\n        </body>\n    </html>')}var d={};function v(){return d}function g(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function m(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){m(e,n,t[n])})}return e}function O(){return S.apply(this,arguments)}function S(){var e;return e=function(){var e,n;return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(t){var r,o;switch(t.label){case 0:return e="4eb6b7fe-4c35-4423-8528-1844ec05f56d",0===Object.keys(n=v()).length?[2,null]:[4,fetch("/api-1",{headers:new Headers((r=w({},n),o=o={"content-type":"application/json"},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):(function(e){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n.push.apply(n,t)}return n})(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}),r)),body:JSON.stringify([{id:e,query:"query getServiceWorkerConfiguration {\n  queries {\n    serviceWorker {\n      getConfiguration {\n        ts\n        data {\n          result\n          app {\n            enabled\n            isNT\n            ntMode\n            configReloadInterval\n            logger {\n              enabled\n              logLevel\n              params {\n                key\n                value\n              }\n            }\n            sentry {\n              enabled\n              params {\n                key\n                value\n              }\n            }\n            resolver {\n              enabled\n              isNT\n              maxAge\n              mode\n              redirectFallback\n              resolvers\n              customReserveOrigin\n              manuallyBlockedOrigins\n              frameCookieFixMode\n            }\n            cache {\n              excludes\n            }\n            fetchExcludes\n            customDomains\n          }\n          shell {\n            appHash\n            appUrl\n            enabled\n            isNT\n            ntMode\n          }\n        }\n      }\n    }\n  }\n}",variables:{options:{ts:0}}}]),method:"POST",mode:"cors",credentials:"include"})];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()[e].data.queries.serviceWorker.getConfiguration.data]}})},(S=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){g(a,r,o,i,c,"next",e)}function c(e){g(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function k(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function P(){return j.apply(this,arguments)}function j(){var e;return e=function(){return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(e){return[2,new Promise(function(e){var n=indexedDB.open("app",1);n.onupgradeneeded=function(){var e=n.result;e.objectStoreNames.contains("settings")||e.createObjectStore("settings")},n.onsuccess=function(){e(n.result)}})]})},(j=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){k(a,r,o,i,c,"next",e)}function c(e){k(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function x(e){return P().then(function(n){return new Promise(function(t){var r=n.transaction(["settings"],"readwrite").objectStore("settings"),o=!0,a=!1,i=void 0;try{for(var c,l=Object.keys(e)[Symbol.iterator]();!(o=(c=l.next()).done);o=!0)!function(){var n=c.value,o=r.put(e[n],n);o.addEventListener("error",function(){var e=o.error?o.error.message:"unknown error";u.error("Settings write error",e),t(!1)}),o.onsuccess=function(){u.info("Settings write success",n,JSON.stringify(e[n])),t(!0)}}()}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}})})}function E(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function R(e){return T.apply(this,arguments)}function T(){var e;return e=function(e){var n;return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(t){switch(t.label){case 0:return[4,P()];case 1:return[2,(n=t.sent()).objectStoreNames.contains("settings")?new Promise(function(t){var r=n.transaction("settings").objectStore("settings").get(e);r.onsuccess=function(){return t(r.result||null)},r.addEventListener("error",function(){var n=r.error?r.error.message:"unknown error";u.error("Settings key(".concat(e,") read error:"),n),t(null)})}):null]}})},(T=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){E(a,r,o,i,c,"next",e)}function c(e){E(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function L(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function D(){return A.apply(this,arguments)}function A(){var e;return e=function(){var e;return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(n){switch(n.label){case 0:return[4,R("settings:v1")];case 1:return(e=n.sent())?[2,e]:[2,null]}})},(A=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){L(a,r,o,i,c,"next",e)}function c(e){L(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function N(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function I(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function U(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){I(e,n,t[n])})}return e}function G(){return W.apply(this,arguments)}function W(){var e;return e=function(){var e,n,t,r;return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(o){var a,i,c,l;switch(o.label){case 0:return o.trys.push([0,4,,5]),u.info("Starting to update SW config"),[4,D()];case 1:return n=null!==(e=o.sent())&&void 0!==e?e:{},[4,O()];case 2:return(t=o.sent())?(u.setSentryLogger(t.app.logger),[4,x({"settings:v1":(a=U({},n,t.app),i=i={build:(c="production-modern",l=new Date(1732537761828).toLocaleString(),c+=", ".concat(l))},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):(function(e){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n.push.apply(n,t)}return n})(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))}),a)})]):[2];case 3:return o.sent(),[3,5];case 4:return r=o.sent(),u.error("Failed to update SW config"),u.error(r),[3,5];case 5:return[2]}})},(W=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){N(a,r,o,i,c,"next",e)}function c(e){N(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}function q(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function F(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){q(a,r,o,i,c,"next",e)}function c(e){q(a,r,o,i,c,"throw",e)}i(void 0)})}}function B(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function C(e){var n;try{var t=new URL(e);n="".concat(t.origin,"/api-2/time").concat(t.search)}catch(t){u.error("Failed to parse url: ".concat(e)),n="".concat(e.endsWith("/")?e.slice(0,-1):e,"/api-2/time")}return n}function M(e){return z.apply(this,arguments)}function z(){return(z=F(function(e){var n,t,o,a,i,c,l,s,f;return B(this,function(p){switch(p.label){case 0:if(!(e&&e.length>0))return[3,10];n=!0,t=!1,o=void 0,p.label=1;case 1:p.trys.push([1,8,9,10]),a=e[Symbol.iterator](),p.label=2;case 2:if(n=(i=a.next()).done)return[3,7];c=i.value,p.label=3;case 3:return p.trys.push([3,5,,6]),u.info("Checking custom domain",c),[4,y(new Request(C(c)))];case 4:return null!==(l=p.sent())&&l.ok?[2,c]:(u.error("Failed to check custom domain ".concat(c)),[3,6]);case 5:return s=r(p.sent()),u.error("Failed to check custom domain ".concat(c),s.message),[3,6];case 6:return n=!0,[3,2];case 7:return[3,10];case 8:return f=p.sent(),t=!0,o=f,[3,10];case 9:try{n||null==a.return||a.return()}finally{if(t)throw o}return[7];case 10:return[2,null]}})})).apply(this,arguments)}function J(e){return H.apply(this,arguments)}function H(){return(H=F(function(e){var n,t,o,a,i,c,l,s,f,p,h,b,d,v,g;return B(this,function(m){switch(m.label){case 0:return n=e.customDomains,o=(t=e.resolver).resolvers,a=t.customReserveOrigin,[4,M(n)];case 1:if(i=m.sent())return[2,i];if(a)return[2,a];if(!o.length)return[3,13];c=!0,l=!1,s=void 0,m.label=2;case 2:m.trys.push([2,11,12,13]),f=o[Symbol.iterator](),m.label=3;case 3:if(c=(p=f.next()).done)return[3,10];h=p.value,m.label=4;case 4:return m.trys.push([4,8,,9]),[4,y(new Request(h))];case 5:return null===(b=m.sent())?[3,7]:[4,b.json()];case 6:return d=JSON.parse(atob(m.sent().Answer[0].data.replace(/^"(.*)"$/,"$1").slice(5))),[2,"https://".concat(d.d[0].u)];case 7:return[3,9];case 8:return v=r(m.sent()),u.error("Reserve domain resolve error: message=".concat(v.message,"; resolver=").concat(h)),[3,9];case 9:return c=!0,[3,3];case 10:return[3,13];case 11:return g=m.sent(),l=!0,s=g,[3,13];case 12:try{c||null==f.return||f.return()}finally{if(l)throw s}return[7];case 13:return u.warn("Unable to resolve reserve domain"),[2,null]}})})).apply(this,arguments)}function $(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function _(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function X(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){_(e,n,t[n])})}return e}function K(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):(function(e){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n.push.apply(n,t)}return n})(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}var Q=0,V=null;function Y(){var e;return e=function(e){var n,t,o,a,i,c,l;return function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,function(s){switch(s.label){case 0:return n="",Q?[3,2]:[4,G()];case 1:return s.sent(),Q=Date.now(),[3,4];case 2:return Q<Date.now()-((null==V?void 0:V.configReloadInterval)||6e4)?[4,G()]:[3,4];case 3:s.sent(),s.label=4;case 4:return[4,D()];case 5:V=s.sent(),o=(t=new URL(e.url)).origin,a="navigate"===e.mode?"".concat(t.pathname):"/",s.label=6;case 6:return s.trys.push([6,10,,11]),[4,y(e)];case 7:return i=s.sent(),V?[4,x({"settings:v1":K(X({},V),{resolver:K(X({},null==V?void 0:V.resolver),{next:o})})})]:[3,9];case 8:s.sent(),s.label=9;case 9:if("navigate"===e.mode&&"GET"===e.method&&"/index.html"===a)throw a="/",new Error("Invalid HTML received");return[2,i];case 10:return c=r(s.sent()),u.error(c),n=c.message,[3,11];case 11:return V?[4,J(V)]:[3,14];case 12:return o=s.sent()||o,[4,x({"settings:v1":K(X({},V),{resolver:K(X({},null==V?void 0:V.resolver),{next:o})})})];case 13:s.sent(),s.label=14;case 14:return u.warn("BLOCKED: request url=".concat(e.url,"; resolved url=").concat(o,"; error=").concat(n),{tags:{url:"".concat(e.url),newUrl:"".concat(o)}}),l=new URL(o),[2,new Response(b({url:"".concat(l.origin).concat(a).concat(l.search),message:n}),{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})]}})},(Y=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){$(a,r,o,i,c,"next",e)}function c(e){$(a,r,o,i,c,"throw",e)}i(void 0)})}).apply(this,arguments)}self.addEventListener("fetch",function(e){var n;("navigate"===(n=e.request).mode&&"GET"===n.method||"/api-2/time"===new URL(n.url).pathname)&&e.respondWith(function(e){return Y.apply(this,arguments)}(e.request))}),self.addEventListener("install",function(){self.skipWaiting()}),self.addEventListener("activate",function(){G().then(),self.clients&&self.clients.claim&&self.clients.claim()}),self.addEventListener("message",function(e){"sw:config:update"===e.data.type&&(e.data.headers&&(d=e.data.headers),G().then()),"sw:config:get"===e.data.type&&D().then(function(n){e.ports[0].postMessage({type:"sw:config:get",config:n})})})}();