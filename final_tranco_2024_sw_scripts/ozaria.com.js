const product=new URL(location).searchParams.get("product"),isCodeCombat="codecombat"===product;var server={server:{"www.ozaria.com":"ozaria.dexecure.net","staging.ozaria.com":"ozaria-staging.dexecure.net"},firstPartyDomain:["www.ozaria.com","staging.ozaria.com"]};isCodeCombat&&(server={server:{"codecombat.com":"codecombat.dexecure.net","www.codecombat.com":"codecombat.dexecure.net","staging.codecombat.com":"codecombat-staging.dexecure.net","coco-dex.koudashijie.com":"dexecure-test.koudashijie.com"},firstPartyDomain:["codecombat.com","www.codecombat.com","staging.codecombat.com","coco-dex.koudashijie.com"]});var dexecure=Object.assign({},server,{optimisationsEnabled:!0,debugMode:!1,imageMatchRegex:"\\.jpe?g|\\.png",ignoreRegex:"(aether_worker|worker_world).js",pagesEnabled:[""]});function isFirstPartyDomain(e){for(var o=new URL(e),r=dexecure.firstPartyDomain,t=r.length-1;t>=0;t--)if(r[t].toLowerCase()==o.host.toLowerCase())return!0;return!1}function changeToDexecureURL(e){var o=new URL(e);return dexecure.debugMode&&console.log("inputURL is ",e),dexecure.debugMode&&console.log("inputURL.hostname is ",e.hostname),o.hostname=dexecure.server[o.hostname],dexecure.debugMode&&console.log("changedURL.hostname is ",o.hostname),o.pathname.startsWith("/file")&&o.searchParams.set("resize","none"),dexecure.debugMode&&console.log("changedURL is ",o.href),o.href}function isPageEnabled(e){return!0}dexecure.optimisationsEnabled&&(self.addEventListener("install",(function(e){dexecure.debugMode&&console.log("install triggered"),e.waitUntil(self.skipWaiting())})),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.claim())})),self.addEventListener("fetch",(function(e){dexecure.debugMode&&console.log("fetch triggered");var o={};e.request.headers.has("Accept")&&(o.Accept=e.request.headers.get("Accept"));var r=new Headers(o),t=new RegExp(dexecure.imageMatchRegex,"i"),a=new RegExp(dexecure.ignoreRegex,"i");if(dexecure.debugMode&&console.log("input url is ",e.request.url),isPageEnabled(e.request.referrer)&&t.test(e.request.url.toLowerCase())&&!a.test(e.request.url.toLowerCase())&&isFirstPartyDomain(e.request.url)){var c=changeToDexecureURL(e.request.url);c=decodeURIComponent(c),dexecure.debugMode&&console.log("output url is ",c),e.respondWith(fetch(c,{mode:"cors",headers:r}).then((function(o){if(o.ok)return o;throw dexecure.debugMode&&console.log("Responding with original image as optimiser was not reachable ",e.request.url),new Error("Unable to fetch optimised image")})).catch((function(o){return dexecure.debugMode&&(console.log("Sending original image as an error occured when trying to optimise ",e.request.url),console.log("The error was ",o)),fetch(e.request)})))}})));