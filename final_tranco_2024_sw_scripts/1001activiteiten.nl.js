"use strict";const CACHE_NAME="CACHE::v1",PRECACHE=[],OFFLINE_PAGE="https://www.1001activiteiten.nl/offline",IMAGE_EXT=["webp","png","jpg","jpeg","ico","svg","gif"],EXCLUDE=["/_"],CORS_DOMAINS=[];onfetch=(e=>{if("GET"!==e.request.method)return;if(-1!==e.request.headers.get("accept").indexOf("text/html"))return e.respondWith(fetch(e.request).then(e=>e,e=>caches.open(CACHE_NAME+"::resources").then(e=>e.match(OFFLINE_PAGE).then(e=>{if(e)return e}))));const t=new URL(e.request.url),s=void 0!==e.request.referrer&&e.request.referrer?new URL(e.request.referrer):t,n=s.pathname+("/"!=s.pathname.substr(-1)?"/":"");let r=!0;if(EXCLUDE.forEach(e=>{(t.pathname.startsWith(e)||n.startsWith(e))&&(r=!1)}),self.location.hostname!=t.hostname&&-1===CORS_DOMAINS.indexOf(t.hostname)&&(r=!1),!r)return;let a=getResource(t).then(e=>e);e.respondWith(a),a.then(e=>{if("fromCache"in e&&e.fromCache&&String(e.status).startsWith("20")){isFingerprinted(t.pathname)||getResource(t,!0)}},e=>{})}),oninstall=(e=>{e.waitUntil(Promise.all(PRECACHE.map(e=>{const t=new URL(e);let s=OFFLINE_PAGE==t.pathname;return getResource(t,s)})).then(()=>{self.skipWaiting().then(()=>{sendMessage("Installed")})},e=>{}))}),onactivate=(e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(!e.startsWith(CACHE_NAME))return caches.delete(e)}))).then(()=>self.clients.claim()).then(()=>{sendMessage("Activated")}))});let getResource=(e,t)=>{let s=e.toString();const n=isFingerprinted(s);n&&(s=s.replace("."+n+".","."));let r=!1;IMAGE_EXT.forEach(t=>{e.pathname.endsWith(t)&&(r=!0)});const a=CACHE_NAME+"::"+(r?"images":"resources");return caches.open(a).then(n=>n.match(s).then(r=>!0!==t&&r&&r.url==e.toString()?(r.fromCache=!0,r):fetch(e).then(e=>(String(e.status).startsWith("20")&&n.put(s,e.clone()),e))))},sendMessage=e=>{clients.matchAll().then(t=>{t.forEach(t=>{t.postMessage(e)})})},isFingerprinted=e=>{const t=/\.(fp[a-z0-9]+)(?:\.min)?\.[a-z0-9]+$/i.exec(e);return!!t&&t[1]};
