(()=>{var w=Object.defineProperty;var f=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var m=(s,t,e)=>t in s?w(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,y=(s,t)=>{for(var e in t||(t={}))v.call(t,e)&&m(s,e,t[e]);if(f)for(var e of f(t))k.call(t,e)&&m(s,e,t[e]);return s};var j=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var i=(s,t,e)=>new Promise((r,o)=>{var n=h=>{try{p(e.next(h))}catch(u){o(u)}},a=h=>{try{p(e.throw(h))}catch(u){o(u)}},p=h=>h.done?r(h.value):Promise.resolve(h.value).then(n,a);p((e=e.apply(s,t)).next())});var S=j(b=>{var c=self,E=(s,t,e)=>i(b,null,function*(){let r=yield c.clients.get(t);r&&r.postMessage({channel:s,message:e})});function P(s){return i(this,null,function*(){if(s instanceof l)return s.toSerializableObject();let t={};return Object.getOwnPropertyNames(s).concat(Object.keys(s)).forEach(r=>{var o;switch(typeof s[r]){case"number":case"boolean":case"string":t[r]=s[r];break;case"bigint":t[r]=s[r].toString();break;default:t.otherKeys=[...(o=t.otherKeys)!=null?o:[],r]}}),t})}var l=class s extends Error{constructor(t,e="Bad response"){super(e),this.type=s.name,this.response=t}getResponseBody(){try{return this.response.headers.get("content-type")==="application/json"?this.response.json():this.response.text()}catch(t){return"Failed to serialize response body: unsupported content type"}}getResponseHeaders(){let t={},e=this.response.headers.keys(),r=e.next();for(;r.value;)t[r.value]=this.response.headers.get(r.value),r=e.next();return t}toSerializableObject(){return i(this,null,function*(){return{type:this.type,message:this.message,status:this.response.status,headers:this.getResponseHeaders(),body:yield this.getResponseBody()}})}},d=class{constructor(t){this.event=t,this.url=new URL(t.request.url)}reportFetchError(o,n){return i(this,arguments,function*(t,e,r={}){E(t,this.event.clientId,y({href:this.url.href,error:yield P(e)},r))})}gtm(){let t=this.url.searchParams.get("id");if(!t)return;let[e,r]=t.split("-");this.event.stopPropagation(),this.event.respondWith(fetch(this.event.request).catch(o=>i(this,null,function*(){this.reportFetchError("gtm",o,{endpoint:"main",id:t});let n=new URL(this.url);return n.protocol=c.location.protocol,n.host=c.location.host,n.pathname=`/ta-t-m/${r}`,n.searchParams.delete("id"),n.searchParams.append("taidp",btoa(e)),fetch(n).then(a=>{if(!a.ok)throw new l(a);return a}).catch(a=>i(this,null,function*(){throw this.reportFetchError("gtm",a,{endpoint:"fallback",id:t}),a}))})))}gtag(){let t=this.url.searchParams.get("id");if(!t)return;let[e,r]=t.split("-");this.event.stopPropagation(),this.event.respondWith(fetch(this.event.request).catch(o=>i(this,null,function*(){this.reportFetchError("gtag",o,{endpoint:"main",id:t});let n=new URL(this.url);return n.protocol=c.location.protocol,n.host=c.location.host,n.pathname=`/ta-g-t/${r}`,n.searchParams.delete("id"),n.searchParams.append("taidp",btoa(e)),fetch(n).then(a=>{if(!a.ok)throw new l(a);return a}).catch(a=>i(this,null,function*(){throw this.reportFetchError("gtag",a,{endpoint:"fallback",id:t}),a}))})))}},g=class{constructor(t){this.url=new URL(t.request.url),this.event=t,this.eventHandler=new d(t)}get routeId(){if(/^https:\/\/tna(dev|stg)?\.taxnotes\.com\/gtm.js\?/.test(this.url.href))return"gtm";if(/^https:\/\/tna(dev|stg)?\.taxnotes\.com\/gtag\/js\?/.test(this.url.href))return"gtag"}route(){switch(this.routeId){case"gtm":return this.eventHandler.gtm();case"gtag":return this.eventHandler.gtag()}}},x=s=>{new g(s).route()};if(c instanceof ServiceWorkerGlobalScope)c.addEventListener("fetch",x),c.addEventListener("install",()=>c.skipWaiting());else throw Error("Sanity check failed: 'self' is not of type 'ServiceWorkerGlobalScope'")});S();})();
