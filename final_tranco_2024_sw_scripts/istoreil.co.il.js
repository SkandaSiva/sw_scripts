/* SpeedSize-worker - 21-7-2022 */
const config = {"clientId":"57482e8d-29d5-4d9f-84d5-bd696304a4e0","isAllowed":true,"innerHtmlHook":false,"ignoredFiles":["/media/wysiwyg/2022/sale/iphone/se/a15_bionic_mask_large.png"],"mLinkBaseUrl":"https://media.istoreil.co.il","format":"auto","allowedPaths":[],"ignoreDataAttributes":false,"maxDpr":1.5,"enableStatement":"","disableWorker":false,"disableAutoResize":true,"forbiddenPaths":[],"searchChildren":false,"whitelistDomains":[],"useOriginalCDN":false,"lazyload":{"hideBackgrounds":false,"blurredPlaceholders":false,"awaitWorker":false,"native":true,"hideImgElements":false,"eagerCheck":false},"processPreloadImages":false,"allowCrossOrigin":false,"disablePrototypeHooks":false} || {};
const e=1.5,n=[64,96,100,128,160,192,200,240,256,320,360,480,540,600,640,720,750,768,800,828,1024,1080,1125,1152,1170,1200,1242,1280,1284,1366,1440,1536,1600,1650,1920,2048,2256,2304,2560,2736,2880,3e3,3200,3440,3840],{navigator:t}=self,i=t.userAgent.toLowerCase(),r=t.vendor&&t.vendor.toLowerCase(),s=new URL(config.mLinkBaseUrl).hostname,o=[{mime:"image/avif",ext:".avif"},{mime:"image/webp",ext:".webp"},{mime:"image/jp2",ext:".jp2"},{mime:"image/jxr",ext:".jxr"}],c=[{mime:'video/mp4;codecs="av01"',ext:"_av1.webm"},{mime:'video/mp4;codecs="hev1.1.6.L93.B0"',ext:"_hevc.mp4"},{mime:'video/mp4;codecs="vp09.00.50.08"',ext:".webm"}],u=[".jpg",".jpeg",".png",".webp",".mp4",".webm",".mov"];function a(e){const{userAgentData:n}=t;if(!e||!n)return null;let i=null;if(n&&n.brands&&n.brands.length){const{brands:t}=n;for(let n=0;n<t.length;n+=1)if(t[n].brand===e){i=t[n].version;break}}return i}function f(){return!!a("Opera")||i.includes("opr")}function l(e,n=null){let t=a("Opera");return t=t?parseInt(t,10):parseInt(i.substring(i.indexOf("opr")).split("/")[1],10),n?t>=e&&t<=n:t>=e}function d(){return i.includes("firefox")}function g(e,n=null){const t=parseInt(i.substring(i.indexOf("firefox")).split("/")[1],10);return n?t>=e&&t<=n:t>=e}function h(){return!!a("Microsoft Edge")||i.includes("edg")}function p(e,n=null){let t=a("Microsoft Edge");return t=t?parseInt(t,10):parseInt(i.substring(i.indexOf("edg")).split("/")[1],10),n?t>=e&&t<=n:t>=e}function m(){return!(!i.includes("safari")||i.includes("chrome")||i.includes("crios"))}function v(){return m()&&i.includes("macintosh")}function x(e,n=null){const t=parseInt(i.substring(i.indexOf("version")).split("/")[1],10);return n?t>=e&&t<=n:t>=e}function b(){return i.includes("iphone")||i.includes("ipad")||i.includes("macintosh")}function w(){return i.includes("android")}function O(){return m()&&(i.includes("iphone")||i.includes("ipad"))}function I(){return i.includes("crios")}function L(e,n=null){const t=parseInt(i.split(" os")[1],10)||parseInt(i.split(" os x")[1],10);return n?t>=e&&t<=n:t>=e}function j(){return!!a("Google Chrome")||!f()&&!d()&&!h()&&!m()&&("google inc."===r||i.includes("chrome")&&w())}function E(e,n=null){let t=a("Google Chrome");return t=t?parseInt(t,10):parseInt(i.substring(i.indexOf("chrome")).split("/")[1],10),n?t>=e&&t<=n:t>=e}function R(){return h()?p(18):d()?g(65):f()?l(19):!(!O()&&!I())&&L(14)}function W(){return!!h()&&p(12,18)}function _(){return v()?x(5):!(!O()&&!I())&&L(5)}function $(){return v()?x(13):!(!O()&&!I())&&L(11)}function D(){return h()?p(79):d()?g(28):f()?l(16):!!j()&&E(25)}function k(){return!d()||b()||w()?f()?l(57):!(!j()||w())&&E(70):g(67)}function A(e){return"image"===e}function U(e){return"video"===e}function y(e,n,t){const i=(n?o:c).filter((e=>t.includes(e.mime)))[0];if(!i)return e;const r=e.split("/"),s=r[r.length-1],a=s.lastIndexOf("."),f=a>0?s.substring(a):"";if(!f)return`${e}${i.ext}`;if(!u.includes(f))return e;const l=`${s.substring(0,a)}${i.ext}`;return r[r.length-1]=l,r.join("/")}function B(){const e=[];return R()&&e.push("s_webp"),W()&&e.push("s_jxr"),_()&&e.push("s_jp2"),m()&&e.push("s_videoimg"),b()&&e.push("ns_atwebp"),d()&&e.push("ns_aavif"),e.join(",")}function C(e,n,t,i,r={}){const s=B(),o=[];Object.keys(r).forEach((e=>{o.push(`${e}_${r[e]}`)}));s&&o.push(s),config.format&&o.push(`f_${config.format}`),m()&&o.push("s_videoimg");const c=o.join(",");return`${config.mLinkBaseUrl}/${config.clientId}/${n}/${c}`}function M(e){if(!e)return!1;const n=new URL(e).hostname;return n===s||!n.endsWith(self.location.hostname)&&0!==e.indexOf(self.location.origin)}function q(e){if(e<=n[0])return n[0];if(e>=n[n.length-1])return n[n.length-1];for(let t=n.length-2;t>=0;t-=1)if(e>=n[t])return n[t+1];return null}self.addEventListener("install",(()=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(self.clients.claim())}));const z={"image/webp":R(),"image/jxr":W(),"image/jp2":_(),"video/mp4;codecs='vp09.00.50.08'":D(),"video/mp4;codecs='hev1.1.6.L93.B0'":$(),"video/mp4;codecs='av01'":k()};function F(e){let n=!1;const{hostname:t}=new URL(e);if(t===s)return!1;if(config.whitelistDomains&&config.whitelistDomains.length)for(let e=0;e<config.whitelistDomains.length;e+=1){const i=config.whitelistDomains[e];if(t.indexOf(i)>=0){n=!0;break}}return n}function S(e){let n=!1;return config.ignoredFiles.forEach((t=>{(t.endsWith("*")&&0===e.indexOf(t.substring(0,t.length-1))||t===e)&&(n=!0)})),n}let P,G=!0;function K(e){const n=parseFloat(e.headers.get("DPR")),t=parseInt(e.headers.get("Width"),10),i=parseInt(e.headers.get("Viewport-Width"),10);if(n&&i){return q((t?Math.min(t,i):i)*Math.min(n,config.maxDpr||1.5))}if(P){return q(P.vpWidth*Math.min(P.DPR,config.maxDpr||1.5))}return null}self.onmessage=function(e){const{data:n}=e;"DISABLE_WORKER"===n.type?G=!1:"ENABLE_WORKER"===n.type?G=!0:"WINDOW_PARAMS"===n.type&&(P=n.data)};const N={},V={};self.addEventListener("fetch",(async e=>{if(!G)return;if(config.disableWorkerInSafari&&m())return;const{clientId:n}=e,{destination:t,url:i,signal:r}=e.request;if(0===i.indexOf(config.mLinkBaseUrl))return;if(!A(t))return;if(!config.allowCrossOrigin&&M(i)&&!F(i))return;const s=new URL(i);let o=s.href;const{hostname:c}=s;if(s.hash&&(o=s.origin+s.pathname+s.search),s.hash&&s.hash.indexOf("speedsize-ignore")>=0||s.search&&s.search.indexOf("speedsize-ignore")>=0)return;if(s.pathname&&(s.pathname.endsWith(".ico")||"/"===s.pathname))return;if(config.ignoredFiles&&config.ignoredFiles.length&&S(s.pathname))return;const u={mode:"no-cors",signal:r};e.respondWith((async()=>{const n=e.request.headers.get("accept"),r={},a=K(e.request);!a||config.disableAutoResize||config.disableWorkerAutoResize||(r.mxw=a);const f=C(t,o,c,s.pathname,r);let l=n;Object.keys(z).forEach((e=>{!l.includes(e)&&z[e]&&(l=`${e},${l}`)}));const d={mode:"no-cors",headers:{Accept:l,"User-Agent":e.request.headers.get("user-agent")}};return config.noCORS&&delete d.mode,fetch(f,d).catch((e=>(console.log("Error fetching image: ",e),fetch(i,u))))})())}));
