(()=>{var e={775:e=>{var t=Object.prototype.hasOwnProperty;function r(e){return"[Throws: "+(e?e.message:"?")+"]"}function n(e){var n=[];return function e(o){if(null===o||"object"!=typeof o)return o;if(-1!==n.indexOf(o))return"[Circular]";if(n.push(o),"function"==typeof o.toJSON)try{var a=e(o.toJSON());return n.pop(),a}catch(e){return r(e)}if(Array.isArray(o)){var c=o.map(e);return n.pop(),c}var s=Object.keys(o).reduce((function(n,a){return n[a]=e(function(e,n){if(t.call(e,n))try{return e[n]}catch(e){return r(e)}return e[n]}(o,a)),n}),{});return n.pop(),s}(e)}e.exports=function(e,t,r){return JSON.stringify(n(e),t,r)},e.exports.ensureProperties=n}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e="ccp-generic-v1",t="ccp-product-v1",n="ccp-productdetails-v1",o={debug:0,info:1,error:2},a=Object.keys(o).reduce(((e,t)=>(e[o[t]]=t,e)),{}),c=({request:{url:e}})=>{try{const t=(async()=>({".*":"error"}||0))(),r=[],n=(n,c)=>{const s=`[${a[n].toUpperCase()}] ${(new Date).toISOString()} ${e} ${c}`;r.push((async()=>await(async(e,t,r)=>{const n=await e;let a=o.error;for(const e in n)if(new RegExp(e).test(t)){a=o[n[e]];break}return r>=a})(t,e,n)&&!console.log(s)&&s)())};return{debug:e=>n(o.debug,e),info:e=>n(o.info,e),error:e=>n(o.error,e),send:async()=>{console.error("TODO send output to logging endpoint:\n"+(await Promise.all(r)).filter((e=>!!e)).join("\n"))}}}catch(e){return console.error(`Error while initializing logger [${e}]`),{debug:console.log,info:console.log,error:console.log,send:()=>{}}}},s=async(e,t,r)=>{try{const n=await caches.open(e),o=await n.keys();if(o.length<t)return;const a={};await Promise.all(o.map((async e=>{const t=(await n.match(e)).headers.get("ccp-expires");parseInt(t)>(new Date).getTime()?n.delete(e):a[t]=e})));const c=Object.keys(a).sort();for(let e=0;e<c.length-r;e++)n.delete(c[e])}catch(t){console.error(`Failed to clean up Cache ${e}: ${t}`)}},i=async(e,t,r)=>{const n=c(e);try{const e=await u(t,r);return!!e&&fetch(new Request(await e.text()))}catch(e){n.error(`Cached url could not be retrieved: ${e}`)}},u=async(e,t)=>{try{const r=await caches.open(e),n=await r.match(t);if(n){const e=n.headers.get("ccp-expires");if(e&&parseInt(e)>(new Date).getTime())return n}return!1}catch(e){console.error(`Failed to load from cache: ${e}`)}},l=async(e,t,r,n)=>{try{const o=await caches.open(e),a={"ccp-expires":p(n)};return o.put(t,new Response(r,{status:200,statusText:"Synthetic",headers:a}))}catch(e){console.error(`Failed to store synthetic to cache: ${e}`)}},p=e=>(new Date).getTime()+60*e*1e3,d={versions:{v1:{accept:({event:e})=>{const t=new URL(e.request.url);return/.*\/i18n\/1\/.*\.CCPHASH\w{32}\.json.*/.test(t.pathname)},acceptedDomains:/^https:\/\/(test\.)?api(-cdn)?\.conrad\.com/,handle:async({event:t})=>{const r=t.request.url.match(/\/[a-z][a-z]_[A-Z][A-Z]/);return t.waitUntil(l(e,new Request("/ccp-i18n-url"+r),t.request.url,5)),!1}}}},h={versions:{v1:{accept:({event:e})=>{const t=new URL(e.request.url);return/.*\/i18n\/1\/.*\.json.*/.test(t.pathname)},acceptedDomains:/^https:\/\/(test\.)?api(-cdn)?\.conrad\.com/,handle:async({event:t})=>{const r=t.request.url.match(/\/[a-z][a-z]_[A-Z][A-Z]/);return await i(t,e,new Request("/ccp-i18n-url"+r))||await fetch(t.request)}}}};var f=r(775),m=r.n(f);const v=async(e,t,r,n)=>{try{const o=await t;return e.waitUntil(g(o,r,n)),o}catch(e){console.error(`Failed to handle product cache from response: ${e}`)}},w=(e,t)=>{const r=e.productShortInformation&&e.productShortInformation.mainImage&&e.productShortInformation.mainImage.imageUrl||"",n=e.productShortInformation&&e.productShortInformation.title||"";return[{cacheKey:`${e.shortProductNumber}-${t}`,cacheData:{imageUrl:r,title:n}}]},y=(e,t)=>e.productDetailPages.map((e=>{const r=e.productShortInformation&&e.productShortInformation.mainImage&&e.productShortInformation.mainImage.imageUrl||"",n=e.productShortInformation&&e.productShortInformation.title||"";return{cacheKey:`${e.shortProductNumber}-${t}`,cacheData:{imageUrl:r,title:n}}})),g=async(e,t,r)=>{try{const o=await e.clone().json();await Promise.all(t(o,r).map((e=>l(n,e.cacheKey,m()(e.cacheData),43200))))}catch(e){console.error(`Failed to store product details to cache: ${e}`)}},$=/.*\/product\/1\/service\/[^/]+\/product\/(\d{5,})\?.*(?:language=([^&]*)).*/,b={versions:{v1:{accept:({event:e})=>{const t=e.request.url;return $.test(t)},acceptedDomains:/^https:\/\/(api\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr)\.(preprod|cts|fastlane)\.tds-np\.com|api\.conrad\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr))/,handle:async({event:e})=>{const r=$.exec(e.request.url),n=r[2],o=new Request(`/ccp-product-url-${r[1]}-${n}`),a=await i(e,t,o),c=await(async({cachedResponse:e,event:r,urlCacheKey:n})=>{if(!e){const e=r.request.url,o=e.includes("showProductRelations=true")?r.request:new Request(`${e}&showProductRelations=true`);return r.waitUntil(l(t,n,o.url,60)),await fetch(o)}return r.waitUntil(l(t,n,e.url,60)),e})({cachedResponse:a,event:e,urlCacheKey:o}),u=v(e,c,w,n);return e.waitUntil(s(t,500,100)),u}}}},q=(e,t)=>t.test(e),P=async(e,t,r)=>{const o=(async(e,t,r)=>{const n=fetch(e.request);try{return await v(e,n,t,r)}catch(e){console.error(`Failed to handle product cache: ${e}`)}})(e,t,r.exec(e.request.url)[1]);return e.waitUntil(s(n,1e3,800)),o},S=/.*\/product\/1\/service\/[^/]+\/productdetails\?.*(?:language=([^&]*)).*/,k={versions:{v1:{accept:({event:e})=>q(e.request.url,S),acceptedDomains:/^https:\/\/(api\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr)\.(preprod|cts|fastlane)\.tds-np\.com|api\.conrad\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr))/,handle:({event:e})=>P(e,y,S)}}},U=/.*\/search\/1\/v\d+\/facetSearch\/\w{2}\/(\w{2})\/\w{3}/,D=(e,t)=>{var r,n;const o=[];if(null!==(r=e.campaigns)&&void 0!==r&&null!==(n=r.sponsoredProducts)&&void 0!==n&&n.product)for(let r=0;r<e.campaigns.sponsoredProducts.length;r++)for(let n=0;n<e.campaigns.sponsoredProducts[r].product.length;n++)o.push(I(e.campaigns.sponsoredProducts[r].product[n],t));return o.concat(e.hits.map((e=>I(e,t))))},I=(e,t)=>({cacheKey:`${e.productId}-${t}`,cacheData:{imageUrl:e.image||"",title:e.title||""}}),O={versions:{v1:{accept:({event:e})=>q(e.request.url,U),acceptedDomains:/^https:\/\/(api\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr)\.(preprod|cts|fastlane)\.tds-np\.com|api\.conrad\.(de|at|ch|nl|be|it|fr|pl|cz|dk|se|com|sk|si|hu|hr))/,handle:({event:e})=>P(e,D,U)}}},x=(e,t)=>(e.priority=t,e),j={i18nUrlCache:x(d,180),i18nUrlRewrite:x(h,190),productServiceCache:x(b,200),productDetailsCache:x(k,210),searchFacetsProductCache:x(O,220)},R=async({log:e,name:t,handlePromise:r})=>{try{const n=await r;if(n){e.debug(`modify response for [${t}]`);const r=new Response(n.body,n);return r.headers.set("CCP-Service-Worker",t),r}}catch(r){throw e.error(`Error during custom fetch [${t}] [${r}]`),r}},C=async({event:e,log:t,handler:r})=>{t.debug(`checking [${r.name}]`);for(const[n,{accept:o,handle:a}]of Object.entries(r.versions)){const c={event:e,log:t,name:`${r.name}-${n}`};if(!o){const e=await a(c);if(e)return t.info(`executed [${c.name}]`),await R({...c,handlePromise:e})}if(o(c))return t.info(`executing [${c.name}]`),await R({...c,handlePromise:a(c)})}},z=/^.+\.(js|css|jpe?g|png|tiff|woff2?)(\?[\w.=]+)?$/,A=Object.values(j).reduce(((e,t)=>(e.some((e=>e.toString()===t.versions.v1.acceptedDomains.toString()))||e.push(t.versions.v1.acceptedDomains),e)),[]),F=({event:e})=>{return t=e.request.url,!z.test(t)&&A.some((t=>!!t&&t.test(e.request.url)));var t};addEventListener("fetch",(t=>{const r=c(t);if(F({event:t})){(t=>{t.waitUntil(caches.delete("ccp-api-v1")),t.waitUntil(caches.delete("ccp-userinfo-v1")),t.request.url.startsWith(self.location.origin)&&!t.request.referrer.startsWith(self.location.origin)&&t.waitUntil(caches.delete(e))})(t);try{t.respondWith((async e=>{for(e.handler of Object.entries(j).map((([e])=>({name:e,versions:j[e].versions,priority:j[e].priority}))).sort(((e,t)=>{if(e.priority>t.priority)return 1;if(e.priority<t.priority)return-1;throw new Error(`Priority collision for handlers: ${e.name} and ${t.name} have both priority ${e.versions.v1.priority}. Please define them unique.`)}))){const t=await C(e);if(t)return t}return e.log.info("no handler for this request."),await fetch(e.event.request)})({log:r,event:t}))}catch(e){throw r.error(`Error selecting handler [${e}]`),e}}}))})()})();