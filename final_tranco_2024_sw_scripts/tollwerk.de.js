var fallbackImage="/typo3conf/ext/tw_tollwerk/Resources/Public/Images/Fallback.gif",resources=[fallbackImage,"/offline"],version="1.0",staticCacheName="static-".concat(version),imageCacheName="images",pagesCacheName="pages",cacheList=[staticCacheName,imageCacheName,pagesCacheName],frequentlyUpdated=["/",/^\/blog/],skipDomains=["stage.tollwerk.de","stage.tollwerk.dev"],dontCacheDomains=["connect.facebook.net","www.facebook.com"],dontCachePaths=[],dontCacheExtensions=["pdf","mp4","mp3","ogg","ogv","webm","m3u8","wav","m4a"],debug=!1,statusDB=null,flushingStati=!1,pathMatchesPattern=(dontCacheExtensions.forEach(function(e){return dontCachePaths.push(new RegExp("\\.".concat(e.toLowerCase(),"$")))}),debug&&console.debug(dontCachePaths),function(e,t){for(var n=!1,c=0,a=t;c<a.length;c++){var o=a[c];if(o instanceof RegExp){if(o.test(e)){n=!0;break}}else if(o===e){n=!0;break}}return n}),cachingAllowed=(self.addEventListener("install",function(e){self.skipWaiting(),e.waitUntil(caches.open(staticCacheName).then(function(e){return e.addAll(resources)}).catch(function(e){debug&&console.debug("Couldn't open static cache ".concat(staticCacheName),e)}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(function(e){return!cacheList.includes(e)}).map(function(e){return caches.delete(e)}))}).then(function(){return self.clients.claim()}))}),function(e){e=e.headers.get("Cache-Control");return!e||e.toLowerCase().indexOf("no-store")<0}),fetchNetworkCacheFallback=function(n,c,e,a){debug&&console.debug("network → cache → fallback: ".concat(c.url)),n.respondWith(caches.open(e).then(function(t){return fetch(n.request).then(function(e){return cachingAllowed(e)&&t.put(n.request,e.clone()),e}).catch(function(){caches.match(c).then(function(e){return e?(debug&&console.debug("Cache hit: ",c.url),e):a?(debug&&console.debug("Couldn't fetch ".concat(c.url,", returning fallback")),caches.match(a)):(debug&&console.debug("Couldn't fetch ".concat(c.url,", no fallback provided")),!1)})})}))},fetchCacheNetworkFallback=function(n,c,e,a){debug&&console.debug("cache → network → fallback: ".concat(c.url)),n.respondWith(caches.open(e).then(function(t){return caches.match(c).then(function(e){return e?(fetch(n.request).then(function(e){cachingAllowed(e)&&t.put(n.request,e)}).catch(function(){}),debug&&console.debug("Cache hit for: ",c.url),e):fetch(n.request).then(function(e){return cachingAllowed(e)&&t.put(n.request,e.clone()),e}).catch(function(){return a?(debug&&console.debug("Couldn't fetch ".concat(c.url,", returning fallback")),caches.match(a)):(debug&&console.debug("Couldn't fetch ".concat(c.url,", no fallback provided")),!1)})})}))},fetchCacheNetwork=function(n,c,t){debug&&console.debug("cache → network: ".concat(c.url)),caches.match(c).then(function(e){return e?(debug&&console.debug("Cache hit for: ",c.url),e):caches.open(t).then(function(t){return fetch(n.request).then(function(e){return cachingAllowed(e)&&t.put(n.request,e.clone()),e}).catch(function(){debug&&console.debug("Couldn't fetch ".concat(c.url))})})})},fetchNetworkFallback=function(e,t,n){debug&&console.debug("network → fallback: ".concat(t.url)),e.respondWith(fetch(e.request).catch(function(){return n?(debug&&console.debug("Couldn't fetch ".concat(t.url,", returning fallback")),caches.match(n)):(debug&&console.debug("Couldn't fetch ".concat(t.url,", no fallback provided")),!1)}))},getIndexedDB=(self.addEventListener("fetch",function(e){var t,n,c,a=e.request,o=new URL(a.url);"GET"===a.method&&o.protocol.startsWith("http")&&skipDomains.indexOf(o.hostname)<0&&0!==o.pathname.indexOf("/typo3/")&&(t=a.headers.get("Accept"),n=0<=dontCacheDomains.indexOf(o.hostname)||pathMatchesPattern(o.pathname,dontCachePaths),t.includes("text/html")?(c="/offline",n?fetchNetworkFallback(e,a,c):(pathMatchesPattern(o.pathname,frequentlyUpdated)?fetchNetworkCacheFallback:fetchCacheNetworkFallback)(e,a,"pages",c)):t.includes("image")?n?fetchNetworkFallback(e,a,fallbackImage):fetchCacheNetworkFallback(e,a,"images",fallbackImage):n||fetchCacheNetwork(e,a,"misc"))}),function(){return new Promise(function(t,n){var e=indexedDB.open("statusMessages");e.onsuccess=function(){statusDB=this.result,this.result.transaction("statusObjStore").objectStore("statusObjStore").getAll().onsuccess=function(e){return t(e.target.result)}},e.onerror=function(e){return n(e)}})}),updateQueue=function(){self.clients.matchAll().then(function(e){return e.map(function(e){return e.postMessage("update-queue")})})};function flushStatus(e){statusDB.transaction("statusObjStore","readwrite").objectStore("statusObjStore").delete(e),updateQueue()}function sendToServer(e){for(var t=0,n=e;t<n.length;t++)!function(t){var e,n=new FormData;for(e in t.data)Object.prototype.hasOwnProperty.call(t.data,e)&&n.append(e,t.data[e]);fetch(t.url,{method:"POST",body:n}).then(function(e){e.status<400&&flushStatus(t.id)}).catch(function(e){throw e})}(n[t])}var syncStati=function(){return getIndexedDB().then(sendToServer).catch(function(e){return e}).finally(function(){debug&&console.debug("Finished flushing"),flushingStati=!1})};self.addEventListener("message",function(e){"clear-pages"===e.data?caches.open(pagesCacheName).then(function(t){t.keys().then(function(e){e.forEach(function(e){return t.delete(e)})})}):"flush-queue"!==e.data||flushingStati||(flushingStati=!0,e.waitUntil(syncStati()))}),self.addEventListener("sync",function(e){flushingStati||"status-sync"!==e.tag||(flushingStati=!0,e.waitUntil(syncStati()))});