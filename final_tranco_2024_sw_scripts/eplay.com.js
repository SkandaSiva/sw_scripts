/*! For license information please see service-worker.js.LICENSE.txt */
(()=>{var e={3190:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e.data||!("token"in e.data)||!e.data.replyId)return console.error("@eplay-worker: Invalid authorize command payload"),null;try{const t=o.Container.get(i.default),n=o.Container.get(a.default),{token:r,uploadMediaChunks:s,doneMediaUpload:c}=e.data;n.setUploadMediaChunks(s),n.setDoneMediaUpload(c),t.set(r),u.postMessage({authorized:!!r},e.data.replyId)}catch(e){e instanceof Error&&console.error("Error retrieving token",e.message)}};const o=n(2663),i=r(n(1709)),a=r(n(4011)),s=r(n(8508)),u=o.Container.get(s.default)},9254:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cacheEmotes=function(e){return r(this,void 0,void 0,(function*(){if(!e.data||!e.data.hasOwnProperty("environment")||!e.data.replyId)return console.error("@eplay-worker: Invalid cacheEmotes command payload",{event:e}),null;const t=yield caches.open(a.CACHE_NAME);(yield t.keys()).length?c.postMessage({status:"Already cached."},e.data.replyId):(yield(0,u.saveEmotes)(e.data.environment),c.postMessage({status:"Cache created."},e.data.replyId))}))};const i=n(2663),a=n(8710),s=o(n(8508)),u=n(988),c=i.Container.get(s.default)},4500:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!e.data||!("fileHash"in e.data)||!e.data.replyId)return void console.error("@eplay-worker: Invalid command payload");const t=yield(0,a.default)(),n=e.data.fileHash;(yield t.getFromIndex(i.INDEXED_DB_UPLOADS_STORE,"fileHash",n))?(yield t.getFromIndex(i.INDEXED_DB_STATE_STORE,"fileHash",n))?(yield t.put(i.INDEXED_DB_STATE_STORE,{date:new Date,fileHash:n,state:u.States.Cancel},n),l.closeChannel(e.data.replyId)):l.postMessage({error:s.ErrorCodes.StateNotFound},e.data.replyId):l.postMessage({error:s.ErrorCodes.UploadNotFound},e.data.replyId)}))};const i=n(8710),a=o(n(1929)),s=n(5511),u=n(5792),c=n(2663),d=o(n(8508)),l=c.Container.get(d.default)},513:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!e.data||!e.data.replyId)return void console.error("@eplay-worker: Invalid clear command payload");const t=yield(0,a.default)();if("db"in e.data)try{yield(0,i.deleteDB)(e.data.db),d.postMessage({ok:!0},e.data.replyId)}catch(t){d.postMessage({context:t,error:s.ErrorCodes.DbNotDeleted},e.data.replyId)}else if("store"in e.data)try{yield t.clear(e.data.store),d.postMessage({ok:!0},e.data.replyId)}catch(t){d.postMessage({context:t,error:s.ErrorCodes.StoreNotDeleted},e.data.replyId)}else if("fileHash"in e.data)try{yield t.delete("fileHash",e.data.fileHash),d.closeChannel(e.data.replyId)}catch(t){d.postMessage({context:t,error:s.ErrorCodes.FileNotDeleted},e.data.replyId)}else console.error("@eplay-worker: Invalid command payload")}))};const i=n(4424),a=o(n(1929)),s=n(5511),u=n(2663),c=o(n(8508)),d=u.Container.get(c.default)},7068:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debugInit=function(e,t){if(!(null==e?void 0:e.data)||!("namespace"in e.data)||!e.data.replyId)return t.error("@eplay-worker: Invalid debugInit command payload",{event:e});s.enable(e.data.namespace),null==t||t.log("Debug namespace set",{namespace:e.data}),u.closeChannel(e.data.replyId)};const o=n(2663),i=r(n(5968)),a=r(n(8508)),s=o.Container.get(i.default),u=o.Container.get(a.default)},9658:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){var t;if(!(e.data&&(null===(t=e.data)||void 0===t?void 0:t.replyId)&&"store"in e.data&&"criteria"in e.data))return void console.error("@eplay-worker: Invalid get command payload");const n=[];let r=0;const o=(yield(0,i.default)()).transaction(e.data.store);let a=yield o.store.openCursor();for(a&&e.data.offset&&a.advance(e.data.offset);a&&!(e.data.limit&&r>=e.data.limit);)n.push({key:a.key,value:a.value}),a=yield a.continue(),r++;yield o.done,u.postMessage({results:n},e.data.replyId)}))};const i=o(n(1929)),a=n(2663),s=o(n(8508)),u=a.Container.get(s.default)},6561:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(e.data&&"file"in e.data&&e.data.replyId){if(void 0===self.indexedDB)return console.log("IndexedDB not supported at all!"),void l.postMessage({hasIndexedDb:!1},e.data.replyId);try{const{file:t}=e.data,n=yield(0,c.default)(),r=yield n.add(u.INDEXED_DB_UPLOADS_STORE,{chunkUuid:(0,a.v4)(),date:new Date,file:t,fileHash:(0,i.default)(t),name:t.name});if(0===(yield n.getAllKeys(u.INDEXED_DB_UPLOADS_STORE)).length)return l.postMessage({hasIndexedDb:!1},e.data.replyId),void console.log("IndexedDb save couldn't be verified");yield n.delete(u.INDEXED_DB_UPLOADS_STORE,r),l.postMessage({hasIndexedDb:!0},e.data.replyId)}catch(t){t instanceof Error&&console.error("IndexedDb error",t.name,t),l.postMessage({hasIndexedDb:!1},e.data.replyId)}}else console.error("@eplay-worker: Invalid version command payload")}))};const i=o(n(2568)),a=n(9118),s=n(2663),u=n(8710),c=o(n(1929)),d=o(n(8508)),l=s.Container.get(d.default)},6785:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!e.data||!("file"in e.data)||!e.data.replyId)return console.error("@eplay-worker: Invalid info command payload");const{file:t}=e.data,n=t,r=(0,i.default)(`${n.name}-${n.size}-${n.type}`);try{const t=yield(0,d.default)(),n=yield t.getFromIndex(c.INDEXED_DB_UPLOADS_STORE,"fileHash",r);if(n)return l.postMessage({alreadyStored:!!n,dzuuid:n.dzuuid,fileHash:r},e.data.replyId);l.postMessage({alreadyStored:!!n,dzuuid:(0,a.v4)(),fileHash:r},e.data.replyId)}catch(t){t instanceof Error&&(console.error("@eplay-worker info error:",t),l.postMessage({error:t.message||t.name||"Unknown error",fileHash:r},e.data.replyId))}}))};const i=o(n(2568)),a=n(9118),s=n(2663),u=o(n(8508)),c=n(8710),d=o(n(1929)),l=s.Container.get(u.default)},5181:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(e.data&&"config"in e.data&&e.data.replyId&&Object.keys(e.data.config).length))return console.log("@eplay-worker: Invalid setupApi command payload");const t=o.Container.get(a.default),n=e.data.config;Object.keys(n).forEach((e=>{switch(e){case"uploadMediaChunks":t.setUploadMediaChunks(n[e]);break;case"doneMediaUpload":t.setDoneMediaUpload(n[e]);break;default:console.error("@eplay-worker: Unrecognised API")}})),s.closeChannel(e.data.replyId),console.log("@eplay-worker: API Routes updated!")};const o=n(2663),i=r(n(8508)),a=r(n(4011)),s=o.Container.get(i.default)},1660:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!(e.data&&"files"in e.data&&e.data.replyId&&Array.isArray(e.data.files)))return void console.error("@eplay-worker: Invalid storage command payload");let t;try{const n=yield(0,c.default)();for(const r of e.data.files){const o=(0,i.default)(`${r.name}-${r.size}-${r.type}`),s=(0,a.v4)();t=o;const c=!!(yield n.getFromIndex(u.INDEXED_DB_UPLOADS_STORE,"fileHash",o));if(f.postMessage({alreadyStored:c,dzuuid:s,fileHash:o,progress:c?100:0},e.data.replyId,!0),c){console.info(`@eplay-worker: File already stored: ${o}`);continue}yield n.add(u.INDEXED_DB_STATE_STORE,{date:new Date,dzuuid:s,fileHash:o,state:d.States.Storing},o);const l=e.data.chunkSize||u.DEFAULT_CHUNK_SIZE_BYTES,p=Math.ceil(r.size/l);let h=0,y=!1;for(;h<p;){const t=0===h?0:l*h+1-1,i=h!==p?l*(h+1):r.size;if(yield n.add(u.INDEXED_DB_UPLOADS_STORE,{blob:r.slice(t,i),chunkByteOffset:l*(h+1),chunkIndex:h,chunkUuid:(0,a.v4)(),date:new Date,dzuuid:s,fileHash:o,fileType:r.type,name:r.name,totalChunks:p,totalFileSize:r.size}),h++,e.data.progress){const t=Math.round(100*(h/p*100+Number.EPSILON))/100;f.postMessage({alreadyStored:100===t,dzuuid:s,fileHash:o,progress:t},e.data.replyId,!0)}if((yield n.getFromIndex(u.INDEXED_DB_STATE_STORE,"fileHash",o)).value===d.States.Cancel){yield n.delete(u.INDEXED_DB_STATE_STORE,o),y=!0;break}}y||(yield n.put(u.INDEXED_DB_STATE_STORE,{date:new Date,dzuuid:s,fileHash:o,state:d.States.Storing},o))}f.closeChannel(e.data.replyId)}catch(n){n instanceof Error&&(console.error("@eplay-worker storage error:",n),f.postMessage({error:n.message||n.name||"Unknown error",fileHash:t},e.data.replyId))}}))};const i=o(n(2568)),a=n(9118),s=n(2663),u=n(8710),c=o(n(1929)),d=n(5792),l=o(n(8508)),f=s.Container.get(l.default)},5123:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!(e.data&&e.data.replyId&&"fileHash"in e.data&&"dzuuid"in e.data))return void console.error("@eplay-worker: Invalid update command payload");const t=e.data.fileHash,n=e.data.dzuuid,o=i.Container.get(a.default),u=yield(0,c.default)(),p=yield u.getFromIndex(d.INDEXED_DB_STATE_STORE,"fileHash",t);switch(null==p?void 0:p.state){case l.States.Uploading:yield function(e){return r(this,arguments,void 0,(function*({fileHash:e,dzuuid:t,replayId:n}){const r=yield(0,c.default)(),o=yield r.countFromIndex(d.INDEXED_DB_UPLOADS_STORE,"fileHash",e),i=r.transaction(d.INDEXED_DB_PROGRESS_STORE),a=i.store.index("fileHash");let u=yield a.openCursor(e),l=0;for(;u;)u.value.status===s.Statuses.Uploaded&&l++,u=yield u.continue();yield i.done;const p=l&&o?l/o*100:0;return f.postMessage({dzuuid:t,fileHash:e,progress:Math.round(100*(p+Number.EPSILON))/100},n),p}))}({dzuuid:n,fileHash:t,replayId:e.data.replyId});break;case l.States.Uploaded:f.postMessage({dzuuid:n,fileHash:t,mediaId:o.getMediaId(t),progress:100},e.data.replyId);break;default:case l.States.Cancel:f.postMessage({dzuuid:n,error:(null==p?void 0:p.state)===l.States.Cancel?"canceled":"File info is missing!",fileHash:t},e.data.replyId)}}))};const i=n(2663),a=o(n(6700)),s=n(2504),u=o(n(8508)),c=o(n(1929)),d=n(8710),l=n(5792),f=i.Container.get(u.default)},9966:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){if(!(e.data&&e.data.replyId&&"fileHash"in e.data&&"post"in e.data))return void console.error("@eplay-worker: Invalid upload command payload");let t="";const n=i.Container.get(d.default),r=e.data.fileHash,o=e.data.post,f=yield(0,s.default)();try{if(!(yield f.getFromIndex(a.INDEXED_DB_UPLOADS_STORE,"fileHash",r)))return void p.postMessage({error:u.ErrorCodes.UploadNotFound},e.data.replyId);yield f.put(a.INDEXED_DB_STATE_STORE,{date:new Date,fileHash:r,state:c.States.Uploading},r);const n=f.transaction(a.INDEXED_DB_UPLOADS_STORE),o=n.store.index("fileHash"),i=[],s=yield o.count(r);let d=yield o.openCursor(r);for(;d;){const{chunkByteOffset:e,chunkIndex:n,name:r,blob:o,dzuuid:u,totalFileSize:c}=d.value;t=u,i.push({dzchunkbyteoffset:e-a.DEFAULT_CHUNK_SIZE_BYTES,dzchunkindex:n,dzchunksize:a.DEFAULT_CHUNK_SIZE_BYTES,dztotalchunkcount:s,dztotalfilesize:c,dzuuid:t,mediaFile:new File([o],r,{type:"application/octet-stream"}),name:r}),d=yield d.continue()}yield n.done;for(const[t,n]of i.entries()){const{error:o}=yield(0,l.uploadChunk)(n);if(o){p.postMessage({error:o,fileHash:r,progress:(t+1)/i.length*100},e.data.replyId,!0);try{yield f.put(a.INDEXED_DB_STATE_STORE,{date:new Date,fileHash:r,state:c.States.Errored},r)}catch(e){console.error(`@eplay-worker: could not mark upload as errored for: ${r}`)}return}p.postMessage({fileHash:r,progress:(t+1)/i.length*100},e.data.replyId,!0)}}catch(e){return void console.error(`@eplay-worker: could not upload chunks for file: ${r}`,e)}if(t)try{const{error:i,mediaId:s}=yield(0,l.doneMediaUpload)(t,o);if(i)return void p.postMessage({dzuuid:t,error:i,fileHash:r},e.data.replyId);if(!s)return console.error(`@eplay-worker: no returned media ID for: ${r}`),void p.postMessage({dzuuid:t,error:u.ErrorCodes.UnknownError,fileHash:r},e.data.replyId);p.postMessage({dzuuid:t,fileHash:r,mediaId:s},e.data.replyId),n.setMediaId(r,s),yield f.put(a.INDEXED_DB_STATE_STORE,{date:new Date,fileHash:r,state:c.States.Uploaded},r)}catch(n){console.error(`@eplay-worker: could not complete upload for: ${r}`,n),p.postMessage({dzuuid:t,error:u.ErrorCodes.UnknownError,fileHash:r},e.data.replyId)}else console.error(`@eplay-worker: empty dzuuid for: ${r}`)}))};const i=n(2663),a=n(8710),s=o(n(1929)),u=n(5511),c=n(5792),d=o(n(6700)),l=n(4321),f=o(n(8508)),p=i.Container.get(f.default)},780:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(this,void 0,void 0,(function*(){e.data&&e.data.replyId?u.postMessage({version:i.WORKER_VERSION},e.data.replyId):console.error("@eplay-worker: Invalid version command payload")}))};const i=n(8710),a=n(2663),s=o(n(8508)),u=a.Container.get(s.default)},8710:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIVE_CHANNEL_PAGE=t.INSIGHTS_URL=t.WWW_EPLAY_COM=t.EPLAY_LOGGER_NAMESPACE=t.EMOTE_OPTIONS=t.EMOTES_TOTAL=t.EMOTE_REGEX=t.EMOTES_API_URL=t.INDEXED_DB_VERSION=t.INDEXED_DB_UPLOADS_STORE=t.INDEXED_DB_STATE_STORE=t.INDEXED_DB_PROGRESS_STORE=t.INDEXED_DB_NAME=t.DEFAULT_CHUNK_SIZE_BYTES=t.CACHE_NAME=t.WORKER_VERSION=void 0,t.WORKER_VERSION=1.5,t.CACHE_NAME="eplay-v1",t.DEFAULT_CHUNK_SIZE_BYTES=2e6,t.INDEXED_DB_NAME="www-eplay-uploads",t.INDEXED_DB_PROGRESS_STORE="progress",t.INDEXED_DB_STATE_STORE="state",t.INDEXED_DB_UPLOADS_STORE="uploads",t.INDEXED_DB_VERSION=4,t.EMOTES_API_URL={development:"https://search-cf-development.eplay.com/emotes",production:"https://search-cf.eplay.com/emotes"},t.EMOTE_REGEX=/(\/emotes\/)(\d+)(\/[a-z-]+)(\.)(png|gif)/,t.EMOTES_TOTAL=100,t.EMOTE_OPTIONS="",t.EPLAY_LOGGER_NAMESPACE="eplay:eplay-worker",t.WWW_EPLAY_COM="https://www.eplay.com",t.INSIGHTS_URL={development:"https://insights-development.eplay.com/log",production:"https://insights.eplay.com/log"},t.LIVE_CHANNEL_PAGE=/\/.+\/live$/},1885:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8710),o={common:[{keyPath:"date",name:"date"},{keyPath:"name",name:"name"}],uploads:[{keyPath:"fileHash",name:"fileHash"},{keyPath:"chunkUuid",name:"chunkUuid",options:{unique:!0}}]},i=[{indices:o.common.concat(o.uploads).concat([{keyPath:"status",name:"status"}]),name:r.INDEXED_DB_PROGRESS_STORE,options:{autoIncrement:!0,keyPath:"id"}},{indices:[{keyPath:"fileHash",name:"fileHash",options:{unique:!0}},{keyPath:"state",name:"state"},{keyPath:"date",name:"date"}],name:r.INDEXED_DB_STATE_STORE},{indices:o.common.concat(o.uploads),name:r.INDEXED_DB_UPLOADS_STORE,options:{autoIncrement:!0,keyPath:"id"}}];t.default=i},1929:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return r(this,void 0,void 0,(function*(){return yield(0,i.openDB)(a.INDEXED_DB_NAME,a.INDEXED_DB_VERSION,{upgrade(e){!function(e){for(const{name:t,options:n,indices:r}of s.default){const o=e.createObjectStore(t,n);for(const{name:e,keyPath:t,options:n}of r)o.createIndex(e,t,n)}}(e)}})}))};const i=n(4424),a=n(8710),s=o(n(1885))},4337:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Environment=void 0,function(e){e.development="development",e.production="production"}(n||(t.Environment=n={}))},5511:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCodes=void 0,function(e){e.DbNotDeleted="dbNotDeleted",e.FileNotDeleted="fileNotDeleted",e.InvalidCommand="invalidCommand",e.StateNotFound="stateNotFound",e.StoreNotDeleted="storeNotDeleted",e.UploadNotFound="uploadNotFound",e.UploadNotVerified="uploadNotVerified",e.ChunkNotUploaded="chunkNotUploaded",e.UnknownError="unknownError"}(n||(t.ErrorCodes=n={}))},4683:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Commands=void 0,function(e){e.Authorize="authorize",e.CacheEmotes="cacheEmotes",e.Cancel="cancel",e.Clear="clear",e.DebugInit="debugInit",e.Get="get",e.HasIndexedDb="hasIndexedDb",e.Info="info",e.PersonDetector="personDetector",e.SetupApi="setupApi",e.Storage="storage",e.Update="update",e.Upload="upload",e.Version="version"}(n||(t.Commands=n={}))},5792:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.States=void 0,function(e){e.Cancel="cancel",e.Errored="errored",e.Stored="stored",e.Storing="storing",e.Uploaded="uploaded",e.Uploading="uploading"}(n||(t.States=n={}))},2504:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Statuses=void 0,function(e){e.Uploading="uploading",e.Uploaded="uploaded",e.Error="error"}(n||(t.Statuses=n={}))},4450:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(8660);const o=n(2663),i=r(n(3190)),a=r(n(4500)),s=r(n(513)),u=r(n(9658)),c=r(n(6561)),d=r(n(1660)),l=r(n(9966)),f=r(n(780)),p=r(n(5123)),h=r(n(6785)),y=r(n(5181)),v=n(4683),m=n(8710),_=n(988),g=r(n(5968)),b=n(7068),E=r(n(8508)),w=n(9254),C=o.Container.get(g.default).getEplayLogger(),O=o.Container.get(E.default);O.setActiveLogger(C),self.addEventListener("install",(()=>{self.skipWaiting(),console.info(`@eplay-worker ${m.WORKER_VERSION}`),null==C||C.log({workerVersion:m.WORKER_VERSION})})),self.addEventListener("activate",(e=>{console.info(`@eplay-worker ${m.WORKER_VERSION}`);try{self.skipWaiting(),self.clients.claim()}catch(e){console.error("@eplay-worker skipWaiting/claim error: ",e)}O.getMainBroadcastChannel().onmessage=t=>{const n={data:t};if(t.command)switch(null==C||C.log({message:e}),t.command){case v.Commands.DebugInit:(0,b.debugInit)(n,C);break;case v.Commands.Authorize:(0,i.default)(n);break;case v.Commands.Cancel:(0,a.default)(n);break;case v.Commands.Clear:(0,s.default)(n);break;case v.Commands.Get:(0,u.default)(n);break;case v.Commands.HasIndexedDb:(0,c.default)(n);break;case v.Commands.Info:(0,h.default)(n);break;case v.Commands.SetupApi:(0,y.default)(n);break;case v.Commands.Storage:(0,d.default)(n);break;case v.Commands.Update:(0,p.default)(n);break;case v.Commands.Upload:(0,l.default)(n);break;case v.Commands.Version:(0,f.default)(n);break;case v.Commands.CacheEmotes:(0,w.cacheEmotes)(n);break;default:console.error("@eplay-worker: Invalid command"),C.error("Invalid command")}}})),self.addEventListener("fetch",(e=>{e.request.url.match(m.EMOTE_REGEX)&&e.respondWith((0,_.fetchEmotes)(e))}))},4011:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2663);let i=class{constructor(){this.uploadMediaChunks="",this.doneMediaUpload=""}setUploadMediaChunks(e){this.uploadMediaChunks=e}getUploadMediaChunks(){return this.uploadMediaChunks}setDoneMediaUpload(e){this.doneMediaUpload=e}getDoneMediaUpload(){return this.doneMediaUpload}};i=r([(0,o.Service)()],i),t.default=i},8508:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const i=n(2663),a=n(8437);let s=class{constructor(){this.privateChannelsMap=new Map,this.activeLogger=void 0,this.broadcastChannel=new a.BroadcastChannel("eplay-worker")}getMainBroadcastChannel(){return this.broadcastChannel}setActiveLogger(e){this.activeLogger=e}postMessage(e,t,n=!1){var r;n&&!this.privateChannelsMap.has(t)&&this.privateChannelsMap.set(t,new a.BroadcastChannel(t)),null===(r=this.activeLogger)||void 0===r||r.log("sending reply",{keepAlive:n,message:e,replyId:t});const o=this.privateChannelsMap.has(t)?this.privateChannelsMap.get(t):new a.BroadcastChannel(t);o&&(o.postMessage(Object.assign(Object.assign({},e),{ok:!n||void 0})),n||o.close())}closeChannel(e){const t=new a.BroadcastChannel(e);t.postMessage({ok:!0}),t.close(),this.privateChannelsMap.has(e)&&this.privateChannelsMap.delete(e)}};s=r([(0,i.Service)(),o("design:paramtypes",[])],s),t.default=s},5968:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=n(2663),d=u(n(1227)),l=a(n(2640)),f=u(n(2917)),p=n(8710);function h(...e){}let y=class{constructor(){this.loggerMap=new Map,this.insights=new l.default}insightProxy(e){return new Proxy(e,{apply:(t,n,r)=>{const[o,...i]=r,a=i.filter((e=>(0,f.default)(e)));return"string"==typeof o&&this.insights.log({data:a,message:o,namespace:e.namespace,timestamp:Date.now(),type:l.InsightLogType.Info}),Reflect.apply(t,n,r)}})}getLogger(e,t){if(!this.loggerMap.has(e)){const n=`${e}:log`,r=()=>t?this.insightProxy((0,d.default)(n)):(0,d.default)(n),o={error:r(),log:r(),warn:r()};this.loggerMap.set(e,o)}return this.loggerMap.get(e)?this.loggerMap.get(e):(console.error("Logger is not defined"),{error:h,log:h,warn:h})}getEplayLogger(){return this.getLogger(p.EPLAY_LOGGER_NAMESPACE)}enable(e){d.default.enable(e)}};y=i([(0,c.Service)(),s("design:paramtypes",[])],y),t.default=y},6586:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(2663),u=a(n(4011));let c=class{constructor(e=s.Container.get(u.default)){this.api=e}uploadMediaChunks(e){return i(this,void 0,void 0,(function*(){const t=new FormData;for(const[n,r]of Object.entries(e))"mediaFile"!==n?t.append(n,String(r)):t.append("mediaFile",e.mediaFile,e.name);return yield fetch(`${this.api.getUploadMediaChunks()}/sw`,{cache:"no-cache",method:"POST",body:t,credentials:"include"})}))}doneMediaUpload(e,t){return i(this,void 0,void 0,(function*(){return yield fetch(this.api.getDoneMediaUpload(),{headers:{Accept:"application/json","Content-Type":"application/json"},cache:"no-cache",body:JSON.stringify({dzuuid:e,post:t}),method:"POST",credentials:"include"})}))}};c=r([(0,s.Service)(),o("design:paramtypes",[Object])],c),t.default=c},6700:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const i=n(2663);let a=class{constructor(){this.mediaIdsMap=new Map}setMediaId(e,t){this.mediaIdsMap.set(e,t)}getMediaId(e){return!!this.mediaIdsMap.has(e)&&this.mediaIdsMap.get(e)}};a=r([(0,i.Service)(),o("design:paramtypes",[])],a),t.default=a},1709:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2663);let i=class{set(e){this.token=e}get(){return this.token}};i=r([(0,o.Service)()],i),t.default=i},988:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.saveEmotes=function(e){return r(this,void 0,void 0,(function*(){try{const t=yield(0,a.default)(`${i.EMOTES_API_URL[e]}?size=${i.EMOTES_TOTAL}`,{priority:"low"});t.total>i.EMOTES_TOTAL&&console.info("@eplay-worker: Total number of uncached emotes = "+(t.total-i.EMOTES_TOTAL)),yield function(e){return r(this,void 0,void 0,(function*(){try{const t=yield caches.open(i.CACHE_NAME);e.forEach((e=>{if(e.url){const n=`${e.url}${i.EMOTE_OPTIONS}`;t.add(n)}}))}catch(e){console.error("@eplay-worker caches.open error",e)}}))}(t.results)}catch(e){console.error("@eplay-worker caching error:",e)}}))},t.fetchEmotes=function(e){return r(this,void 0,void 0,(function*(){const t=new URL(e.request.url);return t.search="",t.hash="",(yield caches.match(`${t.toString()}?${i.EMOTE_OPTIONS}`))||fetch(e.request)}))};const i=n(8710),a=o(n(7163))},7163:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,arguments,void 0,(function*(e,t={}){t=Object.assign(Object.assign({},{cache:"no-cache"}),t);const n=yield fetch(e,t);return yield n.json()}))}},2640:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InsightLogType=void 0;const i=n(8710),a=n(4337),s=o(n(3064));var u;!function(e){e.Info="info"}(u||(t.InsightLogType=u={}));const c=self.location.origin===i.WWW_EPLAY_COM?a.Environment.production:a.Environment.development;t.default=class{constructor(){this.flushInProgress=!1,this.queuedLogs=[],this.authFailed=!1,this.ratelimitLogCount=0,this.ratelimitLogTimestamp=0,this.ratelimitWarningSent=!1}log(e){if(this.authFailed)return;const t=Date.now();t-this.ratelimitLogTimestamp<1e3?this.ratelimitLogCount++:(this.ratelimitLogCount=1,this.ratelimitLogTimestamp=t),this.ratelimitLogCount>15?this.ratelimitWarningSent||(console.error("Too many logs are being sent, this will cause only a portion of logs to be actually shipped."),this.ratelimitWarningSent=!0):(this.queuedLogs.length>=75?this.flushLogs():this.scheduleFlush(),this.queuedLogs.push(e))}scheduleFlush(){return r(this,void 0,void 0,(function*(){this.flushInProgress||(this.flushInProgress=!0,yield(0,s.default)(3e3),this.queuedLogs.length>0&&(yield this.flushLogs()),this.flushInProgress=!1)}))}flushLogs(){return r(this,void 0,void 0,(function*(){const e=[...this.queuedLogs];if(this.queuedLogs=[],this.ratelimitLogCount=0,0!==e.length)try{const t=yield fetch(i.INSIGHTS_URL[c],{body:JSON.stringify({messages:e}),credentials:"include",headers:{"content-type":"application/json"},keepalive:!0,method:"POST"});400===t.status&&"Missing session"===(yield t.text())&&(this.authFailed=!0)}catch(e){console.error("Failed to ship insight logs",e)}}))}}},2917:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n=new WeakSet){if(n.has(t))return!1;if(null===t||["undefined","string","number","boolean"].includes(typeof t))return!0;if(Array.isArray(t)){for(const r of t)if(!e(r,n))return!1;return!0}if(function(e){return"object"==typeof e}(t)){n.add(t);for(const r in t)if(!e(t[r],n))return!1;return n.delete(t),!0}return!1}},3064:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((t=>{setTimeout(t,e)}))}},4321:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.doneMediaUpload=function(e,t){return r(this,void 0,void 0,(function*(){try{const n=yield u.doneMediaUpload(e,t);if(200!==n.status)return console.error("@eplay-worker upload not verified. Returned status code: ",n.status),{error:a.ErrorCodes.UploadNotVerified};const r=yield n.json();return{mediaId:null==r?void 0:r.mediaId}}catch(e){return console.error("@eplay-worker doneMediaUpload error: ",e),{error:a.ErrorCodes.UnknownError}}}))},t.uploadChunk=function(e){return r(this,void 0,void 0,(function*(){try{return 204!==(yield u.uploadMediaChunks(e)).status?{error:a.ErrorCodes.ChunkNotUploaded}:{success:!0}}catch(t){return console.error(`@eplay-worker upload chunk error for ${null==e?void 0:e.dzuuid}`,t),{error:a.ErrorCodes.ChunkNotUploaded}}}))};const i=n(2663),a=n(5511),s=o(n(6586)),u=i.Container.get(s.default)},8991:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OPEN_BROADCAST_CHANNELS=t.BroadcastChannel=void 0,t.clearNodeFolder=function(e){e=(0,i.fillOptionsWithDefaults)(e);var t=(0,o.chooseMethod)(e);return"node"===t.type?t.clearNodeFolder().then((function(){return!0})):r.PROMISE_RESOLVED_FALSE},t.enforceOptions=function(e){s=e};var r=n(6202),o=n(4632),i=n(423),a=new Set;t.OPEN_BROADCAST_CHANNELS=a;var s,u=0,c=function(e,t){var n,c;this.id=u++,a.add(this),this.name=e,s&&(t=s),this.options=(0,i.fillOptionsWithDefaults)(t),this.method=(0,o.chooseMethod)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,c=(n=this).method.create(n.name,n.options),(0,r.isPromise)(c)?(n._prepP=c,c.then((function(e){n._state=e}))):n._state=c};function d(e,t,n){var o={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:r.PROMISE_RESOLVED_VOID).then((function(){var t=e.method.postMessage(e._state,o);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function l(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function f(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&l(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=e.time-1e5;t.time>=n&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function p(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!l(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}t.BroadcastChannel=c,c._pubkey=!0,c.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return d(this,"message",e)},postInternal:function(e){return d(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};p(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,f(this,"message",t)):this._onML=null},addEventListener:function(e,t){f(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){p(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){a.delete(this),this.closed=!0;var t=this._prepP?this._prepP:r.PROMISE_RESOLVED_VOID;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}}},8437:(e,t,n)=>{"use strict";var r=n(5585);e.exports={BroadcastChannel:r.BroadcastChannel,createLeaderElection:r.createLeaderElection,clearNodeFolder:r.clearNodeFolder,enforceOptions:r.enforceOptions,beLeader:r.beLeader}},5585:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BroadcastChannel",{enumerable:!0,get:function(){return r.BroadcastChannel}}),Object.defineProperty(t,"OPEN_BROADCAST_CHANNELS",{enumerable:!0,get:function(){return r.OPEN_BROADCAST_CHANNELS}}),Object.defineProperty(t,"beLeader",{enumerable:!0,get:function(){return i.beLeader}}),Object.defineProperty(t,"clearNodeFolder",{enumerable:!0,get:function(){return r.clearNodeFolder}}),Object.defineProperty(t,"createLeaderElection",{enumerable:!0,get:function(){return o.createLeaderElection}}),Object.defineProperty(t,"enforceOptions",{enumerable:!0,get:function(){return r.enforceOptions}});var r=n(8991),o=n(6550),i=n(4781)},4781:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beLeader=function(e){e.isLeader=!0,e._hasLeader=!0;var t=(0,r.add)((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&o(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),o(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),o(e,"tell")},t.sendLeaderMessage=o;var r=n(4810);function o(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}},683:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LeaderElectionWebLock=void 0;var r=n(6202),o=n(4781),i=function(e,t){var n=this;this.broadcastChannel=e,e._befC.push((function(){return n.die()})),this._options=t,this.isLeader=!1,this.isDead=!1,this.token=(0,r.randomToken)(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+e.method.type+"||"+e.name};t.LeaderElectionWebLock=i,i.prototype={hasLeader:function(){var e=this;return navigator.locks.query().then((function(t){var n=t.held?t.held.filter((function(t){return t.name===e.lN})):[];return!!(n&&n.length>0)}))},awaitLeadership:function(){var e=this;if(!this._wLMP){this._wKMC.c=new AbortController;var t=new Promise((function(t,n){e._wKMC.res=t,e._wKMC.rej=n}));this._wLMP=new Promise((function(n){navigator.locks.request(e.lN,{signal:e._wKMC.c.signal},(function(){return e._wKMC.c=void 0,(0,o.beLeader)(e),n(),t})).catch((function(){}))}))}return this._wLMP},set onduplicate(e){},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),(0,o.sendLeaderMessage)(this,"death")}}},6550:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLeaderElection=function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){return e||(e={}),(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}(t,e);var n=(0,r.supportsWebLockAPI)()?new i.LeaderElectionWebLock(e,t):new a(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n};var r=n(6202),o=n(4781),i=n(683),a=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=(0,r.randomToken)(),this._aplQ=r.PROMISE_RESOLVED_VOID,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var o=function(e){"leader"===e.context&&("death"===e.action&&(n._hasLeader=!1),"tell"===e.action&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",o),this._lstns.push(o)};a.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(e){var t=this;return this.isLeader?(0,r.sleep)(0,!0):this.isDead?(0,r.sleep)(0,!1):this._aplQC>1?this._aplQ:(this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return r.PROMISE_RESOLVED_TRUE;var n,i=!1,a=new Promise((function(e){n=function(){i=!0,e()}})),s=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t._hasLeader=!0))};t.broadcastChannel.addEventListener("internal",s);var u=e?4*t._options.responseTime:t._options.responseTime;return(0,o.sendLeaderMessage)(t,"apply").then((function(){return Promise.race([(0,r.sleep)(u),a.then((function(){return Promise.reject(new Error)}))])})).then((function(){return(0,o.sendLeaderMessage)(t,"apply")})).then((function(){return Promise.race([(0,r.sleep)(u),a.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",s),!i&&(0,o.beLeader)(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader})))},awaitLeadership:function(){return this._aLP||(this._aLP=(e=this).isLeader?r.PROMISE_RESOLVED_VOID:new Promise((function(t){var n=!1;function o(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",i),t(!0))}e.applyOnce().then((function(){e.isLeader&&o()})),function t(){return(0,r.sleep)(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void o():e.applyOnce(!0).then((function(){e.isLeader?o():t()}))}))}();var i=function(t){"leader"===t.context&&"death"===t.action&&(e._hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&o()})))};e.broadcastChannel.addEventListener("internal",i),e._lstns.push(i)}))),this._aLP;var e},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,(0,o.sendLeaderMessage)(this,"death")}}},4632:(e,t,n)=>{"use strict";n(8698),Object.defineProperty(t,"__esModule",{value:!0}),t.chooseMethod=function(e){var t=[].concat(e.methods,s).filter(Boolean);if(e.type){if("simulate"===e.type)return a.SimulateMethod;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(s.map((function(e){return e.type}))))};var r=n(6115),o=n(9122),i=n(4924),a=n(1574),s=[r.NativeMethod,o.IndexedDBMethod,i.LocalstorageMethod]},9122:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRANSACTION_SETTINGS=t.IndexedDBMethod=void 0,t.averageResponseTime=S,t.canBeUsed=O,t.cleanOldMessages=m,t.close=E,t.commitIndexedDBTransaction=l,t.create=_,t.createDatabase=f,t.getAllMessages=function(e){var t=e.transaction(u,"readonly",c),n=t.objectStore(u),r=[];return new Promise((function(e){n.openCursor().onsuccess=function(n){var o=n.target.result;o?(r.push(o.value),o.continue()):(l(t),e(r))}}))},t.getIdb=d,t.getMessagesHigherThan=h,t.getOldMessages=v,t.microSeconds=void 0,t.onMessage=C,t.postMessage=w,t.removeMessagesById=y,t.type=void 0,t.writeMessage=p;var r=n(6202),o=n(2151),i=n(423),a=r.microSeconds;t.microSeconds=a;var s="pubkey.broadcast-channel-0-",u="messages",c={durability:"relaxed"};function d(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function l(e){e.commit&&e.commit()}function f(e){var t=d(),n=s+e,r=t.open(n);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(u,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){r.onerror=function(e){return t(e)},r.onsuccess=function(){e(r.result)}}))}function p(e,t,n){var r={uuid:t,time:(new Date).getTime(),data:n},o=e.transaction([u],"readwrite",c);return new Promise((function(e,t){o.oncomplete=function(){return e()},o.onerror=function(e){return t(e)},o.objectStore(u).add(r),l(o)}))}function h(e,t){var n=e.transaction(u,"readonly",c),r=n.objectStore(u),o=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var a=r.getAll(i);return new Promise((function(e,t){a.onerror=function(e){return t(e)},a.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,a){var s=function(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();s.onerror=function(e){return a(e)},s.onsuccess=function(r){var i=r.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):(l(n),e(o))}}))}function y(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(u,"readwrite",c).objectStore(u);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}function v(e,t){var n=(new Date).getTime()-t,r=e.transaction(u,"readonly",c),o=r.objectStore(u),i=[];return new Promise((function(e){o.openCursor().onsuccess=function(t){var o=t.target.result;if(o){var a=o.value;a.time<n?(i.push(a),o.continue()):(l(r),e(i))}else e(i)}}))}function m(e){return v(e.db,e.options.idb.ttl).then((function(t){return y(e,t.map((function(e){return e.id})))}))}function _(e,t){return t=(0,i.fillOptionsWithDefaults)(t),f(e).then((function(n){var i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:(0,r.randomToken)(),eMIs:new o.ObliviousSet(2*t.idb.ttl),writeBlockPromise:r.PROMISE_RESOLVED_VOID,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},g(i),i}))}function g(e){e.closed||b(e).then((function(){return(0,r.sleep)(e.options.idb.fallbackInterval)})).then((function(){return g(e)}))}function b(e){return e.closed?r.PROMISE_RESOLVED_VOID:e.messagesCallback?h(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),r.PROMISE_RESOLVED_VOID})):r.PROMISE_RESOLVED_VOID}function E(e){e.closed=!0,e.db.close()}function w(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return p(e.db,e.uuid,t)})).then((function(){0===(0,r.randomInt)(0,10)&&m(e)})),e.writeBlockPromise}function C(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,b(e)}function O(){return!!d()}function S(e){return 2*e.idb.fallbackInterval}t.TRANSACTION_SETTINGS=c,t.type="idb";var I={create:_,close:E,onMessage:C,postMessage:w,canBeUsed:O,type:"idb",averageResponseTime:S,microSeconds:a};t.IndexedDBMethod=I},4924:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalstorageMethod=void 0,t.addStorageEventListener=f,t.averageResponseTime=_,t.canBeUsed=m,t.close=y,t.create=h,t.getLocalStorage=c,t.microSeconds=void 0,t.onMessage=v,t.postMessage=l,t.removeStorageEventListener=p,t.storageKey=d,t.type=void 0;var r=n(2151),o=n(423),i=n(6202),a=i.microSeconds;t.microSeconds=a;var s="pubkey.broadcastChannel-",u="localstorage";function c(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function d(e){return s+e}function l(e,t){return new Promise((function(n){(0,i.sleep)().then((function(){var r=d(e.channelName),o={token:(0,i.randomToken)(),time:(new Date).getTime(),data:t,uuid:e.uuid},a=JSON.stringify(o);c().setItem(r,a);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=a,window.dispatchEvent(s),n()}))}))}function f(e,t){var n=d(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}function p(e){window.removeEventListener("storage",e)}function h(e,t){if(t=(0,o.fillOptionsWithDefaults)(t),!m())throw new Error("BroadcastChannel: localstorage cannot be used");var n=(0,i.randomToken)(),a=new r.ObliviousSet(t.localstorage.removeTimeout),s={channelName:e,uuid:n,eMIs:a};return s.listener=f(e,(function(e){s.messagesCallback&&e.uuid!==n&&e.token&&!a.has(e.token)&&(e.data.time&&e.data.time<s.messagesCallbackTime||(a.add(e.token),s.messagesCallback(e.data)))})),s}function y(e){p(e.listener)}function v(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function m(){var e=c();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function _(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}t.type=u;var g={create:h,close:y,onMessage:v,postMessage:l,canBeUsed:m,type:u,averageResponseTime:_,microSeconds:a};t.LocalstorageMethod=g},6115:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NativeMethod=void 0,t.averageResponseTime=l,t.canBeUsed=d,t.close=s,t.create=a,t.microSeconds=void 0,t.onMessage=c,t.postMessage=u,t.type=void 0;var r=n(6202),o=r.microSeconds;t.microSeconds=o;var i="native";function a(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function s(e){e.bc.close(),e.subFns=[]}function u(e,t){try{return e.bc.postMessage(t,!1),r.PROMISE_RESOLVED_VOID}catch(e){return Promise.reject(e)}}function c(e,t){e.messagesCallback=t}function d(){if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}function l(){return 150}t.type=i;var f={create:a,close:s,onMessage:c,postMessage:u,canBeUsed:d,type:i,averageResponseTime:l,microSeconds:o};t.NativeMethod=f},1574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulateMethod=void 0,t.averageResponseTime=l,t.canBeUsed=d,t.close=s,t.create=a,t.microSeconds=void 0,t.onMessage=c,t.postMessage=u,t.type=void 0;var r=n(6202).microSeconds;t.microSeconds=r;var o="simulate";t.type=o;var i=new Set;function a(e){var t={name:e,messagesCallback:null};return i.add(t),t}function s(e){i.delete(e)}function u(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(i).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))}function c(e,t){e.messagesCallback=t}function d(){return!0}function l(){return 5}var f={create:a,close:s,onMessage:c,postMessage:u,canBeUsed:d,type:o,averageResponseTime:l,microSeconds:r};t.SimulateMethod=f},423:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fillOptionsWithDefaults=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}},6202:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROMISE_RESOLVED_VOID=t.PROMISE_RESOLVED_TRUE=t.PROMISE_RESOLVED_FALSE=void 0,t.isPromise=function(e){return e&&"function"==typeof e.then},t.microSeconds=function(){var e=(new Date).getTime();return e===i?1e3*e+ ++a:(i=e,a=0,1e3*e)},t.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},t.randomToken=function(){return Math.random().toString(36).substring(2)},t.sleep=function(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))},t.supportsWebLockAPI=function(){return"undefined"!=typeof navigator&&void 0!==navigator.locks&&"function"==typeof navigator.locks.request};var n=Promise.resolve(!1);t.PROMISE_RESOLVED_FALSE=n;var r=Promise.resolve(!0);t.PROMISE_RESOLVED_TRUE=r;var o=Promise.resolve();t.PROMISE_RESOLVED_VOID=o;var i=0,a=0},487:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=t},1012:e=>{var t,n;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var o=e[r]<<16|e[r+1]<<8|e[r+2],i=0;i<4;i++)8*r+6*i<=8*e.length?n.push(t.charAt(o>>>6*(3-i)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,o=0;r<e.length;o=++r%4)0!=o&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(r))>>>6-2*o);return n}},e.exports=n},1227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(2447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,n)=>{e.exports=function(e){function t(e){let n,o,i,a=null;function s(...e){if(!s.enabled)return;const r=s,o=Number(new Date),i=o-(n||o);r.diff=i,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";a++;const i=t.formatters[o];if("function"==typeof i){const t=e[a];n=i.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},8738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},2568:(e,t,n)=>{var r,o,i,a,s;r=n(1012),o=n(487).utf8,i=n(8738),a=n(487).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?a.stringToBytes(e):o.stringToBytes(e):i(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=r.bytesToWords(e),u=8*e.length,c=1732584193,d=-271733879,l=-1732584194,f=271733878,p=0;p<n.length;p++)n[p]=16711935&(n[p]<<8|n[p]>>>24)|4278255360&(n[p]<<24|n[p]>>>8);n[u>>>5]|=128<<u%32,n[14+(u+64>>>9<<4)]=u;var h=s._ff,y=s._gg,v=s._hh,m=s._ii;for(p=0;p<n.length;p+=16){var _=c,g=d,b=l,E=f;c=h(c,d,l,f,n[p+0],7,-680876936),f=h(f,c,d,l,n[p+1],12,-389564586),l=h(l,f,c,d,n[p+2],17,606105819),d=h(d,l,f,c,n[p+3],22,-1044525330),c=h(c,d,l,f,n[p+4],7,-176418897),f=h(f,c,d,l,n[p+5],12,1200080426),l=h(l,f,c,d,n[p+6],17,-1473231341),d=h(d,l,f,c,n[p+7],22,-45705983),c=h(c,d,l,f,n[p+8],7,1770035416),f=h(f,c,d,l,n[p+9],12,-1958414417),l=h(l,f,c,d,n[p+10],17,-42063),d=h(d,l,f,c,n[p+11],22,-1990404162),c=h(c,d,l,f,n[p+12],7,1804603682),f=h(f,c,d,l,n[p+13],12,-40341101),l=h(l,f,c,d,n[p+14],17,-1502002290),c=y(c,d=h(d,l,f,c,n[p+15],22,1236535329),l,f,n[p+1],5,-165796510),f=y(f,c,d,l,n[p+6],9,-1069501632),l=y(l,f,c,d,n[p+11],14,643717713),d=y(d,l,f,c,n[p+0],20,-373897302),c=y(c,d,l,f,n[p+5],5,-701558691),f=y(f,c,d,l,n[p+10],9,38016083),l=y(l,f,c,d,n[p+15],14,-660478335),d=y(d,l,f,c,n[p+4],20,-405537848),c=y(c,d,l,f,n[p+9],5,568446438),f=y(f,c,d,l,n[p+14],9,-1019803690),l=y(l,f,c,d,n[p+3],14,-187363961),d=y(d,l,f,c,n[p+8],20,1163531501),c=y(c,d,l,f,n[p+13],5,-1444681467),f=y(f,c,d,l,n[p+2],9,-51403784),l=y(l,f,c,d,n[p+7],14,1735328473),c=v(c,d=y(d,l,f,c,n[p+12],20,-1926607734),l,f,n[p+5],4,-378558),f=v(f,c,d,l,n[p+8],11,-2022574463),l=v(l,f,c,d,n[p+11],16,1839030562),d=v(d,l,f,c,n[p+14],23,-35309556),c=v(c,d,l,f,n[p+1],4,-1530992060),f=v(f,c,d,l,n[p+4],11,1272893353),l=v(l,f,c,d,n[p+7],16,-155497632),d=v(d,l,f,c,n[p+10],23,-1094730640),c=v(c,d,l,f,n[p+13],4,681279174),f=v(f,c,d,l,n[p+0],11,-358537222),l=v(l,f,c,d,n[p+3],16,-722521979),d=v(d,l,f,c,n[p+6],23,76029189),c=v(c,d,l,f,n[p+9],4,-640364487),f=v(f,c,d,l,n[p+12],11,-421815835),l=v(l,f,c,d,n[p+15],16,530742520),c=m(c,d=v(d,l,f,c,n[p+2],23,-995338651),l,f,n[p+0],6,-198630844),f=m(f,c,d,l,n[p+7],10,1126891415),l=m(l,f,c,d,n[p+14],15,-1416354905),d=m(d,l,f,c,n[p+5],21,-57434055),c=m(c,d,l,f,n[p+12],6,1700485571),f=m(f,c,d,l,n[p+3],10,-1894986606),l=m(l,f,c,d,n[p+10],15,-1051523),d=m(d,l,f,c,n[p+1],21,-2054922799),c=m(c,d,l,f,n[p+8],6,1873313359),f=m(f,c,d,l,n[p+15],10,-30611744),l=m(l,f,c,d,n[p+6],15,-1560198380),d=m(d,l,f,c,n[p+13],21,1309151649),c=m(c,d,l,f,n[p+4],6,-145523070),f=m(f,c,d,l,n[p+11],10,-1120210379),l=m(l,f,c,d,n[p+2],15,718787259),d=m(d,l,f,c,n[p+9],21,-343485551),c=c+_>>>0,d=d+g>>>0,l=l+b>>>0,f=f+E>>>0}return r.endian([c,d,l,f])})._ff=function(e,t,n,r,o,i,a){var s=e+(t&n|~t&r)+(o>>>0)+a;return(s<<i|s>>>32-i)+t},s._gg=function(e,t,n,r,o,i,a){var s=e+(t&r|n&~r)+(o>>>0)+a;return(s<<i|s>>>32-i)+t},s._hh=function(e,t,n,r,o,i,a){var s=e+(t^n^r)+(o>>>0)+a;return(s<<i|s>>>32-i)+t},s._ii=function(e,t,n,r,o,i,a){var s=e+(n^(t|~r))+(o>>>0)+a;return(s<<i|s>>>32-i)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=r.wordsToBytes(s(e,t));return t&&t.asBytes?n:t&&t.asString?a.bytesToString(n):r.bytesToHex(n)}},7824:e=>{var t=1e3,n=60*t,r=60*n,o=24*r;function i(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,a){a=a||{};var s,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var a=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===c&&isFinite(e))return a.long?(s=e,(u=Math.abs(s))>=o?i(s,u,o,"day"):u>=r?i(s,u,r,"hour"):u>=n?i(s,u,n,"minute"):u>=t?i(s,u,t,"second"):s+" ms"):function(e){var i=Math.abs(e);return i>=o?Math.round(e/o)+"d":i>=r?Math.round(e/r)+"h":i>=n?Math.round(e/n)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},2151:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ObliviousSet:()=>r,now:()=>i,removeTooOldValues:()=>o});var r=function(){function e(e){this.ttl=e,this.map=new Map,this._to=!1}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.add=function(e){var t=this;this.map.set(e,i()),this._to||(this._to=!0,setTimeout((function(){t._to=!1,o(t)}),0))},e.prototype.clear=function(){this.map.clear()},e}();function o(e){for(var t=i()-e.ttl,n=e.map[Symbol.iterator]();;){var r=n.next().value;if(!r)return;var o=r[0];if(!(r[1]<t))return;e.map.delete(o)}}function i(){return(new Date).getTime()}},8660:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:o=i(r.Reflect,o),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!i&&!a,u={create:i?function(){return N(Object.create(null))}:a?function(){return N({__proto__:null})}:function(){return N({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),d="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,l=d||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,o=n+1;o<r;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function a(e,t){return[e,t]}}():Map,f=d||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new l}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}():Set,p=new(d||"function"!=typeof WeakMap?function(){var e=16,n=u.create(),r=o();return function(){function e(){this._key=o()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=o()},e}();function o(){var e;do{e="@@WeakMap@@"+s()}while(u.has(n,e));return n[e]=!0,e}function i(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(){var t,n=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t));n[6]=79&n[6]|64,n[8]=191&n[8]|128;for(var r="",o=0;o<e;++o){var i=n[o];4!==o&&6!==o&&8!==o||(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}():WeakMap);function h(e,t,n){var r=p.get(e);if(C(r)){if(!n)return;r=new l,p.set(e,r)}var o=r.get(t);if(C(o)){if(!n)return;o=new l,r.set(t,o)}return o}function y(e,t,n){if(v(e,t,n))return!0;var r=R(t);return!O(r)&&y(e,r,n)}function v(e,t,n){var r=h(t,n,!1);return!C(r)&&!!r.has(e)}function m(e,t,n){if(v(e,t,n))return _(e,t,n);var r=R(t);return O(r)?void 0:m(e,r,n)}function _(e,t,n){var r=h(t,n,!1);if(!C(r))return r.get(e)}function g(e,t,n,r){h(n,r,!0).set(e,t)}function b(e,t){var n=E(e,t),r=R(e);if(null===r)return n;var o=b(r,t);if(o.length<=0)return n;if(n.length<=0)return o;for(var i=new f,a=[],s=0,u=n;s<u.length;s++){var c=u[s];i.has(c)||(i.add(c),a.push(c))}for(var d=0,l=o;d<l.length;d++)c=l[d],i.has(c)||(i.add(c),a.push(c));return a}function E(e,t){var n=[],r=h(e,t,!1);if(C(r))return n;for(var i=function(e){var t=T(e,o);if(!k(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=L(i);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{j(i)}finally{throw e}}a++}}function w(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function C(e){return void 0===e}function O(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function I(e,t){switch(w(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",o=T(e,r);if(void 0!==o){var i=o.call(e,n);if(S(i))throw new TypeError;return i}return function(e,t){if("string"===t){var n=e.toString;if(k(n)&&!S(o=n.call(e)))return o;if(k(r=e.valueOf)&&!S(o=r.call(e)))return o}else{var r;if(k(r=e.valueOf)&&!S(o=r.call(e)))return o;var o,i=e.toString;if(k(i)&&!S(o=i.call(e)))return o}throw new TypeError}(e,"default"===n?"number":n)}function M(e){var t=I(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function D(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function k(e){return"function"==typeof e}function P(e){return"function"==typeof e}function T(e,t){var n=e[t];if(null!=n){if(!k(n))throw new TypeError;return n}}function L(e){var t=e.next();return!t.done&&t}function j(e){var t=e.return;t&&t.call(e)}function R(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var o=r.constructor;return"function"!=typeof o||o===e?t:o}function N(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(C(n)){if(!D(e))throw new TypeError;if(!P(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!C(r)&&!O(r)){if(!P(r))throw new TypeError;t=r}}return t}(e,t)}if(!D(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!C(r)&&!O(r))throw new TypeError;return O(r)&&(r=void 0),function(e,t,n,r){for(var o=e.length-1;o>=0;--o){var i=(0,e[o])(t,n,r);if(!C(i)&&!O(i)){if(!S(i))throw new TypeError;r=i}}return r}(e,t,n=M(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!C(r)&&!function(e){switch(w(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;g(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return C(r)||(r=M(r)),g(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return C(n)||(n=M(n)),y(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return C(n)||(n=M(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return C(n)||(n=M(n)),m(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return C(n)||(n=M(n)),_(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return C(t)||(t=M(t)),b(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return C(t)||(t=M(t)),E(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;C(n)||(n=M(n));var r=h(t,n,!1);if(C(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var o=p.get(t);return o.delete(n),o.size>0||p.delete(t),!0}))}(o)}()}(r||(r={}))},2663:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CannotInjectValueError:()=>h,CannotInstantiateValueError:()=>u,Container:()=>f,ContainerInstance:()=>l,Inject:()=>m,InjectMany:()=>v,Service:()=>_,ServiceNotFoundError:()=>a,Token:()=>o,default:()=>g});var r,o=function(e){this.name=e},i=(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(t){var n,r=e.call(this)||this;return r.name="ServiceNotFoundError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof t?r.normalizedIdentifier=t:t instanceof o?r.normalizedIdentifier="Token<"+(t.name||"UNSET_NAME")+">":t&&(t.name||(null===(n=t.prototype)||void 0===n?void 0:n.name))&&(r.normalizedIdentifier="MaybeConstructable<"+t.name+">"||0),r}return i(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Service with "'+this.normalizedIdentifier+'" identifier was not found in the container. Register it before usage via explicitly calling the "Container.set" function or using the "@Service()" decorator.'},enumerable:!1,configurable:!0}),t}(Error),s=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(t){var n,r=e.call(this)||this;return r.name="CannotInstantiateValueError",r.normalizedIdentifier="<UNKNOWN_IDENTIFIER>","string"==typeof t?r.normalizedIdentifier=t:t instanceof o?r.normalizedIdentifier="Token<"+(t.name||"UNSET_NAME")+">":t&&(t.name||(null===(n=t.prototype)||void 0===n?void 0:n.name))&&(r.normalizedIdentifier="MaybeConstructable<"+t.name+">"||0),r}return s(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Cannot instantiate the requested value for the "'+this.normalizedIdentifier+"\" identifier. The related metadata doesn't contain a factory or a type to instantiate."},enumerable:!1,configurable:!0}),t}(Error),c=Symbol("EMPTY_VALUE"),d=function(){return d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},d.apply(this,arguments)},l=function(){function e(e){this.services=[],this.id=e}return e.prototype.has=function(e){return!!this.findService(e)},e.prototype.get=function(e){var t=f.of(void 0),n=t.findService(e),r=this.findService(e);if(n&&!0===n.global)return this.getServiceValue(n);if(r)return this.getServiceValue(r);if(n&&this!==t){var o=d({},n);o.value=c,this.set(o);var i=this.getServiceValue(o);return this.set(d(d({},o),{value:i})),i}if(n)return this.getServiceValue(n);throw new a(e)},e.prototype.getMany=function(e){var t=this;return this.findAllServices(e).map((function(e){return t.getServiceValue(e)}))},e.prototype.set=function(e,t){var n=this;if(e instanceof Array)return e.forEach((function(e){return n.set(e)})),this;if("string"==typeof e||e instanceof o)return this.set({id:e,type:null,value:t,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});if("function"==typeof e)return this.set({id:e,type:e,value:t,factory:void 0,global:!1,multiple:!1,eager:!1,transient:!1});var r=d({id:new o("UNREACHABLE"),type:null,factory:void 0,value:c,global:!1,multiple:!1,eager:!1,transient:!1},e),i=this.findService(r.id);return i&&!0!==i.multiple?Object.assign(i,r):this.services.push(r),r.eager&&this.get(r.id),this},e.prototype.remove=function(e){var t=this;return Array.isArray(e)?e.forEach((function(e){return t.remove(e)})):this.services=this.services.filter((function(n){return n.id!==e||(t.destroyServiceInstance(n),!1)})),this},e.prototype.reset=function(e){var t=this;switch(void 0===e&&(e={strategy:"resetValue"}),e.strategy){case"resetValue":this.services.forEach((function(e){return t.destroyServiceInstance(e)}));break;case"resetServices":this.services.forEach((function(e){return t.destroyServiceInstance(e)})),this.services=[];break;default:throw new Error("Received invalid reset strategy.")}return this},e.prototype.findAllServices=function(e){return this.services.filter((function(t){return t.id===e}))},e.prototype.findService=function(e){return this.services.find((function(t){return t.id===e}))},e.prototype.getServiceValue=function(e){var t,n=c;if(e.value!==c)return e.value;if(!e.factory&&!e.type)throw new u(e.id);if(e.factory)if(e.factory instanceof Array){var r=void 0;try{r=this.get(e.factory[0])}catch(t){if(!(t instanceof a))throw t;r=new e.factory[0]}n=r[e.factory[1]](this,e.id)}else n=e.factory(this,e.id);if(!e.factory&&e.type){var o=e.type,i=(null===(t=Reflect)||void 0===t?void 0:t.getMetadata("design:paramtypes",o))||[],s=this.initializeParams(o,i);s.push(this),n=new(o.bind.apply(o,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}([void 0],s)))}if(e.transient||n===c||(e.value=n),n===c)throw new u(e.id);return e.type&&this.applyPropertyHandlers(e.type,n),n},e.prototype.initializeParams=function(e,t){var n=this;return t.map((function(t,r){var o=f.handlers.find((function(t){return(t.object===e||t.object===Object.getPrototypeOf(e))&&t.index===r}));return o?o.value(n):t&&t.name&&!n.isPrimitiveParamType(t.name)?n.get(t):void 0}))},e.prototype.isPrimitiveParamType=function(e){return["string","boolean","number","object"].includes(e.toLowerCase())},e.prototype.applyPropertyHandlers=function(e,t){var n=this;f.handlers.forEach((function(r){"number"!=typeof r.index&&(r.object.constructor===e||e.prototype instanceof r.object.constructor)&&r.propertyName&&(t[r.propertyName]=r.value(n))}))},e.prototype.destroyServiceInstance=function(e,t){if(void 0===t&&(t=!1),t||e.type||e.factory){if("function"==typeof(null==e?void 0:e.value).destroy)try{e.value.destroy()}catch(e){}e.value=c}},e}(),f=function(){function e(){}return e.of=function(e){if(void 0===e&&(e="default"),"default"===e)return this.globalInstance;var t=this.instances.find((function(t){return t.id===e}));return t||(t=new l(e),this.instances.push(t)),t},e.has=function(e){return this.globalInstance.has(e)},e.get=function(e){return this.globalInstance.get(e)},e.getMany=function(e){return this.globalInstance.getMany(e)},e.set=function(e,t){return this.globalInstance.set(e,t),this},e.remove=function(e){return this.globalInstance.remove(e),this},e.reset=function(e){if(void 0===e&&(e="default"),"default"==e)this.globalInstance.reset(),this.instances.forEach((function(e){return e.reset()}));else{var t=this.instances.find((function(t){return t.id===e}));t&&(t.reset(),this.instances.splice(this.instances.indexOf(t),1))}return this},e.registerHandler=function(e){return this.handlers.push(e),this},e.import=function(e){return this},e.handlers=[],e.globalInstance=new l("default"),e.instances=[],e}(),p=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(e){function t(t,n){var r=e.call(this)||this;return r.target=t,r.propertyName=n,r.name="CannotInjectValueError",r}return p(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return'Cannot inject value into "'+this.target.constructor.name+"."+this.propertyName+"\". Please make sure you setup reflect-metadata properly and you don't use interfaces without service tokens as injection value."},enumerable:!1,configurable:!0}),t}(Error);function y(e,t,n,r){var i;if((e&&"string"==typeof e||e instanceof o)&&(i={eagerType:e,lazyType:function(){return e}}),e&&"function"==typeof e&&(i={eagerType:null,lazyType:function(){return e()}}),!e&&n){var a=Reflect.getMetadata("design:type",t,n);i={eagerType:a,lazyType:function(){return a}}}if(!e&&"number"==typeof r&&Number.isInteger(r)){var s=Reflect.getMetadata("design:paramtypes",t,n),u=null==s?void 0:s[r];i={eagerType:u,lazyType:function(){return u}}}return i}function v(e){return function(t,n,r){var o=y(e,t,n,r);if(void 0===o||void 0===o.eagerType||o.eagerType===Object)throw new h(t,n);f.registerHandler({object:t,propertyName:n,index:r,value:function(e){var r=o.lazyType();if(void 0===r||r===Object)throw new h(t,n);return e.getMany(r)}})}}function m(e){return function(t,n,r){var o=y(e,t,n,r);if(void 0===o||void 0===o.eagerType||o.eagerType===Object)throw new h(t,n);f.registerHandler({object:t,propertyName:n,index:r,value:function(e){var r=o.lazyType();if(void 0===r||r===Object)throw new h(t,n);return e.get(r)}})}}function _(e){return function(t){var n={id:t,type:t,factory:void 0,multiple:!1,global:!1,eager:!1,transient:!1,value:c};e instanceof o||"string"==typeof e?n.id=e:e&&(n.id=e.id||t,n.factory=e.factory||void 0,n.multiple=e.multiple||!1,n.global=e.global||!1,n.eager=e.eager||!1,n.transient=e.transient||!1),f.set(n)}}const g=f},4810:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add:()=>a,getSize:()=>c,removeAll:()=>u,runAll:()=>s});var r="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e){process.on("exit",(function(){return e()})),process.on("beforeExit",(function(){return e().then((function(){return process.exit()}))})),process.on("SIGINT",(function(){return e().then((function(){return process.exit()}))})),process.on("uncaughtException",(function(t){return e().then((function(){console.trace(t),process.exit(101)}))}))}:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}},o=new Set,i=!1;function a(e){if(i||(i=!0,r(s)),"function"!=typeof e)throw new Error("Listener is no function");return o.add(e),{remove:function(){return o.delete(e)},run:function(){return o.delete(e),e()}}}function s(){var e=[];return o.forEach((function(t){e.push(t()),o.delete(t)})),Promise.all(e)}function u(){o.clear()}function c(){return o.size}},9118:(e,t,n)=>{var r=n(689),o=n(8130),i=o;i.v1=r,i.v4=o,e.exports=i},6291:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0,o=t;return o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]}},184:(e,t,n)=>{var r,o=void 0!==n.g&&(n.g.crypto||n.g.msCrypto);if(o&&o.getRandomValues){var i=new Uint8Array(16);r=function(){return o.getRandomValues(i),i}}if(!r){var a=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}e.exports=r},689:(e,t,n)=>{var r=n(184),o=n(6291),i=r(),a=[1|i[0],i[1],i[2],i[3],i[4],i[5]],s=16383&(i[6]<<8|i[7]),u=0,c=0;e.exports=function(e,t,n){var r=t&&n||0,i=t||[],d=void 0!==(e=e||{}).clockseq?e.clockseq:s,l=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:c+1,p=l-u+(f-c)/1e4;if(p<0&&void 0===e.clockseq&&(d=d+1&16383),(p<0||l>u)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=l,c=f,s=d;var h=(1e4*(268435455&(l+=122192928e5))+f)%4294967296;i[r++]=h>>>24&255,i[r++]=h>>>16&255,i[r++]=h>>>8&255,i[r++]=255&h;var y=l/4294967296*1e4&268435455;i[r++]=y>>>8&255,i[r++]=255&y,i[r++]=y>>>24&15|16,i[r++]=y>>>16&255,i[r++]=d>>>8|128,i[r++]=255&d;for(var v=e.node||a,m=0;m<6;++m)i[r+m]=v[m];return t||o(i)}},8130:(e,t,n)=>{var r=n(184),o=n(6291);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[i+s]=a[s];return t||o(a)}},8698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4424:(e,t,n)=>{"use strict";n.r(t),n.d(t,{deleteDB:()=>v,openDB:()=>y,unwrap:()=>h,wrap:()=>p});const r=(e,t)=>t.some((t=>e instanceof t));let o,i;const a=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap;let l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(h(this),e),p(a.get(this))}:function(...e){return p(t.apply(h(this),e))}:function(e,...n){const r=t.call(h(this),e,...n);return u.set(r,e.sort?e.sort():[e]),p(r)}:(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));s.set(e,t)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e);var t}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(p(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&a.set(t,e)})).catch((()=>{})),d.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=f(e);return t!==e&&(c.set(e,t),d.set(t,e)),t}const h=e=>d.get(e);function y(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const a=indexedDB.open(e,t),s=p(a);return r&&a.addEventListener("upgradeneeded",(e=>{r(p(a.result),e.oldVersion,e.newVersion,p(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),s.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),s}function v(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(e=>t(e.oldVersion,e))),p(n).then((()=>{}))}const m=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],g=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(g.get(t))return g.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!m.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let a=i.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),o&&i.done]))[0]};return g.set(t,i),i}var E;E=l,l={...E,get:(e,t,n)=>b(e,t)||E.get(e,t,n),has:(e,t)=>!!b(e,t)||E.has(e,t)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(4450)})();