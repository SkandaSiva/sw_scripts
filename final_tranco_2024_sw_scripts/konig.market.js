const pushupChannel=new BroadcastChannel("pushup-channel"),BROWSE_ABANDONMENT_SYNCED="browse-abandoned-synced",SUBSCRIBER_CART_SYNCED="subscriber-cart-synced",ABANDONED_CART_OVER_BUDGET="abandoned-cart-over-budget",BROWSE_ABANDONMENT_OVER_BUDGET="browse-abandoned-over-budget";self.addEventListener("message",t=>{const i=t.data;"sync-subscriber-cart"===i.type?(fetch("/apps/pushup-notification/subscriber-cart/sync",{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(i)}).then(t=>{402===t.status&&pushupChannel.postMessage({type:ABANDONED_CART_OVER_BUDGET})}),pushupChannel.postMessage({type:SUBSCRIBER_CART_SYNCED})):"sync-browse-abandoned"===i.type&&fetch("/apps/pushup-notification/browse-abandoned/sync",{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(i)}).then(t=>(402===t.status&&pushupChannel.postMessage({type:BROWSE_ABANDONMENT_OVER_BUDGET}),t.json())).then(t=>{pushupChannel.postMessage({type:BROWSE_ABANDONMENT_SYNCED,task:t.task,email:t.email,productId:i.productId})})});const checkCampaignClicked=async(t,i)=>{fetch("/apps/pushup-notification/campaign/click",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:t,subscriberId:i})}).catch(t=>{console.log("Click on notification error",t)})},checkAutomationClicked=async(t,i,a)=>{fetch("/apps/pushup-notification/automation/click",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({automationId:t,subscriberId:i,automationItemId:a})}).catch(t=>{console.log("Click on notification error",t)})};self.addEventListener("notificationclick",async t=>{t.notification.close();let i=t.notification.data.link||"/";const a=t.notification.data.subscriberId;if(t.notification.data.campaignId)await checkCampaignClicked(t.notification.data.campaignId,a);else if(t.notification.data.automationId){const i=t.notification.data.automationItemId;await checkAutomationClicked(t.notification.data.automationId,a,i)}t.action&&(i=t.action),t.waitUntil(clients.matchAll({type:"window"}).then(t=>{for(const i of t)if("/"===i.url&&"focus"in i)return i.focus();if(clients.openWindow)return clients.openWindow(i)}))}),importScripts("/apps/pushup-notification/push-app.js"),importScripts("/apps/pushup-notification/push-messaging.js");const firebaseConfig={apiKey:"AIzaSyDqFfmU8E0Sid-hsNb1UR0Ku9ZyiAsRDWQ",authDomain:"shopify-push-notificatio-50680.firebaseapp.com",projectId:"shopify-push-notificatio-50680",storageBucket:"shopify-push-notificatio-50680.appspot.com",messagingSenderId:"210270720069",appId:"1:210270720069:web:37b7908e253f73548f932c",measurementId:"G-G91WRE3RR6"},app=firebase.initializeApp(firebaseConfig),messaging=firebase.messaging(app);messaging.onBackgroundMessage(t=>{try{const i=t.data,a=i.actions?JSON.parse(i.actions):[];self.registration.showNotification(i.title,{...i,data:i,actions:a})}catch(t){self.registration.showNotification(i.title||"Uppush - background title setup",{body:i.body||"Uppush - background body setup"})}});