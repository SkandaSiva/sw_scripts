'use strict';async function sendRequest(a,b,c="POST"){let d={method:c,headers:{"Content-Type":"application/json"}};"POST"==c&&(d.body=JSON.stringify(b));const e=await fetch(a,d);return!(200!=e.status)&&e.json()}async function trackEvent(a,b){return sendRequest("https://api.alwatanvoice.com/v1/push/event",{event:a,data:b})}async function fetchNotification(a){return sendRequest("https://api.alwatanvoice.com/v1/push/message/"+a,null,"GET")}async function onPush(a){let b=a.data.json().data;try{if(a.data){let a=await fetchNotification(b.mid);if(!a)throw new Error("Bad response from the server.");return a.data={...b,...a.data},trackEvent("messageDelivered",b),self.registration.showNotification(a.title,a)}}catch(a){let c;self.registration.pushManager.getSubscription().then(function(a){c=a.endpoint}),b.endpoint=c,trackEvent("messageDeliveryError",b)}}async function onNotificationClicked(a){a.notification.close();let b,c,d={mid:a.notification.data.mid,did:a.notification.data.did};"action1"==a.action?(c="messageAction1Clicked",b=a.notification.data.action1.url):"action2"==a.action?(c="messageAction2Clicked",b=a.notification.data.action2.url):(c="messageClicked",b=a.notification.data.url),trackEvent(c,d),a.waitUntil(clients.matchAll({type:"window"}).then(function(a){for(var c,d=0;d<a.length;d++)if(c=a[d],c.url==b&&"focus"in c)return c.focus();if(clients.openWindow)return clients.openWindow(b)}))}async function onNotificationClosed(a){let b={mid:a.notification.data.mid,did:a.notification.data.did};trackEvent("messageClosed",b)}self.addEventListener("push",function(a){a.waitUntil(onPush(a))}),self.addEventListener("notificationclick",function(a){a.waitUntil(onNotificationClicked(a))}),self.addEventListener("notificationclose",function(a){a.waitUntil(onNotificationClosed(a))}),self.addEventListener("install",function(a){a.waitUntil(skipWaiting())}),self.addEventListener("activate",function(a){a.waitUntil(clients.claim())}),self.addEventListener("fetch",function(){}),self.addEventListener("message",function(){}),self.addEventListener("pushsubscriptionchange",function(){});
