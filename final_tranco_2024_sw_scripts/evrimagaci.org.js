const OFFLINE_VERSION=14;const CACHE_NAME='offline';const OFFLINE_URL='/public/offline.html?v='+OFFLINE_VERSION;self.addEventListener('install',(event)=>{event.waitUntil((async()=>{const cache=await caches.open(CACHE_NAME);await cache.add(new Request(OFFLINE_URL,{cache:'reload'}));})());});self.addEventListener('activate',(event)=>{event.waitUntil((async()=>{if('navigationPreload'in self.registration){await self.registration.navigationPreload.enable();}})());self.clients.claim();});self.addEventListener('fetch',(event)=>{if(event.request.mode==='navigate'){event.respondWith((async()=>{try{const preloadResponse=await event.preloadResponse;if(preloadResponse){return preloadResponse;}
return await fetch(event.request);}catch(error){const cache=await caches.open(CACHE_NAME);return await cache.match(OFFLINE_URL);}})());}});const broadcastChannel=new BroadcastChannel('evrimagaci_channel');self.addEventListener('push',event=>{let payload=event.data.json();const title=payload.title;const options=payload.options||{};if(!options.icon){options.icon='https://evrimagaci.org/public/images/logo/circle/192.png';}
event.waitUntil(clients.matchAll().then(client=>{if(client.length===0||!options.data.id){event.waitUntil(self.registration.showNotification(title,options));}else{broadcastChannel.postMessage({type:'notification',payload:payload});}}));});self.addEventListener('notificationclick',event=>{event.notification.close();if(event.notification.data.id){broadcastChannel.postMessage({type:'notificationClick'});}
event.waitUntil(clients.openWindow(event.notification.data.url));});