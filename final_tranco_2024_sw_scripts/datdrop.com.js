!function(){const t="readonly",e="readwrite";function n(t){return new Promise(((e,n)=>{t.onsuccess=function(){e(t.result)},t.onerror=n}))}const s=new class{constructor(t,e){if("string"!==typeof t)throw new TypeError("db_name must be string.");if("number"!==typeof e)throw new TypeError("version must be number.");const s=e;this.DB_NAME=t,this.STORE_NAME="sw_storage";const r=self.indexedDB.open(this.DB_NAME,s);r.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames&&e.objectStoreNames.contains(this.STORE_NAME)||e.createObjectStore(this.STORE_NAME)},this.__db=n(r)}_accessAsyncStore(t){return this.__db.then((e=>e.transaction(this.STORE_NAME,t).objectStore(this.STORE_NAME)))}length(){return this._accessAsyncStore(t).then((t=>n(t.getAllKeys()))).then((t=>t.length))}key(e){return arguments.length?("number"!==typeof e&&(e=0),this._accessAsyncStore(t).then((t=>n(t.getAllKeys()))).then((t=>t[e]||null))):Promise.reject(new TypeError("Failed to execute 'key' on 'Storage'"))}getItem(e){return this._accessAsyncStore(t).then((t=>t.get(e))).then(n)}setItem(t,s){return this._accessAsyncStore(e).then((e=>e.put(s,t))).then(n)}removeItem(t){return this._accessAsyncStore(e).then((e=>e.delete(t))).then(n)}clear(){return this.__db.then((t=>{const s=t.transaction(t.objectStoreNames,e),r=[];for(let e=0,i=t.objectStoreNames.length;e<i;e++){const i=t.objectStoreNames[e];r.push(n(s.objectStore(i).clear()))}return Promise.all(r)}))}}("sw:storage",1);self.addEventListener("install",(t=>{t.waitUntil(self.skipWaiting())})),self.addEventListener("activate",(t=>{t.waitUntil(clients.claim())})),self.addEventListener("fetch",(()=>{})),self.addEventListener("push",(t=>{if(!self.Notification||"granted"!==self.Notification.permission)return;if(!t.data)return;const e=t.data.json();var n;t.waitUntil((n=e.icon,new Promise((t=>{if("undefined"===typeof OffscreenCanvas)return r.then(t).catch((()=>t("")));const e=o(n);return Promise.all([e,i]).then((async([t,e])=>{const n=new OffscreenCanvas(120,120),s=n.getContext("2d");return s.drawImage(await createImageBitmap(t),15,15,90,90),s.drawImage(await createImageBitmap(e),0,0,120,120),n[n.convertToBlob?"convertToBlob":"toBlob"]()})).then(a).then(t).catch((()=>{r.then(t).catch((()=>t("")))}))}))).then((t=>self.registration.showNotification(`Notification from ${function(t=""){return t.replace(c,"").replace(l,"")||"\u30c4"}(e.title)}`,{body:e.body,icon:t,data:{url:e.data.url}}))))})),self.addEventListener("notificationclick",(t=>{const e=(t.notification.data||{}).url;if(t.notification.close(),!e)return;const n=(s=e)&&/^https?:\/\/[^/]+/.test(s)?e:[location.origin,e].map((t=>t.replace(/^\//,"").replace(/\/$/,""))).reduce(((t,e)=>t.concat(e)),[]).join("/");var s;t.waitUntil(clients.matchAll({type:"window"}).then((t=>{const e=t.find((t=>t.url===n&&"focus"in t));return e||(clients.openWindow?clients.openWindow(n):void 0)})).then((t=>{if(t)return t.focus()})))}),!1);self.addEventListener("pushsubscriptionchange",(t=>{t.waitUntil((async()=>{const t=await self.registration.pushManager.getSubscription(),e=await s.getItem("subscription");t&&t.endpoint!==e.endpoint&&s.setItem("subscription",t)})())})),self.addEventListener("message",(t=>{"REQUEST_SUBSCRIPTION"===t.data.action&&t.data.subscription&&t.waitUntil((async t=>{await s.setItem("subscription",t)})(t.data.subscription))}));const r=o("./static/ddPushLogo.jpg").then(a),i=o("./static/ddPushAvatar.png");function o(t){return new Promise(((e,n)=>{fetch(t).then((t=>t.blob())).then(e).catch(n)}))}function a(t){return new Promise(((e,n)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=n,s.readAsDataURL(t)}))}const c=/[-a-zA-Z0-9@:%_+.~#?&//=]{2,256}\.[a-z]{2,14}\b(\/[-a-zA-Z0-9@:%_+.~#?&//=]*)?/gi,l=/(^[|'"_\s\\/]+|[|'"_\s\\/]+$)/gm}();