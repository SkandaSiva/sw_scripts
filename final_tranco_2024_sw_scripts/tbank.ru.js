"use strict";function t(t,n){if(n==null||n>t.length)n=t.length;for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function n(t){if(Array.isArray(t))return t}function e(t,n,e,r,i,o,u){try{var a=t[o](u);var l=a.value}catch(t){e(t);return}if(a.done){n(l)}else{Promise.resolve(l).then(r,i)}}function r(t){return function(){var n=this,r=arguments;return new Promise(function(i,o){var u=t.apply(n,r);function a(t){e(u,i,o,a,l,"next",t)}function l(t){e(u,i,o,a,l,"throw",t)}a(undefined)})}}function i(t,n){if(!(t instanceof n)){throw new TypeError("Cannot call a class as a function")}}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}function u(t,n,e){if(n)o(t.prototype,n);if(e)o(t,e);return t}function a(t,n,e){if(n in t){Object.defineProperty(t,n,{value:e,enumerable:true,configurable:true,writable:true})}else{t[n]=e}return t}function l(t,n){if(n!=null&&typeof Symbol!=="undefined"&&n[Symbol.hasInstance]){return!!n[Symbol.hasInstance](t)}else{return t instanceof n}}function c(t,n){var e=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(e==null)return;var r=[];var i=true;var o=false;var u,a;try{for(e=e.call(t);!(i=(u=e.next()).done);i=true){r.push(u.value);if(n&&r.length===n)break}}catch(t){o=true;a=t}finally{try{if(!i&&e["return"]!=null)e["return"]()}finally{if(o)throw a}}return r}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};var r=Object.keys(e);if(typeof Object.getOwnPropertySymbols==="function"){r=r.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))}r.forEach(function(n){a(t,n,e[n])})}return t}function v(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);if(n){r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})}e.push.apply(e,r)}return e}function d(t,n){n=n!=null?n:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))}else{v(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(t,e){return n(t)||c(t,e)||p(t,e)||s()}function p(n,e){if(!n)return;if(typeof n==="string")return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor)r=n.constructor.name;if(r==="Map"||r==="Set")return Array.from(r);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(n,e)}function y(t,n){var e,r,i,o,u={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(n){return l([t,n])}}function l(o){if(e)throw new TypeError("Generator is already executing.");while(u)try{if(e=1,r&&(i=o[0]&2?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;if(r=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:u.label++;return{value:o[1],done:false};case 5:u.label++;r=o[1];o=[0];continue;case 7:o=u.ops.pop();u.trys.pop();continue;default:if(!(i=u.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){u=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(o[0]===6&&u.label<i[1]){u.label=i[1];i=o;break}if(i&&u.label<i[2]){u.label=i[2];u.ops.push(o);break}if(i[2])u.ops.pop();u.trys.pop();continue}o=n.call(t,u)}catch(t){o=[6,t];r=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}var b={title:"Tinkoff.ru",lang:"RU",body:"",icon:"https://www.tinkoff.ru/apple-touch-icon-180x180.png",silent:!1};var w=function(t){var n=t!==null&&t!==void 0?t:{},e=n.data,r=e===void 0?{}:e,i=n.notification,o=i===void 0?{}:i;var u;return d(f({},b,o),{data:r,tag:(u=r.messageId)!==null&&u!==void 0?u:Date.now().toString()})};function m(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:encodeURIComponent;return"?".concat(Object.entries(t).map(function(t){var e=h(t,2),r=e[0],i=e[1];return"".concat(n(r),"=").concat(n(i))}).join("&"))}function g(t){return t}var k={host:"https://api.tinkoff.ru/v1/",subscribe:"register_for_push_notification",unsubscribe:"",status:"set_push_notification_status",store:"store",log:"log",fetchRequestInit:{}},O=k;var P=function(){function t(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=n.appKey;i(this,t);this.storeName="tinkoff-push".concat(e?"--".concat(e):""),this.db=null}u(t,[{key:"get",value:function t(t){var n=this;return r(function(){var e;return y(this,function(r){switch(r.label){case 0:return[4,n._withStore("readonly",function(n){e=n.get(t)})];case 1:return[2,(r.sent(),e.result)]}})})()}},{key:"set",value:function t(t,n){var e=this;return r(function(){return y(this,function(r){switch(r.label){case 0:return[4,e._withStore("readwrite",function(e){e.put(n,t)})];case 1:r.sent();return[2]}})})()}},{key:"_getDB",value:function t(){var t=this;return this.db||(this.db=new Promise(function(n,e){var r=indexedDB.open(t.storeName,1);r.onerror=function(){return e(r.error)},r.onupgradeneeded=function(){return r.result.createObjectStore("keyval")},r.onsuccess=function(){return n(r.result)}})),this.db}},{key:"_withStore",value:function t(t,n){var e=this;return r(function(){var r;return y(this,function(i){switch(i.label){case 0:return[4,e._getDB()];case 1:r=i.sent();return[2,new Promise(function(e,i){var o=r.transaction("keyval",t);o.oncomplete=function(){return e()},o.onerror=function(){return i(o.error)},n(o.objectStore("keyval"))})]}})})()}}]);return t}();var j=new P({appKey:self._appKey});var S=function(){return j.get("api").catch(g).then(function(t){return f({},O,t)})},R=S;var U=function(t,n){return n?R().then(function(e){return fetch(e.host+e.status+m({status:t,messageId:n}),e.fetchRequestInit)}):Promise.resolve()},I=U;var L=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)},_=function(t){return function n(){return L()?t.apply(null,arguments):function(){return Promise.resolve()}}};var D=function(){return j.get("settings").catch(g)},E=D;var x=function(t){return t&&t.stack&&t.stack.split&&t.stack.split("\n")||["No stack"]},A=x;var N="https://www.tinkoff.ru/api/front/pwtm/event",T=function(t,n){return function(){var e=r(function(e){var r,i,o,u;return y(this,function(a){switch(a.label){case 0:a.trys.push([0,3,,4]);r=[],i=null;e&&l(e,Error)&&(i=e.message,r=A(e));return[4,E()];case 1:o=a.sent();return[4,fetch(N,{method:"POST",body:JSON.stringify({level:e?"ERROR":"INFO",event:t,wuid:o.wuid,error:i||void 0,stack:(r===null||r===void 0?void 0:r.length)?r:void 0,additional:n}),headers:{"Content-Type":"application/json"}})];case 2:a.sent();return[3,4];case 3:u=a.sent();return[3,4];case 4:return[2,Promise.resolve()]}})});return function(t){return e.apply(this,arguments)}}()};var K=_(T);var C=function(t){var n;var e=null;try{var i;e=(i=t.data)===null||i===void 0?void 0:i.json()}catch(t){e=null}var o;var u=w(e),a=(o=e===null||e===void 0?void 0:(n=e.notification)===null||n===void 0?void 0:n.title)!==null&&o!==void 0?o:"";return r(function(){var t,n,r;return y(this,function(i){switch(i.label){case 0:i.trys.push([0,4,,5]);n=self.registration&&self.registration.showNotification;if(!n)return[3,3];return[4,self.registration.showNotification(a,u)];case 1:i.sent();return[4,Promise.all([I("delivered",e===null||e===void 0?void 0:(t=e.data)===null||t===void 0?void 0:t.messageId),K("pushDefaultDelivered")()])];case 2:n=i.sent();i.label=3;case 3:n;return[3,5];case 4:r=i.sent();return[3,5];case 5:return[2]}})})};var W=function(){var t=r(function(t){var n,e;return y(this,function(i){switch(i.label){case 0:n=[];i.label=1;case 1:i.trys.push([1,3,,4]);return[4,self.clients.matchAll({type:"window",includeUncontrolled:!0})];case 2:n=i.sent();return[3,4];case 3:e=i.sent();n=[];return[3,4];case 4:return[2,n.length?Promise.all(n.map(r(function(){return y(this,function(n){return[2,self.clients.openWindow(t!==null&&t!==void 0?t:"/")]})}))):self.clients.openWindow(t!==null&&t!==void 0?t:"/")]}})});return function n(n){return t.apply(this,arguments)}}(),B=function(t){var n,e;var r=null;var i;return r=(i=t===null||t===void 0?void 0:(e=t.notification)===null||e===void 0?void 0:(n=e.data)===null||n===void 0?void 0:n.RedirectURL)!==null&&i!==void 0?i:self.location.origin,r},H=function(t){var n,e;var r=null;var i;return r=(i=t===null||t===void 0?void 0:(e=t.notification)===null||e===void 0?void 0:(n=e.data)===null||n===void 0?void 0:n.messageId)!==null&&i!==void 0?i:null,r};var q=function(t,n){var e=new URL(t),r=e.pathname+e.search+e.hash;return new URL(r,"https://".concat(n)).href};var F={"tbank.ru":["tinkoff.ru","www.tinkoff.ru"],"www.tbank.ru":["tinkoff.ru","www.tinkoff.ru"]},G=function(t,n){var e;if(!t||!n)return"/";var r=t,i=t&&((e=new URL(t))===null||e===void 0?void 0:e.hostname);if(n in F){var o=F[n];i&&o.includes(i)&&(r=q(t,n))}return r};var J=function(t,n){if(!t)return null;try{var e=new URL(t);return Object.keys(n).forEach(function(t){e.searchParams.append(t,n[t])}),e.href}catch(t){return null}};var M;self._appKey=(M=new URL(self.location.href).searchParams.get("webPushAppKey"))!==null&&M!==void 0?M:void 0;self.addEventListener("install",function(){self.skipWaiting()});self.addEventListener("push",function(t){var n=C(t);t.waitUntil(n())});self.addEventListener("notificationclick",function(t){var n,e,r,i,o,u,a,l;t===null||t===void 0?void 0:(e=t.notification)===null||e===void 0?void 0:(n=e.close)===null||n===void 0?void 0:n.call(e);var c=B(t),s=H(t),f=c&&((r=new URL(c))===null||r===void 0?void 0:r.hostname);c=G(c,(o=self)===null||o===void 0?void 0:(i=o.location)===null||i===void 0?void 0:i.hostname),c=J(c,{startFrom:"pwa"});var v=I("read",s).catch(function(t){});t.waitUntil(Promise.all([v,W(c!==null&&c!==void 0?c:"/"),K("push-default-read",{messageId:s,redirectURLHostname:f,nextRedirectURLHostname:(u=new URL(c!==null&&c!==void 0?c:""))===null||u===void 0?void 0:u.hostname,serviceWorkerLocationHref:(l=self)===null||l===void 0?void 0:(a=l.location)===null||a===void 0?void 0:a.href})()]))});